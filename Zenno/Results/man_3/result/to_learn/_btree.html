
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN btree (3) Библиотечные вызовы (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, btree"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="btree" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">btree (3)</font><hr><li> <a href="/man.shtml?topic=btree&amp;category=3&amp;russian=1"><u>btree</u></a> (3) <font color="#555555"> ( FreeBSD man: Библиотечные вызовы )</font></li><li>&gt;&gt; <a href="/man.shtml?topic=btree&amp;category=3&amp;russian=0"><u>btree</u></a> (3) <font color="#555555"> ( Русские man: Библиотечные вызовы )</font></li><li> <a href="/man.shtml?topic=btree&amp;category=3&amp;russian=2"><u>btree</u></a> (3) <font color="#555555"> ( Linux man: Библиотечные вызовы )</font></li>
<a name="lbAB">&nbsp;</a>
<h2>НАЗВАНИЕ</h2>

btree - способ доступа к базе данных btree
<a name="lbAC">&nbsp;</a>
<h2>СИНТАКСИС</h2>

<pre><b>#include &lt;<a href="file:/usr/include/sys/types.h">sys/types.h</a>&gt;
#include &lt;<a href="file:/usr/include/db.h">db.h</a>&gt;
</b></pre>

<a name="lbAD">&nbsp;</a>
<h2>ОПИСАНИЕ</h2>

Процедура
<i>dbopen</i>

- это интерфейсная библиотека для файлов баз данных.
Один из поддерживаемых форматов - это формат файлов btree.
Основное описание методов доступа к базам данных находится в
<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dbopen&amp;category=3">dbopen</a></i>(3).

Эта страница руководства содержит только специфичную для btree информацию.
<p>

btree - это отсортированная, сбалансированная древовидная структура,
содержащия ассоциативные пары типа "ключ/данные".
</p><p>

Специфичная структура данных, с помощью которой к btree обращается
<i>dbopen</i>,

задана в &lt;<a href="file:/usr/include/db.h">db.h</a>&gt; следующим образом:
</p><p>

typedef struct {
</p><dl compact=""><dt></dt><dd>
u_long flags;
<br>

u_int cachesize;
<br>

int maxkeypage;
<br>

int minkeypage;
<br>

u_int psize;
<br>

int (*compare)(const DBT *key1, const DBT *key2);
<br>

size_t (*prefix)(const DBT *key1, const DBT *key2);
<br>

int lorder;
</dd></dl>

} BTREEINFO;
<p>

Элементы этой структуры имеют следующие значения:
</p><dl compact="">
<dt>flags</dt><dd>
Величина этой переменной определяется как логическое
<i>ИЛИ</i>

следующих констант:
<dl compact=""><dt></dt><dd>
<dl compact="">
<dt>R_DUP</dt><dd>
Разрешает повторяющиеся ключи в дереве, т.е., разрешает вставку,
если вставляемый ключ уже существует в дереве.
По умолчанию, как описано в
<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dbopen&amp;category=3">dbopen</a></i>(3),

если ключ уже встречается в дереве, новые данные записываются "поверх"
старых; или запись прерывается, если задан флаг со значением R_NOOVERWRITE.
Флаг R_DUP "перекрывается" флагом R_NOOVERWRITE; и если R_NOOVERWRITE задан,
то попытка записи одинаковых ключей приведет к ошибке.
</dd><dt></dt><dd>
Если база данных содержит дубликаты ключей, порядок получения пар
"ключ/данные" не определен при использовании функции
<i>get</i>,

однако, функция
<i>seq</i>,

вызванная с установленным флагом R_CURSOR, всегда возвращает ссылку
на первый ключ в группе идентичных ключей.
</dd></dl>
</dd></dl>

</dd><dt>cachesize</dt><dd>
Рекомендуемый максимальный размер памяти (в байтах),
используемый внутренним кэшем. Эта переменная носит
<b>только</b>

"совещательный" характер, и при попытке доступа к данным может выделиться
большее количество памяти.
В последствии при каждом поиске проверяется корневая страница дерева,
кэшируются наиболее часто используемые страницы, что уменьшает время
необходимое для доступа к данным.
В дополнение к этому, физическая запись на диск откладывается настолько,
насколько это возможно, что значительно уменьшает количество операций
ввода/вывода.
Очевидно, использование кэша увеличивает (но только увеличивает) вероятность
повреждения или потери данных во время изменения данных. Если
<i>cachesize</i>

равен 0 (т.е., размер не указан), то используется размер кэша по умолчанию.
</dd><dt>maxkeypage</dt><dd>
Максимальное количество ключей, которые могут храниться на одной странице.
В настоящее время данная возможность не реализована.
</dd><dt>minkeypage</dt><dd>
Минимальное количество ключей, которые могут храниться на одной странице.
Эта величина используется для определения количества ключей, которые
были сохранены при переполнении страницы. Т.е., если ключ или данные длиннее,
чем размер страницы, деленный на величину minkeypage, они будут сохранены
на отдельной странице. Если
<i>minkeypage</i>

равно 0 (минимальное количество ключей не определено),
то величина принимается равной 2-м.
</dd><dt>psize</dt><dd>
Размер (в байтах) страницы, используемой для узлов дерева.
Минимальный размер страницы - 512 байтов, максимальный - 64 килобайта. Если
<i>psize</i>

равно 0 (размер страницы не указан), то размер страницы получается равным
размеру одного блока текущей системы ввода/вывода.
</dd><dt>compare</dt><dd>
Это функция сравнения ключей.
Она возвращает целое значение, меньшее нуля, равное нулю или большее нуля,
если первый аргумент соответственно меньше, равен или больше второго аргумента.
Одна и та же функция для сравнения должна быть использована каждый раз
при открытии базы. Если
<i>compare</i>

указывает на NULL (функция сравнения не определена), то
ключи сравниваются лексически, т.е., короткие ключи меньше, чем длинные.
</dd><dt>prefix</dt><dd>
Это функция сравнения префиксов.
Данная функция, если она определена, должна возвращать количество байтов во втором
аргументе; это необходимо для того, чтобы определить, что данный аргумент больше,
чем перый.
Если аргументы равны, функция должна вернуть значение, равное длине ключа.
Отметим, что эффективность этой функции в большой степени зависит от типа данных, 
но в некоторых случаях помогает значительно уменьшить размер дерева 
и время поиска данных. Если
<i>prefix</i>

равно NULL (функция не определена)
<b>и</b>

функция сравнения не определена, то по умолчанию используется лексический метод
сравнения. Если
<i>prefix</i>

равно NULL и функция сравнения определена, то сравнения префиксов не происходит.
</dd><dt>lorder</dt><dd>
Порядок расположения байтов, заданный для целых чисел, хранящихся в базе данных.
Число должно отражать порядок размещения; например, 
для "big endian" порядок должен обозначаться числом 4,321. Если
<i>lorder</i>

равен 0 (порядок не определен), то используется значение по умолчанию.
</dd></dl>
<p>

Если файл базы уже существует (и не задан флаг O_TRUNC), то
значения, определенные в параметрах flags, lorder и psize игнорируются,
приобретая значения, указанные при создании дерева.
</p><p>

Последовательное сканирование дерева производится от меньших ключей к большим.
</p><p>

Место, освобожденное при удалении из дерева пар ключ/данные, в дальнейшем не
"перекрывается" и может использоваться снова.
Это значит, что физический размер базы данных может только увеличиваться.
Единственное решение - избегать чрезмерного удаления и регулярно создавать
новое дерево при помощи полного сканирования старого.
</p><p>

Поиск, вставка и удаление из дерева выполняются за время O lg по основанию N,
где основание - средняя скорость заполнения. Довольно часто вставка
упорядоченных данных в дерево дает не столь хорошие результаты, однако, данная реализация
модифицирована так, что работа упорядоченных вставок оказывается
наилучшей и во многом более быстрой, чем обычное заполение.
<a name="lbAE">&nbsp;</a>
</p><h2>НАЙДЕННЫЕ ОШИБКИ</h2>

Функции доступа к
<i>btree</i>

могут прекратить работу программы и присвоить
<i>errno</i>

любое значение из определенных для библиотеки процедур
<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dbopen&amp;category=3">dbopen</a></i>(3).

<a name="lbAF">&nbsp;</a>
<h2>СМ. ТАКЖЕ</h2>

<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dbopen&amp;category=3">dbopen</a></i>(3),

<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=hash&amp;category=3">hash</a></i>(3),

<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=mpool&amp;category=3">mpool</a></i>(3),

<i><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=recno&amp;category=3">recno</a></i>(3)

<p>
<i>The Ubiquitous B-tree</i>,

Douglas Comer, ACM Comput. Surv. 11, 2 (June 1979), 121-138.
</p><p>
<i>Prefix B-trees</i>,

Bayer and Unterauer, ACM Transactions on Database Systems, Vol. 2, 1
(March 1977), 11-26.
</p><p>
<i>The Art of Computer Programming Vol. 3: Sorting and Searching</i>,

D.E. Knuth, 1968, pp 471-480.
<a name="lbAG">&nbsp;</a>
</p><h2>НАЙДЕННЫЕ ОШИБКИ</h2>

Поддерживается порядок байтов, определенный только для типов big и little endian.
<p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">НАЗВАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAC">СИНТАКСИС</a></dt><dd>
</dd><dt><a href="#lbAD">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAE">НАЙДЕННЫЕ ОШИБКИ</a></dt><dd>
</dd><dt><a href="#lbAF">СМ. ТАКЖЕ</a></dt><dd>
</dd><dt><a href="#lbAG">НАЙДЕННЫЕ ОШИБКИ</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="btree" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
