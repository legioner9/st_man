
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN nftw (3) Библиотечные вызовы (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, nftw"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="nftw" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">nftw (3)</font><hr><li> <a href="/man.shtml?topic=nftw&amp;category=3&amp;russian=1"><u>nftw</u></a> (3) <font color="#555555"> ( FreeBSD man: Библиотечные вызовы )</font></li><li>&gt;&gt; <a href="/man.shtml?topic=nftw&amp;category=3&amp;russian=0"><u>nftw</u></a> (3) <font color="#555555"> ( Русские man: Библиотечные вызовы )</font></li><li> <a href="/man.shtml?topic=nftw&amp;category=3&amp;russian=2"><u>nftw</u></a> (3) <font color="#555555"> ( Linux man: Библиотечные вызовы )</font></li><li> <a href="/man.shtml?topic=nftw&amp;category=3&amp;russian=5"><u>nftw</u></a> (3) <font color="#555555"> ( POSIX man: Библиотечные вызовы )</font></li>
<a name="lbAB">&nbsp;</a>
<h2>НАЗВАНИЕ</h2>

ftw, nftw - команды перемещения по дереву каталогов
<a name="lbAC">&nbsp;</a>
<h2>СИНТАКСИС</h2>

<b>#include &lt;<a href="file:/usr/include/ftw.h">ftw.h</a>&gt;</b>

<p>
<b>int ftw(const char *</b><i>dir</i><b>, int (*</b><i>fn</i><b>)(const</b>

<b>char *</b><i>file</i><b>, const struct stat *</b><i>sb</i><b>, int </b><i>flag</i><b>),</b>

<b>int </b><i>nopenfd</i><b>);</b>

</p><p>
<b>int nftw(const char *</b><i>dir</i><b>, int (*</b><i>fn</i><b>)(const</b>

<b>char *</b><i>file</i><b>, const struct stat *</b><i>sb</i><b>, int </b><i>flag</i><b>,</b>

<b>struct FTW *</b><i>s</i><b>),</b>

<b>int </b><i>nopenfd</i><b>, int </b><i>flags</i><b>);</b>

<a name="lbAD">&nbsp;</a>
</p><h2>ОПИСАНИЕ</h2>

<b>ftw</b>() перемещается по дереву каталогов, начиная с указанного
каталога <i>dir</i>. Для каждого найденного элемента дерева вызываются: 
<i>fn</i>() с указанием полного имени этого элемента, 
указатель на структуру элемента
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=stat&amp;category=2">stat</a></b>(2)

и целое число. 
Значения этого целого числа <i>flag</i> могут быть одним из следующих:
<dl compact="">
<dt><b>FTW_F</b>

</dt><dd>
(обычный файл);
</dd><dt><b>FTW_D</b>

</dt><dd>
(каталог);
</dd><dt><b>FTW_DNR</b>

</dt><dd>
(каталог, который не может быть считан);
</dd><dt><b>FTW_SL</b>

</dt><dd>
(символьная ссылка);
</dd><dt><b>FTW_NS</b>

</dt><dd>
(ошибка в элементе, который не является символьной ссылкой).
</dd></dl>
<p>

Если элемент - символьная ссылка и в нем происходит ошибка, то XPG4v2
утверждает, что данный элемент не определен (вне зависимости от того,
используется ли FTW_NS и FTW_SL или нет).
</p><p>

<b>ftw</b>() рекурсивно вызывает саму себя для перемещения по обнаруженным каталогам,
обрабатывая каждый каталог перед обработкой вложенных в него файлов и подкаталогов.
</p><p>
Для того, чтобы избежать использования всех описателей файлов, <i>nopenfd</i>
определяет максимальное количество одновременно открытых каталогов. Когда
это количество будет превышено, работа <b>ftw</b>() немного замедляется, так как
каталоги будут закрываться и снова открываться. <b>ftw</b>() использует в целом
один описатель файлов для работы с каждым уровнем файловой иерархии.
</p><p>
</p><p>

Для остановки исследования дерева каталогов <i>fn</i>() возвращает ненулевое значение;
оно станет возвращаемым значением для <b>ftw</b>(). Иначе <b>ftw</b>() будет
продолжать свой поиск, пока не исследует все дерево полностью (в этом случае она
возвратит ноль) или пока не появится ошибка, отличная от ошибок EACCES
(таких, как ошибки
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=malloc&amp;category=3">malloc</a></b>(3)).

В этом случае функция возвратит значение -1.
</p><p>

Так как <b>ftw()</b> использует динамическую структуру данных, то
единственным безопасным способом для выхода из процесса перемещения по дереву
будет возврат ненулевого значения. Для обработки прерываний, например,
необходимо отметить, что прерывание действительно произошло, и вернуть
ненулевое значение.
Не следует использовать функцию
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=longjmp&amp;category=3">longjmp</a></b>(3)

до тех пор, пока программа не будет завершаться.
Функция <b>nftw</b>() выполняет то же самое, что и <b>ftw</b>(),
только имеет еще один  параметр, <i>flags</i>, то есть
вызывает свои функции еще с одним параметром.
Этот параметр <i>flags</i> есть 0 или логическое ИЛИ нескольких
следующих параметров:
</p><dl compact="">
<dt><b>FTW_CHDIR</b>

</dt><dd>
Если установлен этот флаг, то будет выполняться
<i>chdir</i>()

для каждого каталога перед обработкой его содержимого.
</dd><dt><b>FTW_DEPTH</b>

</dt><dd>
Если установлен этот флаг, то производить глубокий поиск, т.е.
функция для обработки самого каталога вызывается только после того, как
обработано содержимое его самого и его подкаталогов.
</dd><dt><b>FTW_MOUNT</b>

</dt><dd>
Если установлен этот флаг, то работать только в одной файловой системе.
</dd><dt><b>FTW_PHYS</b>

</dt><dd>
Если установлен этот флаг, то не следовать по символьным ссылкам.
Это, наверняка, то, что Вам необходимо.
Если флаг не включен, то идет следование по символьным ссылкам,
но ни один файл дважды обработан не будет.
</dd></dl>
<p>

Если FTW_PHYS выключен, а FTW_DEPTH включен, то функция 
<i>fn</i>()

никогда не будет вызвана для каталога, который является своим потомком.
</p><p>

Функция
<i>fn</i>()

вызывается с четырьмя параметрами: 
а) полным путем к элементу,
б) указателем на структуру struct stat этого элемента, 
в) целым, описывающим его тип,
и 
д) указателем на структуру struct FTW. Тип будет одним из следующих:
FTW_F, FTW_D, FTW_DNR, FTW_SL, FTW_NS (если значение его равно
описанному выше, то FTW_SL будет работать только с указанным флагом FTW_PHYS) или
</p><dl compact="">
<dt><b>FTW_DP</b>

</dt><dd>
(элемент является каталогом, и все его потомки уже были обработаны).
Это случается, только если флаг  FTW_DEPTH запущен.
</dd><dt><b>FTW_SLN</b>

</dt><dd>
Элемент - символьная ссылка, указывающая на несуществующий файл.
Это может произойти, только если флаг FTW_PHYS отключен.
</dd></dl>
<p>

Структура struct FTW, на которую указывает четвертый аргумент в
<i>fn</i>(),

имеет, по меньшей мере, поля: 
<i>base</i>

- смещение на имя файла в полном его имени, заданное в первом параметре 
<i>fn</i>();

а также
<i>level</i>

(это глубина элемента относительно начальной точки с глубиной 0).
<a name="lbAE">&nbsp;</a>
</p><h2>ЗАМЕЧАНИЯ</h2>

Функция
<i>nftw</i>()

и использование FTW_SL с
<i>ftw</i>()

были описаны в XPG4v2. 
<p>

В некоторых системах
<i>ftw</i>()

никогда не использует FTW_SL, на других FTW_SL используется тольуо для
символьных ссылок которые не указывают на существующий файл, а еще есть
системы, на которых
<i>ftw</i>()

использует FTW_SL для каждой символьной ссылки. Для точного контроля
используйте
<i>nftw</i>().

</p><p>

В Linux libc4, libc5 и glibc 2.0.6 будут
использовать FTW_F для работы всех объектов (файлов, символьных ссылок, каналов
и т.п.), которые могут иметь определенный статус, но не являются директориями. 
Функция
<i>nftw</i>()

появилась начиная с glibc 2.1.
<a name="lbAF">&nbsp;</a>
</p><h2>СООТВЕТСТВИЕ СТАНДАРТАМ</h2>

AES, SVID2, SVID3, XPG2, XPG3, XPG4, XPG4v2.
<a name="lbAG">&nbsp;</a>
<h2>СМ. ТАКЖЕ</h2>

<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=stat&amp;category=2">stat</a></b>(2)

<p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">НАЗВАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAC">СИНТАКСИС</a></dt><dd>
</dd><dt><a href="#lbAD">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAE">ЗАМЕЧАНИЯ</a></dt><dd>
</dd><dt><a href="#lbAF">СООТВЕТСТВИЕ СТАНДАРТАМ</a></dt><dd>
</dd><dt><a href="#lbAG">СМ. ТАКЖЕ</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="nftw" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
