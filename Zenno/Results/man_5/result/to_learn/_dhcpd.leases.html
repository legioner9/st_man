
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN dhcpd.leases (5) Форматы файлов (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, dhcpd.leases"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="dhcpd.leases" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">dhcpd.leases (5)</font><hr><li>&gt;&gt; <a href="/man.shtml?topic=dhcpd.leases&amp;category=5&amp;russian=0"><u>dhcpd.leases</u></a> (5) <font color="#555555"> ( Русские man: Форматы файлов )</font></li><li> <a href="/man.shtml?topic=dhcpd.leases&amp;category=5&amp;russian=2"><u>dhcpd.leases</u></a> (5) <font color="#555555"> ( Linux man: Форматы файлов )</font></li>


<a name="lbAB">&nbsp;</a>
<h2>ИМЯ</h2>


Файл <b>dhcpd.leases</b> - база данных(БД), хранящая информацию о выделенных(распределенных)
демоном DHCP адресам.

<a name="lbAC">&nbsp;</a>
<h2>ОПИСАНИЕ</h2>


Сервер DHCP, разработанный в ISC, сохраняет в базе данных информацию об адресах, выданных 
им клиентам. БД представляет собой текстовый файл содержащий блоки описывающие выделенные адреса.
Каждый раз когда адрес выделяется, обновляется или освобождается - соответствующая запись 
производится в конец файла БД. Однако если в файле встречается более одной записи для заданного 
адреса то актуальной является только последняя.
<p>



После установки dhcpd, файл БД не создается. Однако он требуется для нормальной работы сервера dhcp
и поэтому необходимо самостоятельно создать пустой файл с названием:
/var/state/dhcp/dhcpd.leases.
</p><p>



Для того что бы предотвратить бесконтрольный рост размеров файла он время от времени создается заново
и перезаписывается. Сначала создается временный файл БД куда сбрасываются все актуальные записи,
затем старый файл переименовывается в
/var/state/dhcp/dhcpd.leases~. Ну и наконец, временный файл переименовывается
в /var/state/dhcp/dhcpd.leases.
</p><p>



Здесь существует проблема с безопасностью системы в плане DoS. Если процесс dhcpd был принудительно завешен
(убит)или система упала в момент когда старый файл уже переименован, а новый еще не перемещен на место,
то после перезагрузки системы окажется что отсутствует файл
/var/state/dhcp/dhcpd.leases. 
В этом случае dhcpd просто не сможет стартовать и потребуется ручное вмешательство.
Первое что приходит на ум - создавать пустой файл. Никогда не делайте этого - таким образом вы рискуете 
ввергнуть систему в хаос, потеряв информацию о ранее распределенных адресах. 
Вместо этого просто переименуйте /var/state/dhcp/dhcpd.leases~ в /var/state/dhcp/dhcpd.leases,
тем самым восстановив предыдущее состояние.


<a name="lbAD">&nbsp;</a>
</p><h2>ФОРМАТ</h2>


Описания распределенных адресов хранятся в формате, который может быть разобран тем же парсером, что
используется для чтения файлов <a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dhcpd.conf&amp;category=5">dhcpd.conf</a>(5)
и <a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dhclient.conf&amp;category=5">dhclient.conf</a>(5).
Формат записи описывающей выделенный адрес следующий:

<p>


<b>lease</b> <i>ip-address</i> {<i>выражения...</i>}

</p><p>


Каждая запись включает в себя единственный IP-адрес, тот что был выделен клиенту. Инструкции в скобках
определяют кому и на какой срок выдан адрес.
</p><p>


Начало и окончание срока использования клиентом адреса записываются с использованием инструкций:
``starts'' и ``ends''
<br>&nbsp;&nbsp;starts&nbsp;<i>дата</i><b>;</b>
<br>&nbsp;<b>&nbsp;ends&nbsp;</b><i>дата</i><b>;</b>
</p><p>


дата - означает следующее:
<br>&nbsp;<i>день_недели&nbsp;год</i><b>/</b><i>месяц</i><b>/</b><i>день
час</i><b>:</b><i>минута</i><b>:</b><i>секунда</i>
</p><p>


день_недели присутствует для облегчения чтения и указывается цифрой от 0 до 6, где 0 - воскресение.
День_недели игнорируется при вводе. Год указывается четырьмя цифрами. Месяц указывается числом начиная
с 1 (Январь). Дни месяца также начинаются с 1. Часы - числа от 0 до 23, минуты и секунды 0 - 59
</p><p>


Время указывается по Гринвичу (GMT),а не согласно местной временной зоне.
</p><p>


MAC адрес сетевого интерфейса, который был использован при получении IP адреса записывается с помощью
инструкции <b>hardware</b>:
</p><p>


<br>&nbsp;<b>hardware&nbsp;</b><i>hardware-type&nbsp;mac-address</i><b>;</b>
</p><p>


MAC адрес записывается последовательностью шестнадцатеричных октетов разделенных двоеточиями.
</p><p>


Если для получения адреса клиент использует идентификатор клиента (client identifier), то он фиксируется
в инструкции <b>uid</b>:
<br>&nbsp;<b>uid&nbsp;</b><i>client-identifier</i><b>;</b>
</p><p>



Идентификатор клиента записывается последовательностью шестнадцатеричных октетов,
независимо от того, указывает ли клиент строку ASCII или использует
более новый формат - hardware type/MAC адрес.
<br>&nbsp;
</p><p>


Если клиент посылает серверу собственное имя используя опцию <i>Client Hostname</i> 
как указанно в некоторых версиях DHCP-DNS Interaction draft, то имя хоста записывается
с использованием инструкции 
<b>client-hostname</b>.
<br>&nbsp;<b>client-hostname&nbsp;&amp;quot;</b><i>hostname</i><b>&amp;quot;;</b>
</p><p>


Если клиент посылает серверу собственное имя используя опцию <i>Hostname</i> 
так как это делает Windows 95,то имя хоста записывается
с использованием инструкции 
<b>hostname</b>.
<br>&nbsp;<b>hostname&nbsp;&amp;quot;</b><i>hostname</i><b>&amp;quot;;</b>
</p><p>



Сервер DHCP, в некоторых случаях, может определить что выделенный адрес не правильно
используется, например если клиент которому был выделен адрес не подтверждает его получение,
или потому что при попытке проверить используется ли адрес перед тем как его выдать сервер
обнаруживает что адрес занят. В таких случаях инструкция <b>abandoned</b> используется
что бы показать что данный адрес "отказной" и не может быть переназначен.
<br>&nbsp;<b>abandoned;</b>
</p><p>



Когда клиент запрашивает новый адрес и сервер обнаруживает что свободные адреса
закончились, то в этом случае сервер просматривает адреса помеченные как <b>abandoned</b>
и выдает клиенту адрес с наименьшим числом отказов. Если конфликты с выданным адресом
продолжаются он повторно переводится в разряд "отказных".
d.
</p><p>



Если клиент запрашивает "отказной" адрес, то сервер считает что причиной помещения этого адреса
в разряд "отказных" было повреждение файла БД и данный клиент и есть та машина что отвечала при 
тестировании адреса перед его распределением. В этом случае адрес незамедлительно назначается 
клиенту.


<a name="lbAE">&nbsp;</a>
</p><h2>ФАЙЛЫ</h2>


<b>/var/state/dhcp/dhcpd.leases</b>


<a name="lbAF">&nbsp;</a>
<h2>СМОТРИТЕ ДОПОЛНИТЕЛЬНО</h2>


<a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dhcpd&amp;category=8">dhcpd</a>(8),
<a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dhcp-options&amp;category=5">dhcp-options</a>(5),
<a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=dhcpd.conf&amp;category=5">dhcpd.conf</a>(5),
RFC2132, RFC2131.

<a name="lbAG">&nbsp;</a>
<h2>АВТОРЫ</h2>

Сервер <b>dhcpd (8)</b>
написан Ted Lemon &lt;<a href="mailto:mellon@vix.com">mellon@vix.com</a>&gt;
по контракту с Vixie Labs. Финансирование осуществлялось ISC. Информацию об ISC можно найти их сайте в интернет: 
<b><a href="http://www.isc.org/isc.">http://www.isc.org/isc.</a></b>


<a name="lbAH">&nbsp;</a>
<h2>ПЕРЕВОД</h2>

Перевод выполнен Лаптевым Андреем - 
&lt;<a href="mailto:lantan@chat.ru">lantan@chat.ru</a>&gt;
<p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">ИМЯ</a></dt><dd>
</dd><dt><a href="#lbAC">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAD">ФОРМАТ</a></dt><dd>
</dd><dt><a href="#lbAE">ФАЙЛЫ</a></dt><dd>
</dd><dt><a href="#lbAF">СМОТРИТЕ ДОПОЛНИТЕЛЬНО</a></dt><dd>
</dd><dt><a href="#lbAG">АВТОРЫ</a></dt><dd>
</dd><dt><a href="#lbAH">ПЕРЕВОД</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="dhcpd.leases" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
