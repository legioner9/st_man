
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN tc-tbf (8) Команды системного администрирования (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, tc-tbf"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="tc-tbf" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">tc-tbf (8)</font><hr><li>&gt;&gt; <a href="/man.shtml?topic=tc-tbf&amp;category=8&amp;russian=0"><u>tc-tbf</u></a> (8) <font color="#555555"> ( Русские man: Команды системного администрирования )</font></li><li> <a href="/man.shtml?topic=tc-tbf&amp;category=8&amp;russian=2"><u>tc-tbf</u></a> (8) <font color="#555555"> ( Linux man: Команды системного администрирования )</font></li>
<a name="lbAB">&nbsp;</a>
<h2>ИМЯ</h2>

tbf - фильтр буфера токенов (Token Bucket)
<a name="lbAC">&nbsp;</a>
<h2>СИНТАКСИС</h2>

<b>tc qdisc ... tbf rate</b>

скорость
<b>burst</b>

байтов на ячейку
<b>( latency </b>

мс 
<b>| limit</b>

размер
<b>) [ mpu </b>

размер
<b>[ peakrate</b>

скорость
<b>mtu</b>

байтов на ячейку
<b>] ]</b>


burst можно заменить на buffer или maxburst. mtu можно заменить на minburst.
<a name="lbAD">&nbsp;</a>
<h2>ОПИСАНИЕ</h2>

<p>
Фильтр Token Bucket является безклассовой очередью для управления трафиком командой
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=tc&amp;category=8">tc</a></b>(8)<b>.</b>

</p><p>
TBF является простой очередью и не планирует трафик. Пакеты помещаются в очередь, 
пока не будет достигнут определенный размер очереди, который затем передается на обработку (но
происходит некоторая задержка данных, т.к. происходит ожидание необходимого
количества пакетов для поддержания постоянной скорости передачи). Если же
скорость превышает заданную, то "лишние" пакеты просто отбрасываются.
На всех платформах (кроме Alpha) позволяет обрабатывать более 1 мбит/с обычного трафика 
с минимальной задержкой, отправляя данные точно с заданной скоростью. 
</p><p>
Более высокая скорость поддерживается, но задержка на обработку увеличивается. В этом случае 
данные из очереди отправляются с заданной скоростью, но возможно увеличение скорости на 
несколько миллисекунд. Поскольку пакеты отправляются в очередь сетевого адаптера, часто 
это не является проблемой.
</p><p>
Ядра с высоким 'HZ' могут обрабатывать высокие скорости с минимальной задержкой. На платформе 
Alpha HZ в десять раз выше, что позволяет ограничивать скорость до 10 мбит/с с приемлемой задержкой.
Эти условия достижимы для пакетов с размером около 1000 байтов.
</p><p>
<a name="lbAE">&nbsp;</a>
</p><h2>АЛГОРИТМ</h2>

Как ясно из имени, трафик фильтруется на базе
<b>токенов .</b>

Токены грубо соответствуют байтам, однако любой пакет содержит несколько токенов 
безотносительно от размера пакета.
Это необходимо для отражения того факта, что даже пустой пакет занимает канал при передаче.
<p>
При создании TBF для очереди накапливаются токены, отражающие объем помещённого в очередь трафика. 
Токены прибывают с постоянной скоростью до тех пор, пока буфер не окажется полон.
</p><p>
Если нужное количество токенов недоступно, пакеты, не добирающие заданную скорость, помещаются в очередь. После этого вычисляется дефицит токенов и очередь замораживается до тех пор, когда отправляется первый пакет из очереди.
</p><p>
Если ограничена передача пакетов с максимальной скоростью, должна быть настроена пиковая скорость (peakrate)
для ограничения скорости, при достижении которой очищается буфер. Ограничение пиковой скорости реализовано в виде второго 
TBF с очень маленьким буфером.
</p><p>
Для достижения приемлемой задержки второй буфер может содержать только один пакет, который соответствует 
вышеупомянутому пределу в 1 мбит/с. 
</p><p>
Этот предел связан с минимальным временем, необходимым ядру для отправки в виде одного "мига", который зависит от 
HZ как 1/HZ. Для идеальной классификации только один пакет может быть отправлен в один "миг". Для HZ=100 это 
означает 100 пакетов по 1000 байтов, что приблизительно соответствует 1 мбит/с.
</p><p>
<a name="lbAF">&nbsp;</a>
</p><h2>ПАРАМЕТРЫ</h2>

См. 
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=tc&amp;category=8">tc</a></b>(8)

для указания единиц измерения значений.
<dl compact="">
<dt>limit или latency</dt><dd>
Limit (предел) - число байт, которые могут быть помещены в очередь для ожидания,
latency (латентность) - максимальное время, которое может провести пакет в очереди. 
Эти два параметра взаимно исключают друг друга.
</dd><dt>burst</dt><dd>
(buffer или maxburst).
длина буфера очереди в байтах, чем больше заданная скорость передачи, тем больше должен быть буфер данных. На платформе Intel для скорости 10 мбит/с потребуется буфер размером 1 кб.
<p>
Если буфер будет слишком маленький, лишние пакеты будут отбрасываться поскольку потребуется получить заданную скорость и для этого нужно набрать необходимое количество токенов. Минимальный размер буфера определяется делением заданного уровня скорости на HZ.
</p><p>
Подсчет токенов осуществляется по таблице, заполняемой при анализе 8 пакетов по умолчанию.
Это поведение может быть изменено указанием другого размера 
<b>ячейки (cell) .</b>

Например, для указания размера буфера в 6000 байт с 16-байтной ячейкой, установите burst как 6000/16.
</p></dd><dt>mpu</dt><dd>
минимальный размер пакета для помещения в очередь, пакеты меньшей
длины отбрасываются, для сетей ethernet каждый пакет должен быть больше 64 байт. По умолчанию - 0.
</dd><dt>rate</dt><dd>
заданный уровень скорости. См. примечания об ограничениях выше и 
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=tc&amp;category=8">tc</a></b>(8)

для обозначения единицы измерения.
</dd></dl>
<p>

Если потребуется указать максимальную скорость передачи пакетов, используйте следующие параметры:
</p><p>
</p><dl compact="">
<dt>peakrate</dt><dd>
максимально возможная скорость передачи пакетов из очереди в
интерфейс, по умолчанию 1 мбит/с на Intel, 10 мбит/с на Alpha. 
Обычно не требуется устанавливать.
<p>
</p></dd><dt>mtu/minburst</dt><dd>
размер буфера максимальной скорости. Должен быть равен MTU интерфейса. Буфер в 3000 байт позволяет установить максимальную скорость передачи в 3 мбит/с (отправка 1000-байтовых пакетов).
<p>
Так и burstsize, вы можете установить размер
<b>ячейки (cell) .</b>

</p></dd></dl>
<a name="lbAG">&nbsp;</a>
<h2>ПРИМЕР</h2>

<p>
Для установки очереди с гарантированной скоростью 0,5 мбит/с, а максимальной скоростью
1,0 мбит/c, буфером в 5 кб, ограничивающей ожидание 70 мс и приемлемым временем задержки 
выполните:

# tc qdisc add dev eth0 root tbf rate 0.5mbit \
<br>&nbsp;&nbsp;burst&nbsp;5kb&nbsp;latency&nbsp;70ms&nbsp;peakrate&nbsp;1mbit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\
<br>&nbsp;&nbsp;minburst&nbsp;1540
</p><p>
<a name="lbAH">&nbsp;</a>
</p><h2>СМ. ТАКЖЕ</h2>

<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=tc&amp;category=8">tc</a></b>(8)

<p>
<a name="lbAI">&nbsp;</a>
</p><h2>АВТОРЫ</h2>

Алексей Кузнецов &lt;<a href="mailto:kuznet@ms2.inr.ac.ru">kuznet@ms2.inr.ac.ru</a>&gt;. man-страница сопровождается Бертом Хубертом (Bert Hubert) &lt;<a href="mailto:ahu@ds9a.nl">ahu@ds9a.nl</a>&gt;
<p>
<a name="lbAJ">&nbsp;</a>
</p><h2>ПЕРЕВОД</h2>

Андрей Черепанов &lt;<a href="mailto:cas@altlinux.ru">cas@altlinux.ru</a>&gt; 2007
<p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">ИМЯ</a></dt><dd>
</dd><dt><a href="#lbAC">СИНТАКСИС</a></dt><dd>
</dd><dt><a href="#lbAD">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAE">АЛГОРИТМ</a></dt><dd>
</dd><dt><a href="#lbAF">ПАРАМЕТРЫ</a></dt><dd>
</dd><dt><a href="#lbAG">ПРИМЕР</a></dt><dd>
</dd><dt><a href="#lbAH">СМ. ТАКЖЕ</a></dt><dd>
</dd><dt><a href="#lbAI">АВТОРЫ</a></dt><dd>
</dd><dt><a href="#lbAJ">ПЕРЕВОД</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="tc-tbf" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
