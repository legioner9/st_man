
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN vinum (8) Команды системного администрирования (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, vinum"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="vinum" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">vinum (8)</font><hr><li> <a href="/man.shtml?topic=vinum&amp;category=4&amp;russian=1"><u>vinum</u></a> (4) <font color="#555555"> ( FreeBSD man: Специальные файлы /dev/* )</font></li><li> <a href="/man.shtml?topic=vinum&amp;category=4&amp;russian=0"><u>vinum</u></a> (4) <font color="#555555"> ( Русские man: Специальные файлы /dev/* )</font></li><li>&gt;&gt; <a href="/man.shtml?topic=vinum&amp;category=8&amp;russian=0"><u>vinum</u></a> (8) <font color="#555555"> ( Русские man: Команды системного администрирования )</font></li>
<table width="100%" border="0">
<tbody><tr>
<td><h1>vinum(8)</h1></td>
<td><h2 align="center">Руководство системного администратора FreeBSD</h2></td>
<td><h1 align="right">vinum(8)</h1></td>
</tr>
</tbody></table>

<h2><a name="name">НАЗВАНИЕ</a></h2>

<p><b>vinum</b> - программа управления диспетчером логических томов (Logical Volume Manager)</p>

<h2><a name="synopsis">СИНТАКСИС</a></h2>
<dl><dt></dt><dd><tt>
vinum [<b>команда</b>] [-<b>опции</b>]
</tt></dd></dl>

<h2><a name="commands">КОМАНДЫ</a></h2>

<dl>
<dt><b><a name="attach">attach <i>сплетение</i> <i>том</i> [rename]</a></b><a name="attach"><br>
<b>attach <i>поддиск сплетение</i> [<i>смещение</i>] [rename]</b></a></dt><dd>
Подключает <i>сплетение</i> (plex) к <i>тому</i> (volume) или <i>поддиск</i> (subdisk) к сплетению.
<br><br></dd>
<dt><b><a name="checkparity">checkparity <i>сплетение</i> [-f] [-v]</a></b></dt><dd>
Проверяет блоки четности в <b>сплетении</b> RAID-4 или RAID-5.
<br><br></dd>
<dt><b><a name="concat">concat [-f] [-n <i>имя</i>] [-v] <i>диски</i></a></b></dt><dd>
Создает конкатенированный том из указанных <b>дисков.</b>
<br><br></dd>
<dt><b><a name="create">create [-f] <i>файл_описания</i></a></b></dt><dd>
Создает том как указано в <b>файле описания</b>.
<br><br></dd>
<dt><b><a name="debug">debug</a></b></dt><dd>
Вызывает вход диспетчера томов в режим отладчика ядра.
<br><br></dd>
<dt><b><a name="debug_flags">debug <i>флаги</i></a></b></dt><dd>
Устанавливает флаги отладки.
<br><br></dd>
<dt><b><a name="detach">detach [-f] [<i>сплетение</i> | <i>поддиск</i>]</a></b></dt><dd>
Отключает сплетение или поддиск от тома или сплетения, к которому он подключен.
<br><br></dd>
<dt><b><a name="dumpconfig">dumpconfig [<i>диск</i> ...]</a></b></dt><dd>
Выдает информацию о конфигурации, хранящуюся на указанных дисках или на всех дисках
в системе, если имена дисков не указаны.
<br><br></dd>
<dt><b><a name="info">info [-v] [-V]</a></b></dt><dd>
Выдает информацию о состоянии диспетчера томов.
<br><br></dd>
<dt><b><a name="init">init [-S <i>размер</i>] [-w] <i>сплетение</i> | <i>поддиск</i></a></b></dt><dd>
Инициализирует нулями содержимое <b>поддиска</b> или всех поддисков <b>сплетения</b>.
<br><br></dd>
<dt><b><a name="label">label том</a></b></dt><dd>
Создает метку тома.
<br><br></dd>
<dt><b><a name="list">l | list [-r] [-s] [-v] [-V] [<i>том</i> | <i>сплетение</i> | <i>поддиск</i>]</a></b></dt><dd>
Выдает информацию об указанных объектах.
<br><br></dd>
<dt><b><a name="ld">ld [-r] [-s] [-v] [-V] [<i>том</i>]</a></b></dt><dd>
Выдает информацию о дисках.
<br><br></dd>
<dt><b><a name="ls">ls [-r] [-s] [-v] [-V] [<i>поддиск</i>]</a></b></dt><dd>
Выдает информацию о <b>поддисках</b>.
<br><br></dd>
<dt><b><a name="lp">lp [-r] [-s] [-v] [-V] [<i>сплетение</i>]</a></b></dt><dd>
Выдает информацию о <b>сплетениях</b>.
<br><br></dd>
<dt><b><a name="lv">lv [-r] [-s] [-v] [-V] [<i>том</i>]</a></b></dt><dd>
Выдает информацию о <b>томах</b>.
<br><br></dd>
<dt><b><a name="makedev">makedev</a></b></dt><dd>
Пересоздает файлы устройств в каталоге <b>/dev/vinum</b>.
<br><br></dd>
<dt><b><a name="mirror">mirror [-f] [-n <i>имя</i>] [-s] [-v] <i>диски</i></a></b></dt><dd>
Создает зеркальный том из указанных <b>дисков</b>.
<br><br></dd>
<dt><b><a name="move">move | mv -f <i>диск</i> <i>объект</i> ...</a></b></dt><dd>
Переносит объекты на указанный диск.
<br><br></dd>
<dt><b><a name="printconfig">printconfig [<i>файл</i>]</a></b></dt><dd>
Записывает копию текущей конфигурации в <b>файл</b>.
<br><br></dd>
<dt><b><a name="quit">quit</a></b></dt><dd>
Завершает работу утилиты <b>vinum</b> в интерактивном режиме. Обычно это происходит при
вводе символа конца файла (EOF).
<br><br></dd>
<dt><b><a name="read">read <i>диск</i> ...</a></b></dt><dd>
Читает конфигурацию <b>vinum</b> с указанных <b>дисков</b>.
<br><br></dd>
<dt><b><a name="rename">rename [-r] [<i>диск</i> | <i>поддиск</i> | <i>сплетение</i> | <i>том</i>] <i>новое_имя</i></a></b></dt><dd>
Переименовывает указанный объект.
<br><br></dd>
<dt><b><a name="rebuildparity">rebuildparity <i>сплетение</i> [-f] [-v] [-V]</a></b></dt><dd>
Пересоздает блоки четности сплетения типа RAID-4 или RAID-5.
<br><br></dd>
<dt><b><a name="resetconfig">resetconfig</a></b></dt><dd>
Сбрасывает полную конфигурацию <b>vinum</b>.
<br><br></dd>
<dt><b><a name="resetstats">resetstats [-r] [<i>том</i> | <i>сплетение</i> | <i>поддиск</i>]</a></b></dt><dd>
Сбрасывает статистические счетчики для указанных объектов или для всех объектов,
если ни один не указан.
<br><br></dd>
<dt><b><a name="rm">rm [-f] [-r] <i>том</i> | <i>сплетение</i> | <i>поддиск</i></a></b></dt><dd>
Удаляет объект.
<br><br></dd>
<dt><b><a name="saveconfig">saveconfig</a></b></dt><dd>
Сохраняет конфигурацию <b>vinum</b> на диск после сбоев конфигурации.
<br><br></dd>
<dt><b><a name="setdaemon">setdaemon [<i>значение</i>]</a></b></dt><dd>
Устанавливает конфигурацию демона.
<br><br></dd>
<dt><b><a name="setstate">setstate состояние [<i>том</i> | <i>сплетение</i> | <i>поддиск</i> | <i>диск</i>]</a></b></dt><dd>
Устанавливает <b>состояние</b>, не влияя на другие объекты, только в диагностических целях.
<br><br></dd>
<dt><b><a name="start">start</a></b></dt><dd>
Читает конфигурацию со всех дисков <b>vinum</b>.
<br><br></dd>
<dt><b><a name="starts_with_params">start [-i <i>интервал</i> [-S <i>размер</i>] [-w] <i>том</i> | <i>сплетение</i> | <i>поддиск</i></a></b></dt><dd>
Позволяет системе обращаться к объектам
<br><br></dd>
<dt><b><a name="stop">stop [-f] [<i>том</i> | <i>сплетение</i> | <i>поддиск</i>]</a></b></dt><dd>
Прекращает доступ к объектам или останавливает <b>vinum</b>, если параметры не указаны.
<br><br></dd>
<dt><b><a name="stripe">stripe [-f] [-n <i>имя</i>] [-v] <i>диски</i></a></b></dt><dd>
Создает том с чередованием из указанных <b>дисков</b>.</dd>
</dl>

<h2><a name="description">ОПИСАНИЕ</a></h2>

<p>Утилита <b>vinum</b> взаимодействует с компонентом ядра диспетчерра логических томов 
Vinum. Утилита предназначена либо для интерактивного использования, если запущена
без аргументов командной строки, либо для выполнения одной переданной в командной
строке команды. В интерактивном режиме утилита <b>vinum</b> сохрраняет хронологию
выполнения команд.</p>

<h2><a name="options">ОПЦИИ</a></h2>

<p>После команд <b>vinum</b> могут указываться необязательные опции. Любую из следующих
опций можно указывать для любой команды, но в некоторых случаях опции игнорируются.
Например, команда <a href="#stop"><b>stop</b></a> игнорирует опции 
<a href="#v"><b>-v</b></a> и <a href="#V"><b>-V</b></a>.</p>

<dl>
<dt><b><a name="f">-f</a></b></dt><dd>
Опция <b>-f</b> ("force") отменяет проверки защиты. Эту опцию надо использовать крайне
осторожно. Эта опция предназначена только для критических случаев. Например, команда
<dl><dt></dt><dd><tt>
rm -f myvolume
</tt></dd></dl>
удаляет том <b>myvolume</b>, даже если он открыт.  Любой последующий доступ к этому
тому почти наверрняка вызовет панику в системе.
<br><br></dd>
<dt><b><a name="i">-i миллисекунд</a></b></dt><dd>
При выполнении команд <a href="#init&quot;"><b>init</b></a> и <a href="#start&quot;"><b>start</b></a>,
ожидать указанное количество миллисекунд между копированиями каждого блока. Это
уменьшает нагрузку на систему.
<br><br></dd>
<dt><b><a name="n">-n имя</a></b></dt><dd>
Используйте опцию <b>-n</b> для указания имени тома в простых командах конфигурации
<a href="#concat"><b>concat</b></a>, <a href="#mirror&quot;"><b>mirror</b></a> и 
<a href="#stripe"><b>stripe</b></a>.
<br><br></dd>
<dt><b><a name="r">-r</a></b></dt><dd>
Опция <b>-r</b> ("recursive") используется в командах <a href="#list"><b>list</b></a> 
для выдачи информации не только об указанных объектах, но и о входящих в них объектах.
Например, при указании в команде <a href="#lv"><b>lv</b></a>, опция <b>-r</b>
позволит также получить информацию о сплетениях и поддисках, принадлежащих тому.
<br><br></dd>
<dt><b><a name="s">-s</a></b></dt><dd>
Опция <b>-s</b> ("statistics") используется в командах <a href="#list"><b>list</b></a>
для выдачи статистической информации. В команде <a href="#mirror"><b>mirror</b></a>
эта опция используется для указания того, что необходимо создавать сплетения с
чередованием.
<br><br></dd>
<dt><b><a name="S">-S размер</a></b></dt><dd>
Опция <b>-S</b> задает размер (transfer size) для команд <a href="#init"><b>init</b></a>
и <a href="#start"><b>start</b></a>.
<br><br></dd>
<dt><b><a name="v">-v</a></b></dt><dd>
Опция <b>-v</b> ("verbose") может использоваться для запроса более подробной информации.
<br><br></dd>
<dt><b><a name="V">-V</a></b></dt><dd>
Опция <b>-V</b> ("Very verbose") может использоваться для запроса еще более подробной
информации, чем выдает опция <b>-v</b>.
<br><br></dd>
<dt><b><a name="w">-w</a></b></dt><dd>
Опция <b>-w</b> ("wait") требует от утилиты <b>vinum</b> дожидаться завершения
команд, которые обычно работают в фоновом режиме, например, 
<a href="#init"><b>init</b></a>.</dd>
</dl>

<h2><a name="commands_in_details">ДЕТАЛЬНОЕ ОПИСАНИЕ КОМАНД</a></h2>

<p>Команды <b>vinum</b> выполняют следующие функции:</p>

<dl>
<dt><b>attach сплетение том [rename]</b><br>
<b>attach поддиск сплетение [смещение] [rename]</b></dt><dd>
Команда <b>vinum attach</b> вставляет указанное сплетение или поддиск в том или
сплетение, соответственно. В случае поддиска, можно указать <b>смещение</b> 
в сплетении. Если смещение не задано, поддиск будет добавлен в первое подходящее
место. После подключения сплетения к непустому тому, утилита <b>vinum</b> 
реинтегрирует сплетение.

<p>Если указано ключевое слово <b>rename</b>, утилита <b>vinum</b> переименовывает
объект (и, в случае сплетения, любые входящие в него поддиски) в соответствии со
стандартными соглашениями по именованию <b>vinum</b>. Для переименования объекта с
присвоением нестандартного имени испольуйте команду <a href="#rename"><b>rename</b></a>.</p>

<p>При подключении поддисков следует учитывать несколько соображений:</p>
<ul>
<li>Поддиски обычно можно подключать только к конкатенированным сплетениям.</li>
<li>Если в сплетении RAID-5 с чередованием не хватает поддиска (например, после
сбоя диска), его следует заменять только поддиском такого же размера.</li>
<li>Для добавления дополнительных поддисков к спелетению с чередованием или
типа RAID-5, используйте опцию <a href="#f"><b>-f</b></a>. В результате,
даннЁе в сплетении будут повреждены.</li>
<li>Для конкатенированных сплетений параметр <b>смещение</b> задает смещение в
блоках от начала сплетения. Для сплетений типа RAID-5 с чередованием он задает
смещение первого блока поддиска: другими словами, смещение представляет собой
числовую позицию поддиска, умноженную на размер полосы. Например, в сплетении с
размером полосы 271 Кбайт первый поддиск будет иметь смещение 0, второй -
смещение 271 Кбайт, третий - 542 Кбайта и т.д. В этом вычислении блоки четности в
спллетениях типа RAID-5 игнорируются.</li>
</ul>
</dd>
<dt><b>checkparity сплетение [-f] [-v]</b></dt><dd>
Проверяет блоки четности в указанном сплетении типа RAID-4 или RAID-5.
Эта операция поддерживает указатель в сплетении, так что проверку, при 
необходимости, можно остановить и затем возобновить с той же позиции.
Кроме того, этот указатель используется командой 
<a href="#rebuildparity"><b>rebuildparity</b></a>, поэтому пересоздание
блоков четности нужно будет начинать только с места, где выявлена первая
проблема четности. Если указан флаг <b>-f</b>, команда <b>checkparity</b> 
начинает проверку с начала сплетения. Если указан флаг <b>-v</b>, <b>checkparity</b>
выдает отчет о работе процесса.
<br><br></dd>
<dt><b>concat [-f] [-n имя] [-v] диски</b></dt><dd>
Команда <b>concat</b> предлагает упрощенную альтернативу команде <b>create</b>
при счоздании томов из одного конкатенированного сплетения. Наибольший
фрагмент свободного места на каждом <b>диске</b> используется для создания
поддисков, составляющих сплетение.

<p>Обычно команда <b>concat</b> устанавливает для тома и его компонентов
произвольные имена. Имя состоит из слова "<b>vinum</b>" и небольшого целого числа,
например, "<b>vinum3</b>". Можно задать <b>имя</b> для тома явно с помощью 
опции <b>-n <i>имя</i></b>. Имена сплетений и поддисков строятся стандартно на базе
имени соответствующего тома.</p>

<p>Для дисков имена задавать нельзя. Если диски были проинициализированы 
как диски <b>vinum</b>, имя остается. В противном случае, диски получают имена, 
состоящие из слова "<b>vinumdrive</b>" и небольшого целого числа, например,
"<b>vinumdrive7</b>". Как и для команды <b>create</b>, опцию <b>-f</b> можно 
использовать для переопределения ранее данного имени. Опция <b>-v</b> используется
для получения подробных результатов.</p>

<p>Примеры использования этой команды см. в разделе 
"<a href="simplified_configuration"><b>УПРОЩЕННОЕ КОНФИГУРИРОВАНИЕ</b></a>" ниже.</p>
</dd>
<dt><b>create [-f] файл_описания</b></dt><dd>
Команда <b>vinum create</b> используется для создания любого объекта. С учетом
достаточно сложных взаимосвязей и потенциальных опасностей прри создании объекта
<b>vinum</b>, в интерактивном интерфейсе эта функция недоступна. Если имя файла
не указано, команда <b>vinum</b> открывает временный файл в редакторе. Если
установлена переменная среды <b>EDITOR</b>, утилита <b>vinum</b> запускает указанный в
ней редактор. Если же нет, запускается стандартный редактор <b>vi</b>. Подробнее
о формате <b>файла описания</b> см. в разделе 
"<a href="#configuration_file"><b>ФАЙЛ КОНФИГУРАЦИИ</b></a>" ниже.

<p>Учтите, что функция <b>vinum create</b> - аддитивна: если выполнить ее несколько раз,
будет создано несколько экземпляров всех неименованных объектов.</p>

<p>Обычно команда <b>create</b> не будет изменять имена существующих дисков <b>vinum</b>, чтобы
случайно не стереть их. Корректный способ удалить не нужные более диски <b>vinum</b>&nbsp;- сбросить
конфигурацию с помощью команды <b><a href="#resetconfig">resetconfig</a></b>. В некоторых случаях,
однако, может потребоваться создать новые данные на дисках <b>vinum</b>, которые не удается запустить.
В этом случае используйте команду <b>create -f</b>.</p>
</dd>
<dt><b>debug</b></dt><dd>
Команда <b>vinum debug</b> без параметров используется для входа в удаленный отладчик ядра (remote
kernel debugger). Она срабатывает только если <b>vinum</b> собран с опцией <b>VINUMDEBUG</b>. Эта
опция остановит работу операционной системы, пока не завершится работа отладчика ядра. Если установлена
удаленная отладка, а удаленное подключение к отладчику ядра организовать не получается, для выхода
из режима отлади придется перезагрузить систему.
<br><br></dd>
<dt><b>debug флаги</b></dt><dd>
Устанавливает битовую маску внутренних флагов отладки. Эти флаги могут меняться без уведомления по
ходу развития продукта; уточните их значения в заголовочном файле <b>&lt;sys/dev/vinumvar.h&gt;</b>. Битовая
маска строится из следующих значений:
<dl>
<dt><b>DEBUG_ADDRESSES</b> (<b>1</b>)</dt><dd>
Показывать информацию буфера в ходе запросов.
<br><br></dd>
<dt><b>DEBUG_RESID</b> (<b>4</b>)</dt><dd>
Перейти в отладчик в <b>complete_rqe()</b>.
<br><br></dd>
<dt><b>DEBUG_LASTREQS</b> (<b>8</b>)</dt><dd>
Поддерживать циклический буфер последних запросов.
<br><br></dd>
<dt><b>DEBUG_REVIVECONFLICT</b> (<b>16</b>)</dt><dd>
Выдавать информацию о <i>конфликтах восстановления</i> (revive conflicts).
<br><br></dd>
<dt><b>DEBUG_EOFINFO</b> (<b>32</b>)</dt><dd>
Выдавать информацию о внутреннем состоянии при возврате символа конца файла (EOF) со
сплетения с чередованием (striped plex).
<br><br></dd>
<dt><b>DEBUG_MEMFREE</b> (<b>64</b>)</dt><dd>
Поддерживать циклический список последних освобожденных подсистемой выделения памяти (memory allocator)
областей памяти.
<br><br></dd>
<dt><b>DEBUG_REMOTEGDB</b> (<b>256</b>)</dt><dd>
Перейти в удаленный отладчик <b>gdb</b> при выполнении команды <b>debug</b>.
<br><br></dd>
<dt><b>DEBUG_WARNINGS</b> (<b>512</b>)</dt><dd>
Выдавать ряд предупреждений о несущественных проблемах в реализации.</dd>
</dl>
</dd>
<dt><b>detach [-f] сплетение</b><br>
<b>detach [-f] поддиск</b></dt><dd>
Команда <b>vinum detach</b> удаляет (отключает) указанное <b>сплетение</b> или <b>поддиск</b> из тома или 
сплетения, к которому он подключен. Если удаление объекта приводит к нарушению целостности данных 
тома, операция не сработает, если только не указана опция <b>-f</b>. Если имя объекта строится на 
базе объекта, в который он входит (например, поддиск <b>vol1.p7.s0</b>, подключенный к сплетению 
<b>vol1.p7</b>), имя будет изменено путем добавления префикса "<b>ex-</b>" (например, 
<b>ex-vol1.p7.s0</b>). При необходимости, имя в процессе будет усечено.

<p>Команда <b>detach</b> не уменьшает количество поддисков в сплетении с чередованием или типа RAID-5.
Вместо этого поддиск помечается как отсутствующий и может быть в дальнейшем заменен с помощью команды
<b>attach</b>.</p>
</dd>
<dt><b>dumpconfig [диск ...]</b></dt><dd>
Команда <b>vinum dumpconfig</b> выдает информацию о конфигурации, хранящуюся на указанных дисках. Если
имена дисков не указаны, команда <b>dumpconfig</b> просматривает все диски в системе в поисках разделов 
Vinum, и сбрасывает находящуюся на них информацию. Если изменения конфигурации отключены, может оказаться, 
что эта информация не совпадает с выдаваемой командой <a href="#list"><b>list</b></a>. Эта команда
используется, в основном, для сопровождения и отладки.
<br><br></dd>
<dt><b>info</b></dt><dd>
Команда <b>vinum info</b> выдает информацию об использовании памяти драйвером <b>vinum</b>. Она
предназначена, в основном, для отладки. При указании опции <b>-v</b> она будет выдавать детальную
информацию об используемых областях памяти.

<p>При указании опции <b>-V</b> команда <b>info</b> выдает информацию о последних (до 64)
запросах ввода-вывода, обработанных драйвером <b>vinum</b>. Эта информация собирается, только
если установлен флаг отладки 8. Информация выдается в следующем формате:</p>

<pre>vinum -&gt; info -V
Flags: 0x200    1 opens
Total of 38 blocks malloced, total memory: 16460
Maximum allocs:   56, malloc table at 0xf0f72dbc

Time			 Event		 Buf		Dev     Offset		Bytes   SD      SDoff   Doffset Goffset

14:40:00.637758 1VS Write 0xf2361f40    91.3  0x10			16384
14:40:00.639280 2LR Write 0xf2361f40    91.3  0x10			16384
14:40:00.639294 3RQ Read  0xf2361f40    4.39   0x104109		 8192    19		0		0		0
14:40:00.639455 3RQ Read  0xf2361f40    4.23   0xd2109		 8192    17		0		0		0
14:40:00.639529 3RQ Read  0xf2361f40    4.15   0x6e109		 8192    16		0		0		0
14:40:00.652978 4DN Read  0xf2361f40    4.39   0x104109		 8192    19		0		0		0
14:40:00.667040 4DN Read  0xf2361f40    4.15   0x6e109		 8192    16		0		0		0
14:40:00.668556 4DN Read  0xf2361f40    4.23   0xd2109		 8192    17		0		0		0
14:40:00.669777 6RP Write 0xf2361f40    4.39   0x104109		 8192    19		0		0		0
14:40:00.685547 4DN Write 0xf2361f40    4.39   0x104109		 8192    19		0		0		0
11:11:14.975184 Lock      0xc2374210    2	   0x1f8001
11:11:15.018400 7VS Write 0xc2374210		   0x7c0		32768	 10
11:11:15.018456 8LR Write 0xc2374210    13.39  0xcc0c9	    32768
11:11:15.046229 Unlock    0xc2374210    2	   0x1f8001
</pre>

<p>Поле <b>Buf</b> всегда содержит адрес заголовка пользовательского буфера. Его можно
использовать для идентификации запроса, связанного с пользовательским запросом, хотя это
и не на 100% надежно: теоретически, два последовательных запроса могут использовать
один и тот же заголовок буфера, хотя это и нетипично. Начало запроса идентифицируется
значениями <b>1VS</b> или <b>7VS</b> в поле <b>Event</b>. Первый представленный выше пример
показывает запросы драйвера, связанные с выполнением запроса пользователя. Второй 
пример&nbsp;- запрос ввода-вывода поддиска с блокировкой.</p>

<p>Поле <b>Event</b> содержит информацию, связанную с последовательностью событий
в цепочке выполнения запроса (request chain). Цифры от 1 до 6 показывают приблизительную 
последовательность событий, а двухбуквенное сокращение описывает действие:</p>

<dl>
<dt><b>1VS</b></dt><dd>
(<b>vinumstrategy</b>) показывает информацию о пользовательском запросе
при входе в <b>vinumstrategy()</b>. Номер устройства определяет устройство
<b>vinum</b>, а смещение и длина - это пользовательские параметры. С такой записи
всегда начинается последовательность выполнения запроса.
<br><br></dd>
<dt><b>2LR</b></dt><dd>
(<b>launch_requests</b>) показывает пользовательский запрос непосредственно перед
выполнением низкоуровневых запросов <b>vinum</b> в функции <b>launch_requests()</b>.
Параметры должны быть такими же, как и в записи <b>1VS</b>.</dd>
</dl>

<p>В следующих запросах <b>Dev</b> - номер устройства соответствующего раздела
диска, <b>Offset</b> - смещение от начала раздела, <b>SD</b> - индекс поддиска
в <b>vinum_conf</b>, <b>SDoff</b> - смещение от начала поддиска, <b>Doffset</b> -
смещение соответствующего запроса данных, а <b>Goffset</b> - смещение
соответствующего запроса группы, если оно необходимо.</p>

<dl>
<dt><b>3RQ</b></dt><dd>
(<b>request</b>) показывает один из, возможно, нескольких низкоуровневых запросов
<b>vinum</b>, выполненных для удовлетворения запроса верхнего уровня. Эта информация
также регистрируется в <b>launch_requests()</b>.
<br><br></dd>
<dt><b>4DN</b></dt><dd>
(<b>done</b>) вызывается из <b>complete_rqe()</b>, показывая завершение запроса. Это
завершение должно соответствовать запросу, инициированному либо на стадии <b>4DN</b> из
функции <b>launch_requests()</b>, либо из функции <b>complete_raid5_write()</b> на стадии <b>5RD</b>
или <b>6RP</b>.
<br><br></dd>
<dt><b>5RD</b></dt><dd>
(<b>RAID-5 data</b>) вызывается из функции <b>complete_raid5_write()</b> и представляет 
данные, записанные на полосу данных массива RAID-5 после вычисления четности.
<br><br></dd>
<dt><b>6RP</b></dt><dd>
(<b>RAID-5 parity</b>) вызывается из функции <b>complete_raid5_write()</b> и представляет
данные, записанные на <i>полосу четности</i> (parity stripe) массива RAID-5 после вычисления
четности.
<br><br></dd>
<dt><b>7VS</b></dt><dd>
Показывает запрос ввода/вывода для поддиска. Эти запросы, обычно, являются внутренними для
драйвера <b>vinum</b> и используются для операций типа инициализации или пересоздания сплетений.
<br><br></dd>
<dt><b>8LR</b></dt><dd>
Показывает низкоуровневую операцию, сгенерированную для запроса ввода/вывода для поддиска.
<br><br></dd>
<dt><b>Lockwait</b></dt><dd>
Указывает, что процесс ждет <i>блокировки диапазона</i> (range lock). Параметрами являются
заголовок буфера, соответствующего запросу, номер сплетения и номер блока. Из внтуренних 
соображений номер блока - на единицу больше, чем адрес начала полосы.
<br><br></dd>
<dt><b>Lock</b></dt><dd>
Указывает, что была получена блокировка диапазона. Параметры такие же, как и для
ожидания блокировки диапазона.
<br><br></dd>
<dt><b>Unlock</b></dt><dd>
Указывает, что блокировка диапазона была снята. Параметры такие же, как и для
ожидания блокировки диапазона.</dd>
</dl>
</dd>
<dt><b>init [-S размер] [-w] сплетение | поддиск</b></dt><dd>
Команда <b>vinum init</b> инициализирует поддиск путем записи на него нулей.
Можно инициализировать все поддиски в сплетении, указав имя сплетения.
Это - единственный способ гарантировать согласованность данных в сплетении.
Эту инициализацию необходимо выполнять до начала использования сплетения типа RAID-5.
Ее также рекомендуется выполнять и для других новых сплетений. Утилита <b>vinum</b>
инициализирует все поддиски сплетения параллельно. Поскольку это действие может
потребовать много времени, оно обычно выполняется в фоновом режиме. Если необходимо
подождать завершения команды, используйте опцию <b>-w</b> (wait).

<p>Укажите опцию <b>-S</b>, если необходимо записывать блоками нестандартного 
(отличающегося от 16 Кбайт) размера. Утилита <b>vinum</b> выдает сообщение на консоль 
по завершении инициализации.</p>
</dd>
<dt><b>label том</b></dt><dd>
Команда <b>label</b> записывает на том метку тома в стиле <b>ufs</b>. Это - простая 
альтернатива соответствующему вызову утилиты <b>disklabel</b>. Ее выполнение необходимо
потому, что некоторые команды <b>ufs</b> по-прежнему читают диск в поисках метки вместо того,
чтобы выполнять соответствующий вызов <a href="ioctl2.htm"><b>ioctl(2)</b></a> для доступа к
ней. Драйвер <b>vinum</b> хранит метку тома отдельно от данных тома, так что эта
команда не нужна для <a href="newfs8.htm"><b>newfs(8)</b></a>. Использовать эту команду не 
рекомендуется.
<br><br></dd>
<dt><b>list [-r] [-V] [том | сплетение | поддиск]<br>
l [-r] [-V] [том | сплетение | поддиск]<br>
ld [-r] [-s] [-v] [-V] [том]<br>
ls [-r] [-s] [-v] [-V] [поддиск]<br>
lp [-r] [-s] [-v] [-V] [сплетение]<br>
lv [-r] [-s] [-v] [-V] [том]</b></dt><dd>
Команда <b>list</b> используется для получения информации об указанном объекте. Если аргумент
не указан, выдается информация о всех объектах, известных драйверу <b>vinum</b>. Команда <b>l</b>&nbsp;-
синоним для <b>list</b>.

<p>Опция <b>-r</b> относится к томам и сплетениям: если она указана, то рекурсивно выдает
информацию для поддисков и (для тома) сплетений, составляющих объекты. Команды
<b>lv</b>, <b>lp</b>, <b>ls</b> и <b>ld</b> выдают только тома, сплетения,
поддиски и диски, соответственно. Они особенно полезны при вызове без параметров.</p>

<p>Опция <b>-s</b> вызывает выдачу утилитой <b>vinum</b> статистической информации по 
устройствам, опция <b>-v</b> (verbose) приводит к выдаче определенной дополнительной информации,
а опция <b>-V</b> обеспечивает выдачу существенного объема дополнительной информации.</p>
</dd>
<dt><b>makedev</b></dt><dd>
Команда <b>makedev</b> удаляет каталог <b>/dev/vinum</b> и пересоздает его вместе со
специальными файлами устройств, отражающими текущую конфигурацию. Эта команда не
предназначена для общего использования и должна использоваться только в критических
ситуациях.
<br><br></dd>
<dt><b>mirror [-f] [-n имя] [-s] [-v] диски</b></dt><dd>
Команда <b>mirror</b> является упрощенной альтернативой команде <b>create</b> при создании
зеркалированных томов. При вызове без опций она создает том типа RAID-1 (зеркалированный) из
двух конкатенированных сплетений. Самые большие фрагменты свободного места на каждом диске
используются для создания поддисков для сплетений. Первое сплетение строится из <b>дисков</b> 
в списке с нечетными номерами, а второе - из четных. Если диски&nbsp;- разного размера, то
и сплетения получатся разного размера.

<p>Если указана опция <b>-s</b>, команда <b>mirror</b> строит сплетения с чередованием,
с размером полосы 279 Кбайт. Размер поддисков в каждом сплетении соответствует 
размеру наименьшего фрагмента подряд идущего свободного места на всех дисках,
формирующих сплетение. И в этом случае рамзеры сплетений могут отличаться.</p>

<p>Обычно команда <b>mirror</b> автоматически создает имя для тома и его компонентов.
Это имя состоит из слова "<b>vinum</b>" и небольшого целого числа, например, "<b>vinum3</b>".
Это можно изменить с помощью опции <b>-n имя</b>, которая присваивает указанное <b>имя</b>
тому. Имена сплетений и поддисков строятся на основе имени тома стандартным образом.</p>

<p>Имена дисков выбирать нельзя. Если диски уже были проинициализированы как диски
<b>vinum</b>, их имена неизменны. В противном случае, диски получают имена, состоящие из
слова "<b>vinumdrive</b>" и небольшого целого числа, например, "<b>vinumdrive7</b>".
Как и в случае команды <b>create</b>, опция <b>-f</b> может использоваться для указания
того, что прежнее имя надо изменить. Опция <b>-v</b> используется для выдачи более
детальной информации.</p>

<p>Ряд примеров использования этой команды представлен в разделе 
"<b>УПРОЩЕННОЕ КОНФИГУРИРОВАНИЕ</b>" ниже.</p>
</dd>
<dt><b>mv -f диск объект ...<br>
move -f диск объект ...</b></dt><dd>
Переносит все поддиски указанных <b>объектов</b> на новый <b>диск</b>. Объектами могут
быть поддиски, диски или сплетения. Если указаны диски или сплетения, переносятся все
поддиски, связанные с этими объектами.

<p>Опция <b>-f</b> для этой функции необходима, поскольку в настоящее время она не
сохраняет данные на поддиске. Эта возможность будет добавлена в дальнейшем. Но и 
в нынешнем виде эта команда подходит для восстановления после сбоя диска.</p>
</dd>
<dt><b>printconfig [файл]</b></dt><dd>
Записывает копию текущей конфигурации в файл в формате, который можно использовать
для воссоздания конфигурации <b>vinum</b>. В отличие от хранящейся на диске
конфигурации, она включает определения дисков. Если <b>файл</b> не указан,
утилита <b>vinum</b> выдает информацию в стандартный выходной поток.
<br><br></dd>
<dt><b>quit</b></dt><dd>
Завершает работу утилиты <b>vinum</b> в интерактивном режиме. Обычно для этого достаточно
ввести символ конца файла (EOF).
<br><br></dd>
<dt><b>read диск ...</b></dt><dd>
Команда <b>read</b> сканирует указанные диски в поисках разделов <b>vinum</b>, содержащих
ранее созданную информацию о конфигурации. Она читает информацию о конфигурации, начиная
с последних изменений и до самых давних. Утилита <b>vinum</b> поддерживает актуальну копию
всей конфигурационной информации на каждом разделе диска. Необходимо указать все
<i>секции</i> (slices) в конфигурации в качестве параметра этой команды.

<p>Команда <b>read</b> предназначена для избирательной загрузки конфигурации <b>vinum</b> 
в системе, где есть другие разделы <b>vinum</b>. Если необходимо запустить все разделы в 
системе, проще использовать команду <b>start</b>.</p>

<p>Если по ходу выполнения этой команды утилитой <b>vinum</b> возникают любые ошибки, она
отключает автоматическое обновление конфигурации, чтобы предотвратить повреждение
копий на диске. Это также происходит, если в конфигурации на диске обнаруживается ошибка
(например, поддиски с недопустимой спецификацией занимаемого места). Изменения можно
возобновить с помощью команд <b>setdaemon</b> и <b>saveconfig</b>. Сбросьте бит 2
(числовое значение - 4) в маске опций демона, чтобы снова можно было сохранять изменения
конфигурации.</p>
</dd>
<dt><b>rebuildparity сплетение [-f] [-v] [-V]</b></dt><dd>
Пересоздает блоки четности для указанного сплетения типа RAID-4 или RAID-5.
Это действие поддерживает указатель на сплетение, так что его можно остановить и в дальнейшем
перезапустить с того же места, при необходимости. Кроме того, этот указатель используется
командой <b>checkparity</b>, поэтому пересоздание блоков четности можно будет начать с того
места, где выявлена первая проблема четности.

<p>Если указан флаг <b>-f</b>, команда <b>rebuildparity</b> начинает пересоздание с начала сплетения.
Если указан флаг <b>-v</b>, команда <b>rebuildparity</b> сначала проверяет существующие блоки
четности и выдает информацию о тех из них, которые оказались некорректными до пересоздания.
Если указан флаг <b>-V</b>, команда <b>rebuildparity</b> выдает отчет о ходе работы.</p>
</dd>
<dt><b>rename [-r] [диск | поддиск | сплетение | том] новое_имя</b></dt><dd>
Изменяет имя указанного объекта. Если указана опция <b>-r</b>, подчиненные объекты будут
переименовываться по стандартным правилам: имена сплетений будут строиться путем добавления 
<b>.номер_сплетения</b> к имени тома, а имена поддисков - путем добавления <b>.номер_поддиска</b>
к имени сплетения.
<br><br></dd>
<dt><b>resetconfig</b></dt><dd>
Команда <b>resetconfig</b> полностью сбрасывает конфигурацию <b>vinum</b> в системе. Используйте
эту команду только при необходимости полностью удалить конфигурацию. Утилита <b>vinum</b> 
попросит подтверждения; необходимо ввсести слова <b>NO FUTURE</b> как показано ниже:

<pre># vinum resetconfig

WARNING!  This command will completely wipe out your vinum
configuration.  All data will be lost.  If you really want
to do this, enter the text

NO FUTURE
Enter text -&gt; NO FUTURE
Vinum configuration obliterated
</pre>

<p>Как и сказано в сообщении, эта команда - жест отчаяния. Используйте ее, только если
хотите никогда больше не видеть существующую конфигурацию.</p>
</dd>
<dt><b>resetstats [-r] [том | сплетение | поддиск]</b></dt><dd>
Драйвер <b>vinum</b> поддерживает ряд статистических счтетчиков для каждого объекта.
Подробнее см. в заголовочном файле <b>&lt;sys/dev/vinumvar.h&gt;</b>. Команда resetstats
используется для сброса этих счетчиков. При указании опции <b>-r</b>, <b>vinum</b> также
сбрасывает счетчики подчиненных объектов.
<br><br></dd>
<dt><b>rm [-f] [-r] том | сплетение | поддиск</b></dt><dd>
Команда <b>rm</b> удаляет объект из конфигурации <b>vinum</b>. После удаления объекта восстановить его
нельзя. Обычно перед удалением объекта утилита <b>vinum</b> выполняет множество
проверок согласованности. Опция <b>-f</b> требует от <b>vinum</b> пропустить эти проверки и
удалить объект в любом случае. Используйте эту опцию очень осторожно: она может привсети к
полной потере данных тома.

<p>Обычно команда <b>vinum</b> отказывается удалять том или сплетение, если у него есть
подчиненные сплетения или поддиски, соответственно. Можно потребовать от <b>vinum</b> безусловного
удаления объекта с помощью опции <b>-f</b> или просто удалить все подчиненные объекты тоже с помощью
опции <b>-r</b> (recursive). При удалении тома с опцией <b>-r</b> будут удалены как сплетения, так 
и поддиски, принадлежащие сплетениям.</p>
</dd>
<dt><b>saveconfig</b></dt><dd>
Сохраняет текущую конфигурацию на диск. Обычно это не нужно, поскольку утилита <b>vinum</b> 
автоматически сохраняет любые изменения в конфигурации. Если при запуске возникапет ошибка,
обновления будут отключены. При их повторном включении с помощью команды <b>setdaemon</b>, 
<b>vinum</b> не сохраняет автоматически конфигурацию на диск. Используйте эту команду
для сохранения конфигурации.
<br><br></dd>
<dt><b>setdaemon [значение]</b></dt><dd>
Команда <b>setdaemon</b> устанавливает переменную битовую маску для демона <b>vinum</b>. Эта
команда - временная и будет заменена. В настоящее время битовая маска может содержать биты 1 
(регистрировать каждое действие с помощью <b>syslog</b>) и 4 (не обновлять конфигурацию).
Необязательный бит 4 может пригодиться при восстановлении после ошибки.
<br><br></dd>
<dt><b>setstate состояние [том | сплетение | поддиск | диск]</b></dt><dd>
Команда <b>setstate</b> устанавливает заданное <b>состояние</b> для указанных объектов. При этом
не используется обычный механизм проверки согласованности <b>vinum</b>, так что эту команду
следует использовать только для восстановления. Неправильное использование этой команды может
вызвать сбой системы.
<br><br></dd>
<dt><b>start [-i интервал] [-S размер] [-w] [сплетение | поддиск]</b></dt><dd>
Команда <b>start</b> запускает (переводит в работающее состояние) одини или несколько
объектов <b>vinum</b>.

<p>Если имена объектов не указаны, утилита <b>vinum</b> сканирует все известные системе
диски в поисках дисков <b>vinum</b>, а затем читает конфигурацию так, как было описано
для команды <b>read</b>. Диск <b>vinum</b> (vinum drive) содердите заголовок со всей
информацией о данных, хранящихся на диске, включая имена других дисков, которые
необходимы для представления сплетений и томов.</p>

<p>Если по ходу выполнения этой команды утилитой <b>vinum</b> будут обнаружены ошибки, 
она отключит автоматическое обновление конфигурации, чтобы избежать повреждения копий
на диске. То же самое произойдет, если конфигурация на диске содержит ошибку (например,
поддиски с недопустимой спецификацией занимаемого места). Изменения можно
возобновить с помощью команд <b>setdaemon</b> и <b>saveconfig</b>. Сбросьте бит 2
(числовое значение - 4) в маске опций демона, чтобы снова можно было сохранять изменения
конфигурации.</p>

<p>Если имена объектов указаны, утилита <b>vinum</b> запускает их. Обычно эту операцию
имеет смысл выполнять только для поддисков. Действие зависит от текущего состояния 
объекта:</p>

<ul>
<li>Если объект уже работает, утилита <b>vinum</b> ничего не делает.</li>
<li>Если объект является поддиском в состояниях <b>down</b> или <b>reborn</b>,
утлита <b>vinum</b> запускает его (меняет состояние на <b>up</b>).</li>
<li>Если объект является поддиском в состоянии <b>empty</b> (пуст), изменение
зависит от поддиска. Если он входит в сплетение, являющееся частью тома, в котором
есть и другие сплетения, утилита <b>vinum</b> переводит поддиск в состояние <b>reviving</b>
и пытается скопировать данные с тома. По завершении этой операции поддиск запускается. Если
же поддиск входит в сплетение, являющееся частью тома, в котором других сплетений
нет, или если он вообще не входит в сплетение, утилита <b>vinum</b> запускает его
немедленно.</li>
<li>Если объект является поддиском в состоянии <b>reviving</b>, утилита <b>vinum</b> 
продолжает его "оживление" в отключенном режиме. По завершении этой операции поддиск
запускается.</li>
</ul>

<p>Когда поддиск запускается (переводится в состояние <b>up</b>), утилита <b>vinum</b> 
автоматически проверяет состояние сплетения и тома, к которым он может принадлежать и
изменяет их состояние при необходимости.</p>

<p>Если объект является сплетением, команда <b>start</b> проверяет состояние подчиненных
поддисков (и сплетений, в случае тома) и запускает все поддиски, которые можно запустить.</p>

<p>Для запуска сплетения в томе из нескольких сплетений данные должны быть скопированы
с другого сплетения в томе. Поскольку зачастую для этого требуется много времени, это
обычно делается в фоновом режиме. Если необходимо дождаться завершения этой операции 
(например, если она выполняется в сценарии), используйте опцию <b>-w</b>.</p>

<p>Копирование данных не только требует много времени, но и может существенно нагружать
систему. Можно указать размер передаваемого блока в байтах или секторах с помощью опции
<b>-S</b>, и интервал (в миллисекундах) ожидания между копированиями каждого блока с
помощью опции <b>-i</b>. Обе эти опции позволяют снизить нагрузку на систему.</p>
</dd>
<dt><b>stop [-f] [том | сплетение | поддиск]</b></dt><dd>
Если параметры не указаны, команда <b>stop</b> удаляет демон ядра <b>vinum</b> и
останавливает <a href="/man.shtml?topic=vinum&amp;category=4"><b>vinum(4)</b></a>. Это можно сделать, только если
ни один из объектов не активен. В частности, опция <b>-f</b> не позволяет обойти это
требование. Обычно команда <b>stop</b> записывает текущую конфигурацию обратно на диски
перед завершением работы. Это будет невозможно, если изменения конфигурации отключены,
поэтому <b>vinum</b> не остановится, если изменения конфигурации отключены. Это можно
обойти, указав опцию <b>-f</b>.

<p>Команда <b>stop</b> может работать только если <b>vinum</b> был загружен как демон ядра (<b>kld</b>),
поскольку статически сконфигурированных драйвер выгрузить нельзя. Команда <b>vinum stop</b> 
не сработает, если <b>vinum</b> сконфигурирован статически.</p>

<p>Если имена объектов указаны, команда <b>stop</b> отключает доступ к объектам. Если
объекты имеют подчиненные объекты, эти подчиненные объекты должны быть либо не активны
(остановлены или в состоянии ошибки), либо надо указывать опции <b>-r</b> и <b>-f</b>. Эта
команда не удаляет объекты из конфигурации. К ним можно будет снова получить доступ 
после команды <b>start</b>.</p>

<p>По умолчанию утилита <b>vinum</b> не останавливает активные объекты. Например,
нельзя остановить сплетение, подключенное к активному тому, и нельзя отключить открытый
том. Опция <b>-f</b> требует от <b>vinum</b> пропустить эту проверку и удалить объект 
в любом случае. Используйте эту опцию максимально осторожно, и только помня о
последствиях: при некорректном использовании она может привести к серьезному
повреждению данных.</p>
</dd>
<dt><b>stripe [-f] [-n имя] [-v] диски</b></dt><dd>
Команда <b>stripe</b> является упрощенной альтернативой команде <b>create</b> для
создания томов из единственного сплетения с чередованием. Размер поддисков определяется
как размер максимального фрагмента свободного места, доступного на всех указанных дисках.
Размер полосы фиксирован - 279 Кбайт.

<p>Обычно команда <b>stripe</b> создает для тома и его компонентов стандартные имена. Имя состоит
из слова "<b>vinum</b>" и небольшого целого числа, например, "<b>vinum3</b>". Можно задать
нестандартное имя с помощью опции <b>-n имя</b>, что присваивает указанное <b>имя</b> тому.
Имена сплетений и поддисков строятся на основе имени тома стандартным образом.</p>

<p>Имена для дисков задавать нельзя. Если диски уже были проинициализированы как диски <b>vinum</b>,
имя остается. В противном случае, диски получают имена, начинающиеся со слова "<b>vinumdrive</b>",
и заканчивающееся небольшим целым числом, например, "<b>vinumdrive7</b>". Как и в случае
команды <b>create</b>, можно использовать опцию <b>-f</b> для изменения прежнего имени. Опция
<b>-v</b> используется для получения детальных результатов.</p>

<p>Несколько примеров использования этой команды см. в разделе "<b>УПРОЩЕННОЕ КОНФИГУРИРОВАНИЕ</b>" 
ниже.</p>
</dd>
</dl>

<h2><a name="simplified">УПРОЩЕННОЕ КОНФИГУРИРОВАНИЕ</a></h2>

<p>В этом разделе описан упрощенный интерфейс для конфигурирования <b>vinum</b> с помощью
команд <b>concat</b>, <b>mirror</b> и <b>stripe</b>. Эти команды создают удобные конфигурации
для ряда стандартных ситуаций, но не обеспечивают такую гибкость, как команда <b>create</b>.</p>

<p>Описание этих команд было представлено выше. Вот ряд примеров, построенных на одном и том же
наборе дисков. Учтите, что первый диск, <b>/dev/da1h</b>,&nbsp;- меньше других. Это влияет
на размеры поддисков каждого вида.</p>

<p>Во всех следующих примерах используется <b>-v</b>, чтобы показать команды, передаваемые
в систему, а также для получения информации о структуре тома. Без опции <b>-v</b> эти команды
ничего не выдают.</p>

<h3>&nbsp;&nbsp;Том с одним конкатенированным сплетением</h3>

<p>Используйте том с одним конкатенированным сплетением для получения максимально возможного
объема дисковой памяти без обеспечения защиты от сбоев диска:</p>

<pre>vinum -&gt; concat -v /dev/da1h /dev/da2h /dev/da3h /dev/da4h
volume vinum0
  plex name vinum0.p0 org concat
drive vinumdrive0 device /dev/da1h
    sd name vinum0.p0.s0 drive vinumdrive0 size 0
drive vinumdrive1 device /dev/da2h
    sd name vinum0.p0.s1 drive vinumdrive1 size 0
drive vinumdrive2 device /dev/da3h
    sd name vinum0.p0.s2 drive vinumdrive2 size 0
drive vinumdrive3 device /dev/da4h
    sd name vinum0.p0.s3 drive vinumdrive3 size 0
V vinum0				State: up     Plexes:		1 Size:		2134 MB
P vinum0.p0			  C State: up     Subdisks:		4 Size:		2134 MB
S vinum0.p0.s0			State: up     D: vinumdrive0  Size:		 414 MB
S vinum0.p0.s1			State: up     D: vinumdrive1  Size:		 573 MB
S vinum0.p0.s2			State: up     D: vinumdrive2  Size:		 573 MB
S vinum0.p0.s3			State: up     D: vinumdrive3  Size:		 573 MB
</pre>

<p>В нашем случае использовано все место на всех четырех дисках, что дало нам в итоге 2134 Мбайта.</p>

<h3>&nbsp;&nbsp;Том с одним сплетением с чередованием</h3>

<p>Том из одного сплетения с чередованием может обеспечить более высокую производительность, чем
конкатенированное сплетение, но ограничения на сплетения с чередованием могут привести
к уменьшению размера тома. Такой том тоже не обеспечивает защиту от сбоя диска:</p>

<pre>vinum -&gt; stripe -v /dev/da1h /dev/da2h /dev/da3h /dev/da4h
drive vinumdrive0 device /dev/da1h
drive vinumdrive1 device /dev/da2h
drive vinumdrive2 device /dev/da3h
drive vinumdrive3 device /dev/da4h
volume vinum0
  plex name vinum0.p0 org striped 279k
    sd name vinum0.p0.s0 drive vinumdrive0 size 849825b
    sd name vinum0.p0.s1 drive vinumdrive1 size 849825b
    sd name vinum0.p0.s2 drive vinumdrive2 size 849825b
    sd name vinum0.p0.s3 drive vinumdrive3 size 849825b
V vinum0		   State: up		Plexes:			1 Size:		1659 MB
P vinum0.p0		 S State: up		Subdisks:		4 Size:		1659 MB
S vinum0.p0.s0     State: up		D: vinumdrive0	  Size:		 414 MB
S vinum0.p0.s1     State: up		D: vinumdrive1    Size:		 414 MB
S vinum0.p0.s2     State: up		D: vinumdrive2    Size:		 414 MB
S vinum0.p0.s3     State: up		D: vinumdrive3    Size:		 414 MB
</pre>

<p>В этом случае размер поддисков ограничен наименьшим доступным диском, так что, получившийся 
в результате том имеет размер всего 1659 Мбайт.</p>

<h3>&nbsp;&nbsp;Том с зеркалированием из двух конкатенированных сплетений</h3>

<p>Для повышения надежности можно использовать зеркалированный и конкатенированный том:</p>

<pre>vinum -&gt; mirror -v -n mirror /dev/da1h /dev/da2h /dev/da3h /dev/da4h
drive vinumdrive0 device /dev/da1h
drive vinumdrive1 device /dev/da2h
drive vinumdrive2 device /dev/da3h
drive vinumdrive3 device /dev/da4h
volume mirror setupstate
  plex name mirror.p0 org concat
    sd name mirror.p0.s0 drive vinumdrive0 size 0b
    sd name mirror.p0.s1 drive vinumdrive2 size 0b
  plex name mirror.p1 org concat
    sd name mirror.p1.s0 drive vinumdrive1 size 0b
    sd name mirror.p1.s1 drive vinumdrive3 size 0b
V mirror		  State: up			Plexes:		  2 Size:		1146 MB
P mirror.p0		C State: up			Subdisks:	  2 Size:		 988 MB
P mirror.p1		C State: up			Subdisks:	  2 Size:		1146 MB
S vinum0.p0.s0    State: up			D: vinumdrive0  Size:		 414 MB
S vinum0.p0.s2    State: up			D: vinumdrive2  Size:		 414 MB
S vinum0.p0.s1    State: up			D: vinumdrive1  Size:		 414 MB
S vinum0.p0.s3    State: up			D: vinumdrive3  Size:		 414 MB
</pre>

<p>В этом примере явно указано имя тома, <b>mirror</b>. Поскольку один диск меньше других,
два сплетения имеют разный размер, и последние 158 Мбайт тома не защищены от сбоев. 
Чтобы гарантировать полную надежность в такой ситуации, используйте команду <b>create</b> 
для создания тома размером 988 Мбайт.</p>

<h3>&nbsp;&nbsp;Том с зеркалированием из двух сплетений с чередованием</h3>

<p>В качестве альтернативы, используйте опцию <b>-s</b> для создания зеркалированного
тома из двух сплетений с чередованием:</p>

<pre>vinum -&gt; mirror -v -n raid10 -s /dev/da1h /dev/da2h /dev/da3h /dev/da4h
drive vinumdrive0 device /dev/da1h
drive vinumdrive1 device /dev/da2h
drive vinumdrive2 device /dev/da3h
drive vinumdrive3 device /dev/da4h
volume raid10 setupstate
  plex name raid10.p0 org striped 279k
    sd name raid10.p0.s0 drive vinumdrive0 size 849825b
    sd name raid10.p0.s1 drive vinumdrive2 size 849825b
  plex name raid10.p1 org striped 279k
    sd name raid10.p1.s0 drive vinumdrive1 size 1173665b
    sd name raid10.p1.s1 drive vinumdrive3 size 1173665b
V raid10		   State: up	    Plexes:     2 Size:			1146 MB
P raid10.p0		 S State: up		Subdisks:   2 Size:			 829 MB
P raid10.p1		 S State: up	    Subdisks:   2 Size:			1146 MB
S raid10.p0.s0     State: up		PO:      0  B Size:			 414 MB
S raid10.p0.s1     State: up	    PO:    279 kB Size:			 414 MB
S raid10.p1.s0     State: up		PO:      0  B Size:			 573 MB
S raid10.p1.s1     State: up		PO:    279 kB Size:			 573 MB
</pre>

<p>В этом случае полезная часть тома&nbsp;- еще меньше, поскольку первое сплетение
было уменьшено до размера самого маленького диска.</p>

<h2><a name="configuration_file">ФАЙЛ КОНФИГУРАЦИИ</a></h2>

<p>Утилита <b>vinum</b> требует, чтобы все параметры команд <b>create</b> были в
файле конфигурации. Записи в файле конфигурации определяют тома, сплетения и поддиски,
и могут быть в произвольном формате, но каждая запись должна быть в отдельной строке.</p>

<h3>&nbsp;&nbsp;Единицы измерения</h3>

<p>Некоторые параметры файла конфигурации задают размер (длины, размеры полос). Эти
значения можно задавать в байтах или с указанием одной из следующих единиц измерения:</p>

<table cellspacing="4" width="100%" border="0">
<tbody><tr><td valign="top" width="10%"><b>s</b></td><td>
Указывает, что значение задано в секторах по 512 байтов.</td></tr>
<tr><td valign="top" width="10%"><b>k</b></td><td>
Указывает, что значение задано в килобайтах (1024 байта).</td></tr>
<tr><td valign="top" width="10%"><b>m</b></td><td>
Указывает, что значение задано в мегабайтах (1048576 байтов).</td></tr>
<tr><td valign="top" width="10%"><b>g</b></td><td>
Указывает, что значение задано в гигабайтах (1073741824 байта).</td></tr>
<tr><td valign="top" width="10%"><b>b</b></td><td>
Используется для совместимости с VERITAS. Указывает, что значение задано в блоках по 
512 байтов. Это сокращение необнозначно, поскольку слово "блок" используется в разных
смыслах, и его использование не рекомендуется. Используйте единицу измерения '<b>s</b>'.</td></tr>
</tbody></table>

<p>Например, значение 16777216 байтов можно также записать как <b>16m</b>, <b>16384k</b> или <b>32768s</b>.</p>

<p>Файл конфигурации может содержать следующие записи:</p>

<dl>
<dt><b>drive имя имя_устройства [опции]</b></dt><dd>
Определяет диск. Поддерживаются следующие опции:
<dl>
<dt><b>device имя_устройства</b></dt><dd>
Задает устройство, на котором находится диск. <b>Имя_устройства</b> должно быть именем раздела диска,
например, <b>/dev/da1e</b> или <b>/dev/ad3s2h</b>, это устройство должно быть типа <b>vinum</b>.
Не испольуйте раздел "<b>c</b>", который зарезервирован для представления всего диска.
<br><br></dd>
<dt><b>hotspare</b></dt><dd>
Определяет диск как диск "горячей замены" ("hot spare" drive), который предназначен для
автоматической замены сбойного диска. Утилита <b>vinum</b> не позволяет использовать
этот диск для любых других целей. В частности, на нем нельзя создавать поддиски. Эта
возможность еще не полностью реализована.</dd>
</dl>
</dd>
<dt><b>volume имя [опции]</b></dt><dd>
Определяет том с указанным <b>именем</b>. Поддерживаются следующие опции:
<dl>
<dt><b>plex имя_сплетения</b></dt><dd>
Добавляет указанное сплетение к тому. Если имя сплетения указано как <b>*</b>, утилита <b>vinum</b> 
будет искать определение сплетения в следующей записи файла конфигурации после определения тома.
<br><br></dd>
<dt><b>readpol правило</b></dt><dd>
Задает <i>правило чтения</i> (read policy) для тома. В качестве правила можно указывать значение
<b>round</b> или <b>prefer имя_предпочтительного_сплетения</b>. Утилита <b>vinum</b> удовлетворяет запросы на
чтение только с одного из сплетений. Правило чтения <b>round</b> означает, что каждое последующее
чтение должно выполняться с другого сплетения, циклически. Правило чтения <b>prefer</b> требует
выполнять чтение каждый раз с явно указанного сплетения.
<br><br></dd>
<dt><b>setupstate</b></dt><dd>
При создания тома из нескольких сплетений предполагать, что содержимое всех сплетений согласовано.
Обычно это не так, поэтому стандартно утилита <b>vinum</b> устанавливает для всех сплетений,
кроме первого, состояние <b>faulty</b>. Используйте команду <b>start</b>, чтобы сначала привести
их в согласованное состояние. В случае конкатенированных сплетений и сплетений с чередованием, однако,
оставление сплетений в несогласованном состоянии обычно не вызывает проблем: при использовании тома
для создания файловой системы или раздела подкачки прежнее содержимое дисков обычно не представляет
интереса, поэтому исходную согласованность можно проигнорировать. Если вы готовы пойти на этот риск,
используйте ключево слово <b>setupstate</b>. Оно применяется только к сплетениям, определенным 
непосредственно после соответствующего тома в файле конфигурации. При добавлении сплетений
к тому в дальнейшем, их необходимо интегрировать вручную с помощью команды <b>start</b>.

<p>Учтите, что для сплетений типа RAID-5 надо обязательно использовать команду <b>init</b>:
иначе при сбое одного из поддисков произойдет существенное повреждение данных.</p></dd>
</dl>
</dd>
<dt><b>plex [опции]</b></dt><dd>
Определяет сплетение. В отличие от тома, имя сплетения задавать не обязательно. Поддерживаются 
следующие опции:
<dl>
<dt><b>name имя_сплетения</b></dt><dd>
Задает имя сплетения. Учтите, что ключевое слово <b>name</b> надо обязательно использовать
при именовании сплетения или поддиска.
<br><br></dd>
<dt><b>org организация [размер_полосы]</b></dt><dd>
Задает организацию сплетения. В качестве <b>организации</b> может быть задано одно из 
значений <b>concat</b>, <b>striped</b> или <b>raid5</b>. Для сплетений типа <b>striped</b> и 
<b>raid5</b> необходимо указывать параметр <b>размер_полосы</b>, а вот для сплетения типа
<b>concat</b> его указывать нельзя. Для сплетения типа <b>striped</b> значение
<b>размер_полосы</b> задает ширину каждой полосы. Для сплетения типа <b>raid5</b> оно задает
размер группы. <i>Группа</i>&nbsp;- это часть сплетения, хранящая биты четности на одном и 
том же поддиске. Размер сплетения должен быть кратен размеру группы (другими словами,
результат деления размера сплетения на размер полосы должен быть
целым числом), а размер группы должен быть кратен размеру сектора диска (512 байтов).

<p>Для оптимальной производительности полосы должны быть размером минимум 128 Кбайт: 
меньший размер приведет к существенному увеличению количества операций ввода/вывода
из-за распределения отдельных запросов по нескольким дискам. Повышение производительности
из-за увеличения количества одновременных передач, вызванное таким распределением, не
скомпенсирует падение производительности в связи с дополнительными задержками. Хорошей
рекомендацией будет выбирать размер полосы в диапазоне от 256 Кбайт до 512 Кбайт. Степеней
двойки при этом, однако, лучше избегать: обычно они приводят к размещению всех суперблоков
на первом поддиске. Упрощенные команды используют размер полосы 279 Кбайт, что дает
разумное распределение суперблоков.</p>

<p>Сплетение с чередованием должно иметь минимум два поддиска (иначе это просто 
конкатенированное сплетение), причем, одинакового размера. Сплетение типа RAID-5 должно 
иметь как минимум три поддиска, причем, одинакового размера. Практически сплетение 
типа RAID-5 должно включать не менее 5 поддисков.</p>
</dd>
<dt><b>volume имя_тома</b></dt><dd>
Добавляет сплетение к указанному тому. Если ключевое слово <b>volume</b> не указано, сплетение
будет добавлено к последнему тому, упоминавшемуся в файле конфигурации.
<br><br></dd>
<dt><b>sd имя_поддиска смещение</b></dt><dd>
Добавляет указанный <b>поддиск</b> к сплетению с указанного <b>смещения</b>.</dd>
</dl>
</dd>
<dt><b>subdisk [опции]</b></dt><dd>
Определяет поддиск. Поддерживаются следующие опции:
<dl>
<dt><b>name имя</b></dt><dd>
Задает <b>имя</b> поддиска. Задавать имя для поддиска не обязательно&nbsp;- см. раздел 
"ИМЕНОВАНИЕ ОБЪЕКТОВ" выше. Учтите, что если необходимо задать имя поддиска, ключевое
слово <b>name</b> указывать обязательно.
<br><br></dd>
<dt><b>plexoffset смещение</b></dt><dd>
Задает начальное смещение поддиска в сплетении. Если смещение не указано, утилита <b>vinum</b> 
выделяет место сразу после предыдущего поддиска, если он уже был определен, или с начала
сплетения в противном случае.
<br><br></dd>
<dt><b>driveoffset смещение</b></dt><dd>
Задает начальное смещение поддиска на диске. Если <b>смещение</b> не задано, <b>vinum</b> 
выделяет первый же фрагмент свободного места достаточного размера (см. <b>length</b>) на диске.
<br><br></dd>
<dt><b>length длина</b></dt><dd>
Задает "длину" (размер) поддиска. Это ключевое слово указывать обязательно. Стандартного
значения нет, но можно указать значение 0&nbsp;- оно означает "использовать самый большой
фрагмент свободного места на диске". Если диск пустой, это означает, что для поддиска 
будет использован весь диск. Ключевое слово <b>length</b> можно сокращать до <b>len</b>.
<br><br></dd>
<dt><b>plex сплетение</b></dt><dd>
Задает сплетение, которому принадлежит поддиск. По умолчанию, поддиск принадлежит последнему
определенному сплетению.
<br><br></dd>
<dt><b>drive диск</b></dt><dd>
Задает диск, на котором находится поддиск. По умолчанию, поддиск находится на последнем
указанном диске.
<br><br></dd>
<dt><b>retryerrors</b></dt><dd>
Указывает, что поддиск не должен отключаться в случае невосстановимых ошибок. Обычно
<b>vinum</b> при возникновении таких ошибок делает весь поддиск недоступным.</dd>
</dl>
</dd>
</dl>

<h2>ПРИМЕР ФАЙЛА КОНФИГУРАЦИИ</h2>
<pre># Пример файла конфигурации vinum
#
# Наши диски
drive drive1 device /dev/da1h
drive drive2 device /dev/da2h
drive drive3 device /dev/da3h
drive drive4 device /dev/da4h
drive drive5 device /dev/da5h
drive drive6 device /dev/da6h
# Том из одного сплетения с чередованием
volume tinyvol
  plex org striped 279k
    sd length 64m drive drive2
    sd length 64m drive drive4
volume stripe
  plex org striped 279k
    sd length 512m drive drive2
    sd length 512m drive drive4
# Два сплетения
volume concat
  plex org concat
    sd length 100m drive drive2
    sd length 50m drive drive4
  plex org concat
    sd length 150m drive drive4
# Том из одного сплетения с чередованием и одного конкатенированного
volume strcon
  plex org striped 279k
    sd length 100m drive drive2
    sd length 100m drive drive4
  plex org concat
    sd length 150m drive drive2
    sd length 50m drive drive4
# Том из сплетения типа RAID-5 и сплетения с чередованием
# Обратите внимание, что сплетение RAID-5 длинее на 
# один поддиск
volume vol5
   plex org striped 491k
     sd length 1000m drive drive2
     sd length 1000m drive drive4
   plex org raid5 273k
     sd length 500m drive drive1
     sd length 500m drive drive2
     sd length 500m drive drive3
     sd length 500m drive drive4
     sd length 500m drive drive5
</pre>

<h2><a name="drive_layout">ПРИНЦИПЫ РАЗМЕЩЕНИЯ ДИСКОВ</a></h2>

<p>Диски <b>vinum</b> в настоящее время являются разделами дисков BSD. Они должны быть типа
<b>vinum</b>, чтобы предотвратить перезапись данных, используемых для других целей. Для изменения
определения типа раздела используйте команду <b>disklabel -e</b>. Ниже представлено типичное
разбиение диска на разделы, выдаваемое <a href="/man.shtml?topic=disklabel&amp;category=8"><b>disklabel(8)</b></a>:</p>

<pre>8 partitions:
#        size   offset    fstype   [fsize bsize bps/cpg]
  a:    81920   344064    4.2BSD        0     0     0   # (Cyl.  240*- 297*)
  b:   262144    81920      swap                        # (Cyl.   57*- 240*)
  c:  4226725        0    unused        0     0         # (Cyl.0 - 2955*)
  e:    81920        0    4.2BSD        0     0     0   # (Cyl.0 - 57*)
  f:  1900000   425984    4.2BSD        0     0     0   # (Cyl.  297*- 1626*)
  g:  1900741  2325984     vinum        0     0     0   # (Cyl. 1626*- 2955*)
</pre>

<p>В этом примере, раздел "<b>g</b>" может использоваться как раздел <b>vinum</b>. 
Разделы "<b>a</b>", "<b>e</b>" и "<b>f</b>" могут использоваться для создания
файловых систем UFS или как разделы <b>ccd</b>. Раздел "<b>b</b>" является разделом
подкачки, а раздел "<b>c</b>" представляет весь диск в целом и не должен использоваться
для любых других целей.</p>

<p>Утилита <b>vinum</b> использует первые 265 секторов каждого раздела для информации
о конфигурации, поэтому максимальный размер поддиска будет на 265 секторов меньше, чем
объем диска.</p>

<h2><a name="log_file">ЖУРНАЛЬНЫЙ ФАЙЛ</a></h2>

<p>Утилита <b>vinum</b> поддерживает журнальный файл, по умолчанию&nbsp;- 
<b>/var/log/vinum_history</b>, в который она записывает выполненные команды <b>vinum</b>.
Имя этого файла можно изменить путем установки соответствующего значения переменной среды
<b>VINUM_HISTORY</b>.</p>

<p>Перед каждым сообщением в журнальном файле указывается дата и время. Стандартный
формат&nbsp;- "<b>%e %b %Y %H:%M:%S</b>". Подробнее о строке формата см. на странице
справочного руководства <a href="/man.shtml?topic=strftime&amp;category=3"><b>strftime(3)</b></a>. Нестандартный 
формат можно задать в переменной среды <b>VINUM_DATEFORMAT</b>.</p>

<h2><a name="howto">КАК НАСТРОИТЬ VINUM</a></h2>

<p>В этом разделе представлены практические советы по использованию <b>vinum</b> в
системе.</p>

<h3>&nbsp;&nbsp;Где размещать данные</h3>

<p>Прежде всего, надо решить, где размещать данные. Необходимо выделить разделы диска
специально для <b>vinum</b>. Это должны быть именно разделы, а не устройства в целом; 
нельзя использовать также раздел "<b>c</b>". Например, прекрасно подходят имена 
устройств <b>/dev/da0e</b> или <b>/dev/ad3s4a</b>. Не подходят устройства <b>/dev/da0</b> 
и <b>/dev/da0s1</b>, поскольку представляют диск в целом, а не раздел, а также раздел
<b>/dev/ad1c</b>, представляющий диск в целом&nbsp;- он должен быть типа <b>unused</b>.
Примеры см. выше в разделе <a href="#drive_layout"><b>ПРИНЦИПЫ РАЗМЕЩЕНИЯ ДИСКОВ</b></a>.</p>

<h3>&nbsp;&nbsp;Проектирование томов</h3>
<p>Настройка томов <b>vinum</b> зависит от поставленных целей. Есть несколько вариантов:</p>

<ol>
<li>Может потребоваться объединить несколько небольших дисков для получения файловой системы
достаточного размера. Например, при наличии пяти небольших дисков, если необходимо
использовать все дисковое пространство как один том, можно создать конфигурационный файл
следующего вида:

<pre>drive d1 device /dev/da2e
drive d2 device /dev/da3e
drive d3 device /dev/da4e
drive d4 device /dev/da5e
drive d5 device /dev/da6e
volume bigger
  plex org concat
    sd length 0 drive d1
    sd length 0 drive d2
    sd length 0 drive d3
    sd length 0 drive d4
    sd length 0 drive d5
</pre>

<p>В данном случае длина поддисков задается как 0, что означает "использоваться самый большой
фрагмент свободного места, который удастся найти на диске". Если поддиск&nbsp;- единственный
на диске, под него будет использоваться все свободное место.</p>
</li>
<li>Можно настраивать <b>vinum</b> для получения дополнительной защиты от сбоев дисков. Для
этого можно использовать либо конфигурацию RAID-1, которую также называют "зеркалирование",
либо конфигурацию RAID-5, с битами четности.

<p>Для настройки зеркалирования создайте несколько сплетений в томе. Например, для создания
зеркалированного тома размером 2 Гбайта можно использовать следующий файл конфигурации:</p>

<pre>drive d1 device /dev/da2e
drive d2 device /dev/da3e
volume mirror
  plex org concat
    sd length 2g drive d1
  plex org concat
    sd length 2g drive d2
</pre>

<p>При создании дисков с зеркалированием важно убедиться, что данные каждого сплетения
находятся на другом физическом диске, чтобы драйвер <b>vinum</b> мог обращаться ко всему
адресному пространству тома даже при сбое одного диска. Учтите, что для каждого сплетения
потребуется столько же места, сколько и для всего тома: в нашем примере том имеет размер
2 Гбайта, поэтому каждое сплетение (и каждый поддиск) должны быть размером 2 Гбайта, так что
всего на дисках будет использовано 4 Гбайта.</p>

<p>Для настройки массива RAID-5 создайте одно сплетение типа <b>raid5</b>. Например,
для создания эквивалентного тома размером 2 Гбайта, остающегося работоспособным при сбое 
одного диска, можно использовать следующий файл конфигурации:</p>

<pre>drive d1 device /dev/da2e
drive d2 device /dev/da3e
drive d3 device /dev/da4e
drive d4 device /dev/da5e
drive d5 device /dev/da6e
volume raid
  plex org raid5 433k
    sd length 512m drive d1
    sd length 512m drive d2
    sd length 512m drive d3
    sd length 512m drive d4
    sd length 512m drive d5
</pre>

<p>Сплетения типа RAID-5 требуют минимум трех поддисков, один из которых используется для
хранения информации о четности и дла хранения данных не доступен. Чем больше дисков
используется, тем большая доля дискового прострнаства может использоваться для хранения
собственно данных. В нашем примере суммарно используется 2,5 Гбайта по сравнению с 
4 Гбайтами в конфигурации с зеркалированием. Если придется использовать всего три диска, 
для хранения той же информации потребуется 3 Гбайта, например:</p>

<pre>drive d1 device /dev/da2e
drive d2 device /dev/da3e
drive d3 device /dev/da4e
volume raid
  plex org raid5 433k
    sd length 1g drive d1
    sd length 1g drive d2
    sd length 1g drive d3
</pre>

<p>Как и при создании дисков с зеркалированием, важно проверить, что данные каждого поддиска
находятся на другом физическом диске, чтобы драйвер <b>vinum</b> мог получить доступ ко
всему адресонму пространству тома даже при сбое одного диска.</p>
</li>

<li>Можно настроить <b>vinum</b> для обеспечения одновременного доступа к файловой
системе большего количества пользователей. Во многих случаях, доступ к файловой системе
ограничивается скоростью диска. Распределяя том по нескольким дискам, можно
увеличить пропускную способность при многопользовательском доступе. Этот метод
дает минимальные преимущества или вообще не дает преимуществ, если процессы
обращаются к дискам по одному. Утилита <b>vinum</b> использует метод под
названием "чередование" (иногда соответствующий массив называют RAID-0) для
увеличения одновременности при доступе. Имя RAID-0 сбивает с толку: 
чередование не обеспечивает ни избыточности, ни повышенной надежности. Фактически,
оно снижает надежность, поскольку сбой единственного диска делает бесполезным
весь том, и чем больше дисков входит в том, тем больше вероятность, что
на одном из них произойдет сбой.

<p>Для реализации чередования используйте сплетение с чередованием:</p>

<pre>drive d1 device /dev/da2e
drive d2 device /dev/da3e
drive d3 device /dev/da4e
drive d4 device /dev/da5e
volume raid
  plex org striped 433k
    sd length 512m drive d1
    sd length 512m drive d2
    sd length 512m drive d3
    sd length 512m drive d4
</pre>

<p>Сплетение с чередованием должно состоять, как минимум, из двух поддисков, но
повышение производительности будет больше при увеличении количества дисков.</p>
</li>
<li>Можно попытаться получить лучшее из двух миров и обеспечить как защиту от
сбоев, так и высокую производительность. Соответствующий массив иногда называют 
RAID-10 (комбинация RAID-1 и RAID-0), хотя и это имя сбивает с толку.
Можно реализовать такой массив <b>vinum</b> с помощью следующего файла конфигурации:
<pre>drive d1 device /dev/da2e
drive d2 device /dev/da3e
drive d3 device /dev/da4e
drive d4 device /dev/da5e
volume raid setupstate
  plex org striped 433k
    sd length 512m drive d1
    sd length 512m drive d2
    sd length 512m drive d3
    sd length 512m drive d4
  plex org striped 433k
    sd length 512m drive d4
    sd length 512m drive d3
    sd length 512m drive d2
    sd length 512m drive d1
</pre>

<p>В данном случае сплетения сосданы с чередованием, что повышает 
производительность, а то, что их два, повышает надежность. Обратите внимание,
что в этом примере поддиски второго сплетения идут в порядке, противоположном
первому сплетению. Это сделано из соображений производительности, которые 
обсуждаются далее. Кроме того, определение тома включает ключевое слово
<b>setupstate</b>, что гарантирует запуск всех сплетений сразу после создания.</p>
</li>
</ol>

<h3>&nbsp;&nbsp;Создание томов</h3>

<p>После создания необходимых файлов конфигурации запустите <b>vinum</b> и создайте
тома. В следующем примере конфигурация задана в файле <b>configfile</b>:</p>

<pre># vinum create -v configfile
   1: drive d1 device /dev/da2e
   2: drive d2 device /dev/da3e
   3: volume mirror
   4:   plex org concat
   5:     sd length 2g drive d1
   6:   plex org concat
   7:     sd length 2g drive d2
Configuration summary

Drives:         2 (4 configured)
Volumes:        1 (4 configured)
Plexes:         2 (8 configured)
Subdisks:       2 (16 configured)

Drive d1:       Device /dev/da2e
                Created on vinum.lemis.com at Tue Mar 23 12:30:31 1999
                Config last updated Tue Mar 23 14:30:32 1999
                Size:  60105216000 bytes (57320 MB)
                Used:   2147619328 bytes (2048 MB)
                Available: 57957596672 bytes (55272 MB)
                State: up
                Last error: none
Drive d2:       Device /dev/da3e
                Created on vinum.lemis.com at Tue Mar 23 12:30:32 1999
                Config last updated Tue Mar 23 14:30:33 1999
                Size:  60105216000 bytes (57320 MB)
                Used:   2147619328 bytes (2048 MB)
                Available: 57957596672 bytes (55272 MB)
                State: up
                Last error: none

Volume mirror:  Size: 2147483648 bytes (2048 MB)
                State: up
                Flags:
                2 plexes
                Read policy: round robin

Plex mirror.p0: Size:   2147483648 bytes (2048 MB)
                Subdisks:1
                State: up
                Organization: concat
                Part of volume mirror
Plex mirror.p1: Size:   2147483648 bytes (2048 MB)
                Subdisks:1
                State: up
                Organization: concat
                Part of volume mirror

Subdisk mirror.p0.s0:
                Size:   2147483648 bytes (2048 MB)
                State: up
                Plex mirror.p0 at offset 0
Subdisk mirror.p1.s0:
                Size:   2147483648 bytes (2048 MB)
                State: up
                Plex mirror.p1 at offset 0
</pre>

<p>Опция <b>-v</b> требует от утилиты <b>vinum</b> выдавать содержимое файла по ходу
конфигурирования. Далее она выдает информацию о текущей конфигурации в том же формате,
что и команда <b>list -v</b>.</p>

<h3>&nbsp;&nbsp;Создание дополнительных томов</h3>

<p>После создания томов <b>vinum</b>, драйвер <b>vinum</b> отслеживает их
состояние в своих внутренних файлах конфигурации. Снова создавать их не придется.
В частности, при повторном выполнении команды <b>create</b> будут созданы 
дополнительные объекты:</p>

<pre># vinum create sampleconfig
Configuration summary

Drives:         2 (4 configured)
Volumes:        1 (4 configured)
Plexes:         4 (8 configured)
Subdisks:       4 (16 configured)

D d1					State: up     Device /dev/da2e     Avail: 53224/57320 MB (92%)
D d2		            State: up     Device /dev/da3e     Avail: 53224/57320 MB (92%)

V mirror			    State: up     Plexes:   4 Size: 2048 MB

P mirror.p0			  C State: up     Subdisks:   1 Size: 2048 MB
P mirror.p1			  C State: up     Subdisks:   1 Size: 2048 MB
P mirror.p2           C State: up     Subdisks:   1 Size: 2048 MB
P mirror.p3			  C State: up     Subdisks:   1 Size: 2048 MB

S mirror.p0.s0		    State: up     PO:0  B Size: 2048 MB
S mirror.p1.s0			State: up     PO:0  B Size: 2048 MB
S mirror.p2.s0			State: up     PO:0  B Size: 2048 MB
S mirror.p3.s0			State: up     PO:0  B Size: 2048 MB
</pre>

<p>Как показывает этот пример (на этот раз добавлена опция <b>-f</b>), повторное
выполнение команды <b>create</b> привело к созданию четырех новых сплетений,
каждое - с новым поддиском. Если необходиом создать другие тома, создайте для
них новые файлы конфигуации. В них не обязательно задавать диски, о
которых драйвер <b>vinum</b> уже знает. Например, для создания тома <b>raid</b> 
на четырех дисках, <b>/dev/da1e</b>, <b>/dev/da2e</b>, <b>/dev/da3e</b> и
<b>/dev/da4e</b>, достаточно упомянуть два оставшихся:</p>
<pre>drive d3 device /dev/da1e
drive d4 device /dev/da4e
volume raid
  plex org raid5 433k
    sd size 2g drive d1
    sd size 2g drive d2
    sd size 2g drive d3
    sd size 2g drive d4
</pre>

<p>С помощью этого файла конфигурации мы получим:</p>

<pre># vinum create newconfig
Configuration summary

Drives:			4 (4 configured)
Volumes:		2 (4 configured)
Plexes:			5 (8 configured)
Subdisks:		8 (16 configured)

D d1					State: up		Device /dev/da2e     Avail: 51176/57320 MB (89%)
D d2					State: up		Device /dev/da3e     Avail: 53220/57320 MB (89%)
D d3					State: up		Device /dev/da1e     Avail: 53224/57320 MB (92%)
D d4					State: up		Device /dev/da4e     Avail: 53224/57320 MB (92%)

V mirror			    State: down     Plexes:		4 Size:		2048 MB
V raid					State: down     Plexes:		1 Size:		6144 MB

P mirror.p0			  C State: init     Subdisks:   1 Size:		2048 MB
P mirror.p1			  C State: init     Subdisks:   1 Size:		2048 MB
P mirror.p2			  C State: init     Subdisks:   1 Size:		2048 MB
P mirror.p3			  C State: init     Subdisks:   1 Size:		2048 MB
P raid.p0			 R5 State: init     Subdisks:   4 Size:		6144 MB

S mirror.p0.s0			State: up		PO:		 0  B Size:		2048 MB
S mirror.p1.s0			State: up		PO:		 0  B Size:		2048 MB
S mirror.p2.s0			State: up		PO:		 0  B Size:		2048 MB
S mirror.p3.s0			State: up		PO:		 0  B Size:		2048 MB
S raid.p0.s0			State: empty    PO:		 0  B Size:		2048 MB
S raid.p0.s1			State: empty    PO:    433 kB Size:		2048 MB
S raid.p0.s2			State: empty    PO:    866 kB Size:		2048 MB
S raid.p0.s3			State: empty    PO:   1299 kB Size:		2048 MB
</pre>

<p>Обратите внимание на рразмер сплетения RAID-5: он составляет всего 6 Гбайт,
хотя совместно все его компоненты занимают 8 Гбайт дискового пространства.
Причина в том, что пространство объемом с один поддиск используется для
хранения данных о четности.</p>

<h3>&nbsp;&nbsp;Перезапуск Vinum</h3>

<p>После перрезагрузки системы запустите <b>vinum</b> с помощью команды <b>start</b>:</p>

<pre>   # vinum start
</pre>

<p>Эта команда запустит все диски <b>vinum</b> в системе. Если, по любой причине,
необходимо запустить только некоторые из них, используйте команду <b>read</b> .</p>

<h3>&nbsp;&nbsp;Сообрражения производительности</h3>

<p>Есть рряд ошибочных представлений о том, как настраивать RAID-массив для
достижения наилучшей производительности. В частности, в большинстве систем
используется слишком маленький размер полосы. Следующее обсуждение применимо
ко всем RAID-системам, а не только к <b>vinum</b>.</p>

<p>Система блочного ввода/вывода ОС FreeBSD выдает запросы на чтение от 0,5 Кбайта
до 128 Кбайт; в среднем - около 8 Кбайт. Ни в одной системе чередования нельзя 
предотвратить разбиение запроса на два физических запроса, и если сделать размер
полосы слишком маленьким, он может быть разбит и на нескольк запросов. Это приведет
к существенному падению производительности: уменьшение времени передачи для каждого
диска с лихвой компенсиуется на порядок увеличивающимся ожиданием доступа.</p>

<p>При современных размерах дисков и состоянии системы ввода/вывода FreeBSD,
следует ожидать достаточно небольшой доли фрагментированных запросов при
использовании полос размером от 256 до 512 Кбайт; хотя при обоснованном применении
RAID-массивов нет очевидных причин не увеличить размер до 2-4 Мбайт для больших 
дисков.</p>

<p>При выборе размера полосы учитывайте, что большинство современных файловых
систем UFS использует группы цилиндров размером 32 Мбайта. Если размер
полосы и количество дисков - степени двойки, вероятно, что все суперблоки
и индексные дескрипторы будут помещены на один и тот же поддиск, что
существенно повлияет на производительность. Выбирайте лучше нечетное число,
например, 479 Кбайт.</p>

<p>Самый простой способ учесть влияние любой передачи данных в системе с множественным
доступом&nbsp;- рассматривать ее с точки зрения потенциального узкого места,
дисковой подсистемы: сколько всего времени работы диска потребует эта
передача? Поскольку практически все кэшируется, время от выдачи запроса до 
его выполнения не так важно: важно, сколько всего времени запрос активно
использует диски, время, в течение которого диски недоступны для выполнения передач 
других данных. В результате, не так уж важно, выполняются ли передачи одновременно
или в разное врремя. Практически, время, которое нас интересует - это сумма общей 
задержки (времени на позиционирование и ожидания при вращении пластин, или времени, 
за которое требуемые данные окажутся под головками диска) и общего времени 
передачи. Для передачи данных по одному и тому же адресу на диски с той же 
скоростью вращения, время передачи зависит только от объема пеедаваемых данных.</p>

<p>Рассмотрим типичную статью дискуссионной группы или web-страницу размером
24 Кбайта, которая, вероятно, будети прочитана одной операцией ввода/вывода.
Пусть диски обеспечивают скорость передачи 6 Мбайт/сек, среднее время позиционирования
составляет 8 миллисекунд, а файловая система имеет размер блока 4 Кбайта. Поскольку
прочитать надо 24 Кбайта, фрагменты можнео не учитывать, так что, считаем, что файл 
начинается на границе очердных 4 Кбайт. Количество необходимых передач зависит от
того, где начинается блок: в данном случае, оно вычисляется по формуле 
<b>(S + F - 1) / S</b>, где <b>S</b> - размер полосы в блоках файловой системы,
а <b>F</b> - размер файла в блоках файловой системы.</p>

<ol>
<li>При размере полосы 4 Кбайта потребуется 6 передач. Общая нагрузка на 
дисковую подсистему: задержка - 48 миллисекунд, передача - 2 миллисекунды,
всего - 50 миллисекунд.</li>
<li>При размере полосы 8 Кбайт в среднем потребуется 3,5 передачи. Общая нагрузка на  
дисковую подсистему: задержка - 28 миллисекунд, передача - 2 миллисекунды,
всего - 30 миллисекунд.</li>
<li>При размере полосы 16 Кбайт в среднем потребуется 2,25 передачи. 
Общая нагрузка на дисковую подсистему: задержка - 18 миллисекунд, передача - 
2 миллисекунды, всего - 20 миллисекунд.</li>
<li>При размере полосы 256 Кбайт в среднем потребуется 1,08 передачи.
Общая нагрузка на дисковую подсистему: задержка - 8,6 миллисекунд, передача - 
2 миллисекунды, всего - 10,6 миллисекунды.</li>
<li>При размере полосы 4 Мбайта в среднем потребуется 1,0009 передачи.
Общая нагрузка на дисковую подсистему: задержка - 8,01 миллисекунды, передача - 
2 миллисекунды, всего - 10,01 миллисекунды.</li>
</ol>

<p>Похоже, что у некоторых аппаратных RAID-систем есть проблемы с большими полосами: они,
по-видимому, передают на диск и с диска только всю полосу, так что увеличение размера
полосы может отрицательно влиять на производительность. Утилита <b>vinum</b> от
этой проблемы не страдает: все обмены данными оптимизируются и ненужные данные не
передаются.</p>

<p>Учтите, что ни одна из широко известных программ оценки производительности не
реализует условия действительно множественного доступа (более 100 одновременно работающих
пользователей), так что правильность представленных утверждений проверить трудно.</p>

<p>С учетом представленных соображений, на производительность тома <b>vinum</b> влияют
следующие факторы:</p>
<ol>
<li>Чередование повышает производительность только при множественном доступе, поскольку
повышает вероятность того, что отдельные запросы будут переадресованы на разные диски.</li>
<li>Конкатенированные файловые системы UFS из нескольких дисков тоже могут повысить
производительность при доступе к множеству файлов, поскольку UFS делит файловую систему
на группы цилиндров и пытается поддерживать файлы в одной группе цилиндров. В общем случае,
В общем случае, это не так эффективно, как чередование.</li>
<li>Зеркалирование может повысить производительность множественного доступа при чтении,
поскольку по умолчанию каждое следующее чтение <b>vinum</b> выполняет со следующего
сплетения.</li>
<li>Зеркалирование снижает производительность для всех видов записи, будь-то множественные
или отдельные, поскольку данные надо записать на все сплетения. Это объясняет выбранное
размещение дисков в представленном ранее примере конфигурации с зеркалированием: если
соответствующий поддиск в каждом сплетении располагается на другом физическом диске,
команды записи могут выполняться параллельно, а при размещении на одном физическом диске они
будут выполняться строго последовательно.</li>
<li>Чтения с массива RAID-5 имеют, по сути, те же особенности, что и чтения с массива с чередованием,
если только сплетение с чередованием не входит в том с зеркалированием,&nbsp;-  в этом
случае производительность тома с зеркалированием будет выше.</li>
<li>Скорость записи на массив RAID-5 составляет примерно 25% от скорости записи на массив с
чередованием: для выполнения записи утилита <b>vinum</b> должна сначала прочитать блок
данных и соответствующий блок четности, выполнить ряд вычислений и записать блок четности
и блок данных, что требует в четыре раза больше передач, чем при записи на сплетение с чередованием.
С другой стороны, это компенсируется отсутствием затрат на зеркалирование, поэтому запись
на том с единственным сплетением типа RAID-5 выполняется примерно вдвое медленнее, чем на
правильно сконфигурированный том из двух сплетений с чередованием.</li>
<li>При изменении конфигурации <b>vinum</b> (например, при добавлении или удалении объектов, или при
изменении состояния одного из объектов), <b>vinum</b> записывает до 128 Кбайт обновленной информации
о конфигурации на каждый диск. Чем больше дисков задействовано, тем больше времени это займет.</li>
</ol>

<h3>&nbsp;&nbsp;Создание файловых систем на томах Vinum</h3>

<p>Перед созданием файловой системы на томе <b>vinum</b> запускать утилиту 
<a href="/man.shtml?topic=disklabel&amp;category=8"><b>disklabel(8)</b></a> не нужно. Просто выполните команду 
<a href="/man.shtml?topic=newfs&amp;category=8"><b>newfs(8)</b></a>. Используйте опцию <b>-v</b>, чтобы указать, что
устройство не разбито на разделы. Например, чтобы создать файловую систему на томе <b>mirror</b>,
выполните следующую команду:</p>
<pre># newfs -v /dev/vinum/mirror
</pre>

<p>При конфигурировании <b>vinum</b> следует учитывать также следующее:</p>
<ul>
<li>Создание нескольких дисков <b>vimun</b> на одном физическом диске не дает никаких
преимуществ. На каждом диске 131,5 Кбайта используется для метки и хранения информации о
конфигурации, а изменение конфигурации вызывает снижение производительности. Используйте
лучше поддиски соответствующего размера.</li>
<li>Можно увеличить размер конкатенированного сплетения <b>vinum</b>, но вот размер
спелетений с чередованием и сплетений типа RAID-5 в настоящее время увеличить нельзя.
В настоящее время размер существующей файловой системы UFS увеличить тоже нельзя, но
планируется сделать сплетения и файловые системы расширяемыми.</li>
</ul>

<h2><a name="state_management">УПРАВЛЕНИЕ СОСТОЯНИЕМ</a></h2>

<p>Для объектов <b>vinum</b> существует понятие состояния. Подробнее см. на странице 
справочного руководства <a href=""><b>vinum(4)</b></a>. Объекты полностью доступны
тольк в запущеном (<b>up</b>) состоянии. Чтобы изменить состояние объекта на <b>up</b>, 
используйте команду <b>start</b>. Для перевода объекта в состояние <b>down</b> используйте
команду <b>stop</b>. Обычно переход в другие состояния осуществляется автоматически с
учетом взаимосвязей объектов. Например, при добавлении сплетения к тому поддиски
сплетения оказываются в состоянии <b>empty</b>, показывая, что хотя фактически диск
доступен, данные на поддиске некорректны. В результате установки такого состояния,
соответствующее сплетение будет установлено в состояние сбоя (<b>faulty</b>).</p>

<h3>&nbsp;&nbsp;Состояние "reviving"</h3>

<p>Во многих случаях при запуске поддиска система должна скопировать данные на поддиск. 
В зависимости от размера поддиска, это может потребовать много времени. На это время 
поддиск устанавливается в состояние <b>reviving</b> ("оживляется"). После успешного
завершения операции копирования он автоматически запускается (устанавливается в состояние <b>up</b>).
Можно останавливать и перезапускать процесс, выполняющий "оживление". Система отслеживает,
насколько диск уже "оживлен" и, при повторном выполнении команды <b>start</b>, 
копирование продолжается с этой позиции.</p>

<p>Для поддержки согласованности тома пока одно или несколько его сплетений "оживляется",
драйвер <b>vinum</b> записывает на поддиски, уже восстановленные до места записи. Он 
может также читать из сплетения, если считываемая область уже была восстановлена.</p>

<h2><a name="gotchas">ОСОБЕННОСТИ</a></h2>

<p>Следующие особенности работы не связаны с ошибками, и у них есть весьма существенные 
причины, но, оказалось, что они вызывают непонимание. Каждая из этих особенностей
уже была описана в соответствующем разделе выше.</p>

<ol>
<li>Диски <b>vinum</b> являются разделами диска UNIX, и должны быть разделами типа 
<b>vinum</b>. Это отличается от драйвера <b>ccd</b>, которому необходимы разделы типа 4.2BSD.
Такое поведение драйвера <b>ccd</b> провоцирует опасные ошибки (в оригинале&nbsp;- <b>is an 
invitation to shoot yourself in the foot</b>. Тому, кто придумает адекватный перевод&nbsp;- 
приз. <i>Прим. В.К.</i>): при использовании <b>ccd</b> можно легко перезаписать файловую
систему. Утилита <b>vinum</b> этого не допустит.

<p>По аналогичным причинам команда <b>vinum start</b> не позволят создать диск на разделе
"<b>c</b>". Раздел "<b>c</b>" используется системой для представления всего диска, и должен
быть типа <b>unused</b>. Тут есть явный конфликт, который утилита <b>vinum</b> решает, 
просто не используя раздел "<b>c</b>".</p>
</li>
<li>При создании тома с несколькими сплетениями утилита <b>vinum</b> не инициализирует
сплетения автоматически. Это означает, что содержимое их неизвестно, но определенно
не согласовано. В результате, по умолчанию <b>vinum</b> устанавливает для всех вновь
созданных сплетений, кроме первого, состояние <b>faulty</b>. Чтобы синхронизировать их
с первым сплетением, необходимо их запустить, что приводит к копированию данных со
сплетения, находящегося в состоянии <b>up</b>. В зависимости от размера задействованных
поддисков, это может потребовать много времени.

<p>На практике пользователей не часто интересует, что было в сплетении при создании, и
другие диспетчеры томов жульничают, просто устанавливая всем сплетениям состояние
up. Утилита <b>vinum</b> предлагает два способа обеспечить перевод вновь созданных
сплетений в состояние <b>up</b>:</p>
<ul>
<li>Создать сплетения, а затем синхронизировать их с помощью команды <b>vinum start</b>.</li>
<li>Создать том (не сплетение) с ключевым словом <b>setupstate</b>, которое требует от
утилиты <b>vinum</b> игнорировать любые несогласованности и сразу переводить
сплетения в состояние <b>up</b>.</li>
</ul>
</li>
<li>Некоторые из команд, поддерживаемых в настоящее время утилитой <b>vinum</b>, фактически не нужны.
По непонятным мне причинам оказывается, что пользователи часто пытаются использовать команды
<a href="#label"><b>label</b></a> и <a href="#resetconfig"><b>resetconfig</b></a>, хотя,
в частности, <b>resetconfig</b> выдает всевозможные страшные предупреждения. Не используйте
эти команды без веских на то причин.
</li>
<li>Некоторые переходы из одного состояния в другое интуитивно непонятны. Фактчиески, не ясно,
ошибка это или особенность. Если оказывается, что вы не можете запустить объект, находящийся
в некотором странном состоянии, например, <b>reborn subdisk</b>, сначала попытайтесь перевести
его в состояние <b>stopped</b> с помощью команд <b>stop</b> или <b>stop -f</b>.
Если это сработает, вы затем сможете его запустить. Если окажется, что это единственный
способ выйти из ситуации, и более простые методы не срабатывают, сообщите, пожалуйста,
об этой ситуации.
</li>
<li>Если вы собираете модуль ядра с опцией <b>-DVINUMDEBUG</b>, надо утилиту
<b>vinum</b> тоже собирать с опцией <b>-DVINUMDEBUG</b>, поскольку размер некоторых
объектов данных, используемых обоими компонентами, зависит от этой опции.
Если этого не сделать, команды будут завершаться с выдачей соответствующего сообщения
об ошибке.
</li>
<li>Команда <b>vinum read</b> имеет особенно противный синтаксис. Когда-то она
была единственным способом запуска <b>vinum</b>, но сейчас предпочтительнее использовать
для этого команду <b>vinum start</b>. Команда <b>vinum read</b> должна использоваться
только в целях сопровождения. Обратите внимание, что ее синтаксис изменился, а аргументами
должны быть секции диска (slices), например, <b>/dev/da0</b>, а не разделы (partitions)
вроде <b>/dev/da0e</b>.
</li>
</ol>

<h2><a name="files">ФАЙЛЫ</a></h2>
<dl>
<dt><b>/dev/vinum</b></dt><dd>
каталог с файлами устройств для объектов <b>vinum</b></dd>
<dt><b>/dev/vinum/control</b></dt><dd>
управляющее устройство для <b>vinum</b></dd>
<dt><b>/dev/vinum/plex</b></dt><dd>
коталог, содержащий файлы устройств для сплетений <b>vinum</b></dd>
<dt><b>/dev/vinum/sd</b></dt><dd>
каталог, содержащий файлы устройств для поддисков <b>vinum</b></dd>
</dl>

<h2><a name="environment">СРЕДА</a></h2>

<dl>
<dt><b>VINUM_HISTORY</b></dt><dd>
Имя журнального файла, по умолчанию,&nbsp;- <b>/var/log/vinum_history</b>.</dd>
<dt><b>VINUM_DATEFORMAT</b></dt><dd>
Формат дат в журнальном файле, по умолчанию,&nbsp; - <b>"%e %b %Y %H:%M:%S"</b>.</dd>
<dt><b>EDITOR</b></dt><dd>
Имя редактора, который будет использоваться для редактирования файлов конфигурации,
по умолчанию&nbsp;- <b>vi</b>.</dd>
</dl>

<h2><a name="see_also">ССЫЛКИ</a></h2>
<dl><dt></dt><dd>
<a href="/man.shtml?topic=strftime&amp;category=3"><b>strftime(3)</b></a>,
<a href="/man.shtml?topic=vinum&amp;category=4"><b>vinum(4)</b></a>,
<a href="/man.shtml?topic=disklabel&amp;category=8"><b>disklabel(8)</b></a>,
<a href="/man.shtml?topic=newfs&amp;category=8"><b>newfs(8)</b></a>
<br>
<a href="http://www.vinumvm.org/vinum/"><b>http://www.vinumvm.org/vinum/</b></a>,<br>
<a href="http://www.vinumvm.org/vinum/how-to-debug.html"><b>http://www.vinumvm.org/vinum/how-to-debug.html</b></a>.
</dd>

<h2><a name="authors">АВТОРЫ</a></h2>
<dl><dt></dt><dd>
Грег Лихи (Greg Lehey) &lt;grog@lemis.com&gt;
</dd></dl>

<h2><a name="history">ИСТОРИЯ</a></h2>

<p>Утилита <b>vinum</b> впервые появилась в ОС FreeBSD 3.0. Компонент RAID-5 системы 
<b>vinum</b> был разработан для корпорации <b>Cybernet Inc.</b> (<b>www.cybernet.com</b>),
для ее продукта NetMAX.</p>

<h2><a name="bugs">ОШИБКИ</a></h2>

<p>Драйвер <a href="/man.shtml?topic=vinum&amp;category=4"><b>vinum(4)</b></a> не использует подсистему 
<a href="/man.shtml?topic=geom&amp;category=4"><b>geom(4)</b></a>, поэтому тома <a href="/man.shtml?topic=vinum&amp;category=4"><b>vinum(4)</b></a>
нельзя использовать для средств, использующих GEOM, например, 
<a href="/man.shtml?topic=gbde&amp;category=8"><b>gbde(8)</b></a>.</p>

<p align="center">FreeBSD 4.9  5 мая 2003 года</p>

<p align="center"><font size="-2">Copyleft (no c) - Fuck copyright! 2003-2004 <a href="mailto:valera@openxs.kiev.ua">В. Кравчук</a>,
<a href="http://ln.com.ua/~openxs">OpenXS Initiative</a>, перевод на русский язык
</font></p>

<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="vinum" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</dl></body>
<!---------------------------------------------  0  ---------------------------------------------->
