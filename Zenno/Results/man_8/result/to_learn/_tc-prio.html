
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN tc-prio (8) Команды системного администрирования (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, tc-prio"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="tc-prio" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">tc-prio (8)</font><hr><li>&gt;&gt; <a href="/man.shtml?topic=tc-prio&amp;category=8&amp;russian=0"><u>tc-prio</u></a> (8) <font color="#555555"> ( Русские man: Команды системного администрирования )</font></li><li> <a href="/man.shtml?topic=tc-prio&amp;category=8&amp;russian=2"><u>tc-prio</u></a> (8) <font color="#555555"> ( Linux man: Команды системного администрирования )</font></li>
<a name="lbAB">&nbsp;</a>
<h2>ИМЯ</h2>

PRIO - приоритетная очередь
<a name="lbAC">&nbsp;</a>
<h2>СИНТАКСИС</h2>

<b>tc qdisc ... dev</b>

УСТРОЙСТВО
<b>( parent</b>

classid 
<b>| root) [ handle </b>

major: 
<b>] prio [ bands </b>

bands
<b>] [ priomap</b>

band,band,band... 
<b>] [ estimator </b>

interval timeconstant
<b>]</b>

<p>
<a name="lbAD">&nbsp;</a>
</p><h2>ОПИСАНИЕ</h2>

Очередь PRIO - простая реализация постановки в
очередь, которая поддерживает классы, и содержит опредёленное число классов
с различным приоритетом. Очереди классов освобождаются в порядке
снижения приоритета. PRIO - планировщик,который никогда не
задерживает
пакеты - это работа внутренних очередей.
<p>
Очень полезно использовать PRIO для снижения задержки в случае, когда нет
необходимости замедлять трафик.
</p><p>
<a name="lbAE">&nbsp;</a>
</p><h2>АЛГОРИТМ</h2>

При создании с помощью 'tc qdisc add', создается фиксированное число
полос.  Каждая полоса является классом, хотя для PRIO невозможно добавлять
классы вручную при помощи 'tc qdisc add', вместо этого число создаваемых полос
должно быть указано в командной строке, добавляющей PRIO к вышестоящей очереди.
<p>
При освобождении пакета из очереди вначале происходит попытка использовать
полосу 0 и в случае, если она не доставила пакет, PRIO будет пытаться
использовать полосу 1, и так далее. Соответственно, пакеты с максимальной
надёжностью должны быть отправлены на полосу 0, с минимальной задержкой - на
полосу 1, и все оставшиеся - на полосу 2.
</p><p>
Так как очередь PRIO сама по себе будет иметь дополнительный (minor) номер
равный 0, полоса 0 на самом деле major:1, полоса 1 является major:2, и т.д.
Вместо major, подставьте основной номер, назначенный очереди в момент её
создания при помощи 'tc qdisc add" с параметром 
<b>handle.</b>

</p><p>
<a name="lbAF">&nbsp;</a>
</p><h2>КЛАССИФИКАЦИЯ</h2>

Три метода доступны в PRIO для определения, в какую полосу будет помещён пакет.
<dl compact="">
<dt>Из пользовательского пространства (userspace)</dt><dd>
Процесс с достаточными привилегиями может указать требуемый класс
напрямую при помощи SO_PRIORITY, см.
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=tc&amp;category=7">tc</a>(7).</b>

</dd><dt>С tc-фильтром</dt><dd>
tc-фильтр, добавленный к корневой очереди, может указывать класс напрямую.
</dd><dt>С использованием priomap</dt><dd>
Основываясь на приоритете пакета, который, в свою очередь, получается из типа
услуги, назначенного пакету.

<br>&nbsp;Для&nbsp;этого&nbsp;типа&nbsp;очереди&nbsp;специфичен&nbsp;только&nbsp;priomap.&nbsp;
</dd></dl>
<a name="lbAG">&nbsp;</a>
<h2>ПАРАМЕТРЫ</h2>

<dl compact="">
<dt>bands</dt><dd>
Число полос, если отличается от используемых трёх по умолчанию.
<b>priomap</b>

также должен быть обновлен.
</dd><dt>priomap</dt><dd>
priomap назначает класс в зависимости от приоритета пакета. Приоритет может быть
или напрямую установлен из пользовательского пространства или быть определён на
основе типа услуги.
<p>
Определяет, каким образом приоритеты пакета, назначенные ядром, влияют
на выбор полосы. Выбор основывается на TOS-октете пакета, который
выглядит приблизительно так:
</p><p>
</p><pre>0   1   2   3   4   5   6   7
+---+---+---+---+---+---+---+---+
|           |               |   |
|СТАРШИНСТВО|      TOS      |MBZ|
|           |               |   |
+---+---+---+---+---+---+---+---+
</pre>

<p>
Четыре бита поля TOS определены как:
</p><p>
</p><pre>Двоичный Десятичный Значение
---------------------------------------------------------------
1000     8          Минимизировать задержку (minimize delay - md)
0100     4          Максимизировать пропускную способность (maximize
                    thorughput - mt)
0010     2          Максимальная надежность (maximal reliability - mr)
0001     1          Минимизировать денежную стоимость (minimize monetary
                    cost - mmc)
0000     0          Обычное обслуживание (normal service)
</pre>

<p>
Так как справа от этих полей находится 1 бит, действительное значение TOS
вдвое больше значение битов TOS. Tcpdump -v -v показывает значение всего
поля TOS, а не только четырех битов. Это значение, которые вы видите в первом
столбце следующей таблицы:
</p><p>
</p><pre>TOS     Биты  Значение                 Linux Приоритет   Полоса
---------------------------------------------------------------
0x0     0     Обычное обслуживание     0     Best Effort     1
0x2     1     Минимизировать затраты   1     Filler          2
0x4     2     Макс. надежность         0     Best Effort     1
0x6     3     mmc+mr                   0     Best Effort     1
0x8     4     Макс. пропускн. способн. 2     Bulk            2
0xa     5     mmc+mt                   2     Bulk            2
0xc     6     mr+mt                    2     Bulk            2
0xe     7     mmc+mr+mt                2     Bulk            2
0x10    8     Минимизировать задержку  6     Interactive     0
0x12    9     mmc+md                   6     Interactive     0
0x14    10    mr+md                    6     Interactive     0
0x16    11    mmc+mr+md                6     Interactive     0
0x18    12    mt+md                    4     Int. Bulk       1
0x1a    13    mmc+mt+md                4     Int. Bulk       1
0x1c    14    mr+mt+md                 4     Int. Bulk       1
0x1e    15    mmc+mr+mt+md             4     Int. Bulk       1
</pre>

<p>
Второй столбец содержит значение соответствующих четырех битов TOS, за
которыми следует их расшифрованное значение. К примеру, 15 обозначает пакет,
которые требует минимальные денежные затраты, максимальную надежность,
максимальную скорость прохождения и минимальную задержку.
</p><p>
Четвертый столбец перечисляет, каким образом ядро Linux интерпретирует биты
TOS, и показывает, какие приоритеты ставятся им в соответствие.
</p><p>
Последний столбец показывает используемый по умолчанию priomap. В
командной строке, priomap по умолчанию выглядит так:
</p><p>
<br>&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;2,&nbsp;2,&nbsp;2,&nbsp;1,&nbsp;2,&nbsp;0,&nbsp;0,&nbsp;1,&nbsp;1,&nbsp;1,&nbsp;1,&nbsp;1,&nbsp;1,&nbsp;1,&nbsp;1
</p><p>
Это означает, что приоритету 4, например, будет поставлена в соответствие
полоса номер 1. priomap также разрешает использовать более высокие приоритеты
(&gt;7), которые не соответствуют значениям TOS, но устанавливаются другими
способами.
</p><p>
Эта таблица из RFC 1349 (обратитесь к RFC за дополнительной информацией)
объясняет, как приложения могут устанавливать свои биты TOS:
</p><p>
</p><pre>TELNET                   1000           (минимальная задержка)
FTP
        Control          1000           (минимизировать задержку)
        Data             0100           (макс. пропускн. способность)

TFTP                     1000           (минимизировать задержку)

SMTP 
        Command phase    1000           (минимальная задержка)
        DATA phase       0100           (макс. пропускн. способность)

Domain Name Service
        UDP Query        1000           (минимальная задержка)
        TCP Query        0000
        Zone Transfer    0100           (макс. пропускн. способность)

NNTP                     0001           (минимальные денежные затраты)

ICMP
        Errors           0000
        Requests         0000 (как правило)
        Responses        &lt;такой же, как и в Request&gt; (как правило)
</pre>

<p>
</p><p>
</p></dd></dl>
<a name="lbAH">&nbsp;</a>
<h2>КЛАССЫ</h2>

Классы PRIO не могут настраиваться - они автоматически
создаются, при добавлении очереди PRIO. Тем не менее, каждый класс может
содержать ещё одну очередь.
<p>
<a name="lbAI">&nbsp;</a>
</p><h2>ОШИБКИ</h2>

Большие объемы трафика в младших полосах могут вызывать "голод" в старших
полосах. Это может быть предотвращено добавлением ограничения скорости
(например, shaper,
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=tc-tbf&amp;category=8">tc-tbf</a>(8)</b>

)
к этим полосам, чтобы быть уверенным, что они не захватят соединение полностью.
<p>
<a name="lbAJ">&nbsp;</a>
</p><h2>АВТОРЫ</h2>

Алексей Н. Кузнецов &lt;<a href="mailto:kuznet@ms2.inr.ac.ru">kuznet@ms2.inr.ac.ru</a>&gt;,  J Hadi Salim
&lt;<a href="mailto:hadi@cyberus.ca">hadi@cyberus.ca</a>&gt;. Эта страница руководства поддерживается Бертом Хубертом (Bert
Hubert) &lt;<a href="mailto:ahu@ds9a.nl">ahu@ds9a.nl</a>&gt;
<p>
<a name="lbAK">&nbsp;</a>
</p><h2>ПЕРЕВОД</h2>

Перевод с английского Виктор Ерёмин &lt;<a href="mailto:ErV2005@rambler.ru">ErV2005@rambler.ru</a>&gt; 2007.
<p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">ИМЯ</a></dt><dd>
</dd><dt><a href="#lbAC">СИНТАКСИС</a></dt><dd>
</dd><dt><a href="#lbAD">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAE">АЛГОРИТМ</a></dt><dd>
</dd><dt><a href="#lbAF">КЛАССИФИКАЦИЯ</a></dt><dd>
</dd><dt><a href="#lbAG">ПАРАМЕТРЫ</a></dt><dd>
</dd><dt><a href="#lbAH">КЛАССЫ</a></dt><dd>
</dd><dt><a href="#lbAI">ОШИБКИ</a></dt><dd>
</dd><dt><a href="#lbAJ">АВТОРЫ</a></dt><dd>
</dd><dt><a href="#lbAK">ПЕРЕВОД</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="tc-prio" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
