
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN raidctl (8) Команды системного администрирования (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, raidctl"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="raidctl" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">raidctl (8)</font><hr><li> <a href="/man.shtml?topic=raidctl&amp;category=1&amp;russian=4"><u>raidctl</u></a> (1) <font color="#555555"> ( Solaris man: Команды и прикладные программы пользовательского уровня )</font></li><li>&gt;&gt; <a href="/man.shtml?topic=raidctl&amp;category=8&amp;russian=0"><u>raidctl</u></a> (8) <font color="#555555"> ( Русские man: Команды системного администрирования )</font></li>
<table width="100%" border="0">
<tbody><tr>
<td><h1>raidctl(8)</h1></td>
<td><h2 align="center">Руководство системного администратора FreeBSD</h2></td>
<td><h1 align="right">raidctl(8)</h1></td>
</tr>
</tbody></table>

<h2><a name="name">НАЗВАНИЕ</a></h2>
<p><b>raidctl</b> - утилита конфигурирования для драйвера диска RAIDframe</p>

<h2><a name="synopsys">СИНТАКСИС</a></h2>
<dl><dt></dt><dt></dt><dd><tt>
raidctl [-v] -a <b>компонент</b> <b>устройство</b><br>
raidctl [-v] -A [yes | no | root] <b>устройство</b><br>
raidctl [-v] -B <b>устройство</b><br>
raidctl [-v] -c <b>файл_конфигурации</b><br>
raidctl [-v] -C <b>файл_конфигурации</b><br>
raidctl [-v] -f <b>компонент</b> <b>устройство</b><br>
raidctl [-v] -F <b>компонент</b> <b>устройство</b><br>
raidctl [-v] -g <b>компонент</b> <b>устройство</b><br>
raidctl [-v] -i <b>устройство</b><br>
raidctl [-v] -I <b>серийный_номер</b> <b>устройство</b><br>
raidctl [-v] -p <b>устройство</b><br>
raidctl [-v] -P <b>устройство</b><br>
raidctl [-v] -r <b>компонент</b> <b>устройство</b><br>
raidctl [-v] -R <b>компонент</b> <b>устройство</b><br>
raidctl [-v] -s <b>устройство</b><br>
raidctl [-v] -S <b>устройство</b><br>
raidctl [-v] -u <b>устройство</b>
</tt></dd></dl>

<h2><a name="description">ОПИСАНИЕ</a></h2>

<p><b>raidctl</b> - это пользовательская программа для управления устройствами 
<a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>, дисковыми устройствами RAIDframe.
<b>raidctl</b>, в основном, используется для динамического конфигурирования и
деконфигурирования дисков RAIDframe. Дополнительную информацию об устройствах RAIDframe
см. на странице справочного руководства <a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>.</p>

<p>Предполагается, что читатель хотя бы поверхностно знаком с RAID и соответствующей
терминологией.</p>

<p>Опции команды <b>raidctl</b> следующие:</p>
<dl>
<dt><b><a name="a">-a компонент устройство</a></b></dt><dd>
Добавить <b>компонент</b> как диск горячей замены для <b>устройства</b>.</dd>
<dt><b><a name="A_yes">-A yes устройство</a></b></dt><dd>
Сделать RAID-набор автоматически конфигурируемым. RAID-набор будет автоматически
конфигурироваться при загрузке перед монтированием корневой файловой системы.
Учтите, что все компоненты набора должны быть обозначены в метке диска как RAID.</dd>
<dt><b><a name="A_no">-A no устройство</a></b></dt><dd>
Отключить автоматическое конфигурирование для RAID-набора.</dd>
<dt><b><a name="A_root">-A root устройство</a></b></dt><dd>
Сделать RAID-набор автоматически конфигурируемым, а также пометить его как пригодный для
корневого раздела. Сконфигурированный таким образом RAID-набор будет использоваться 
вместо загрузочного диска в качестве корневого устройства. Все компоненты набора
должны быть обозначены в метке диска как RAID. Учтите, что загружаемое ядро
пока что не может находиться на RAID-наборе.</dd>
<dt><b><a name="B">-B устройство</a></b></dt><dd>
Инициировать обратное копирование восстановленных данных с резервного диска на
исходный. Это делается после сбоя компонента и воссоздания сбойного диска на резервном.</dd>
<dt><b><a name="c">-c файл_конфигурации</a></b></dt><dd>
Сконфигурировать устройство RAIDframe в соответствии с конфигурацией в указанном файле.
Описание содержимого <b>файла_конфигурации</b> представлено далее.</dd>
<dt><b><a name="C">-C файл_конфигурации</a></b></dt><dd>
Аналогично <b>-c</b>, но выполняет конфигурирование принудительно. Это необходимо при
первоначальном конфигурировании RAID-набора.</dd>
<dt><b><a name="f">-f компонент устройство</a></b></dt><dd>
Пометить указанный <b>компонент</b> как сбойный, но не инициировать пересоздание этого
компонента.</dd>
<dt><b><a name="F">-F компонент устройство</a></b></dt><dd>
Пометить как сбойный указанный <b>компонент</b> устройства и немедленно начать
пересоздание сбойного диска на имеющемся диске горячего резерва. Это&nbsp;-
один из механизмов, используемый для запуска процесса пересоздания, если на
компоненте действительно произошел аппаратный сбой.</dd>
<dt><b><a name="g">-g компонент устройство</a></b></dt><dd>
Получить метку указанного <b>компонента</b>.</dd>
<dt><b><a name="i">-i устройство</a></b></dt><dd>
Инициализировать устройство RAID. В частности, (переписать) информацию о четности
на выбранном устройстве. Это ОБЯЗАТЕЛЬНО делать для всех RAID-наборов перед разметкой
RAID-устройства и созданием на нем файловых систем.</dd>
<dt><b><a name="I">-I серийный_номер устройство</a></b></dt><dd>
Инициализировать метки на всех компонентах устройства. <b>Серийный_номер</b> используется
как один из ключей при определении того, принадлежит ли определенный набор компонентов
к одному RAID-набору. Хотя это и не проверяется, в разных RAID-наборах надо использовать
разные серийные номера. Этот шаг <b>НЕОБХОДИМО</b> выполнять при создании нового
RAID-набора.</dd>
<dt><b><a name="p">-p устройство</a></b></dt><dd>
Проверить статус четности на RAID-наборе. Команда выдает сообщение о состоянии
и успешно заврешает работу, если информация о четности актуальна.</dd>
<dt><b><a name="P">-P устройство</a></b></dt><dd>
Проверить статус четности на RAID-наборе и проинициализировать (переписать)
информацию о четности, если она не является заведомо актуальной. Эта опция обычно
используется после сбоя системы (и перед вызовом <a href="/man.shtml?topic=fsck&amp;category=8"><b>fsck(8)</b></a>),
чтобы гарантировать целостность информации о четности.</dd>
<dt><b><a name="r">-r компонент устройство</a></b></dt><dd>
Удалить резервный диск, заданный как <b>компонент</b>, из набора доступных 
резервных компонентов.</dd>
<dt><b><a name="R">-R компонент устройство</a></b></dt><dd>
Пометить указанный <b>компонент</b> как сбойный, при необходимости, и сразу же начать
воссоздание компонента. Это пригодится для воссоздания сбойного компонента после
его замены.</dd>
<dt><b><a name="s">-s устройство</a></b></dt><dd>
Выдать информацию о состоянии всех компонентов и резервных дисков указанного
<b>устройства</b> RAIDframe.</dd>
<dt><b><a name="S">-S устройство</a></b></dt><dd>
Проверить состояние процессов перезаписи четности, пересоздания компонентов и
обратного копирования данных на компоненты. Выдать, насколько зевершен каждый
из этих процессов.</dd>
<dt><b><a name="u">-u устройство</a></b></dt><dd>
Деконфигурировать устройство RAIDframe.</dd>
<dt><b><a name="v">-v</a></b></dt><dd>
Выдавать более детальную информацию. Для операций вроде пересоздания, перезаписи
четности и обратного копирования выдавать индикатор завершенности.</dd>
</dl>

<p>Устройство, используемое утилитой <b>raidctl</b>, задается в командной строке.
Можнео указывать либо полное имя устройства, например, <b>/dev/rraid0d</b> для
архитектуры i386 и <b>/dev/rraid0c</b> для всех остальных, или просто <b>raid0</b>
(ему будет соответствовать устройство <b>/dev/rraid0d</b>).</p>

<p>Формат файла конфигурации - сложный, и здесь представлено лишь краткое его 
описание. В файлах конфигурации '<b>#</b>' обозначает начало комментария.</p>

<p>В файле конфигурации есть 4 обязательных раздела и 2 необязательных. 
Каждый раздел начинается со слова '<b>START</b>', после которого идет имя раздела
и параметры конфигурации этого раздела. Первый раздел - '<b>array</b>', задает
количество строк, столбцов и резервных дисков в RAID-наборе. Например:</p>
<pre>   START array
   1 3 0
</pre>
<p>задает массив из одной строки, 3 столбцов и 0 резервных дисков. Учтите, что хотя
так можно задавать и многомерные массивы, они <b>НЕ</b> поддерживаются драйвером.</p>

<p>Второй раздел, '<b>disks</b>', задает фактические компоненты устройства.
Например, раздел:</p>
<pre>   START disks
   /dev/da0s1e
   /dev/da1s1e
   /dev/da2s1e
</pre>
<p>задает три диска-компонента для использования в RAID-устройстве. Если любой из
указанных дисков нельзя найти при конфигурировании RAID-устройства, он будет помечен
как сбойный и система будет работать в деградированном режиме. Учтите, что требуется
обеспечить неизменность порядка компонентов в файле конфигурации между 
конфигурированиями RAID-устройства. Изменение порядка компонентов приведет к
потере данных, если набор конфигурируется с опцией <a href="#C"><b>-C</b></a>.
Обычно, если задана опция <a href="#c"><b>-c</b></a>, RAID-набор не будет
конфигурироваться при изменении порядка компонентов.</p>

<p>Следующий раздел, '<b>spare</b>', - не обязательный, и, если есть, задает
устройства для использования в качестве "горячего резерва". Эти устройства 
подключены, но не используются активно драйвером RAID пока не произойдет сбой одного
из основных компонентов. Простой раздел '<b>spare</b>' может иметь вид:</p>
<pre>   START spare
   /dev/da3s1e
</pre>
<p>для конфигурации с одним резервным компонентом. Если конфигурация не предполагает
использование дисков горячего резерва, раздел '<b>spare</b>' можно не задавать.</p>

<p>Следующий раздел - '<b>layout</b>'. Он описывает общие параметры организации
для RAID-устройства и предоставляет информацию о количестве секторов на полосу,
полос на информацию о четности, полос на единицу восстановления и конфигурацию четности,
которую надо использовать. Этот раздел может иметь вид:</p>
<pre>   START layout
   # sectPerSU SUsPerParityUnit SUsPerReconUnit RAID_level
   32 1 1 5
</pre>

<p>Количество секторов на полосу (sectors per stripe) задает коэффициент чередования,
в блоках; т.е. количество подряд идущих секторов для записи на каждый компонент в виде
полосы. Правильный выбор этого значения (в рассмотренном примере, 32)&nbsp;- 
тема многих исследований по архитектурам RAID. Количество полос на информацию о
четности и полос на единицу восстановления обычно устанавливается равным 1.
Хотя определенные значения больше 1 допускаются, обсуждение допустимых значений
и последствий использования других значений, кроме 1, выходит за рамки этого
документа. Последнее значение в этом разделе (в рассмотренном примере, 5) 
задает требуемую конфигурацию четности. Допускаются следующие значения:</p>

<table cellpadding="4" width="100%" border="0">
<tbody><tr><td><b>0</b></td><td>RAID уровня 0.</td><td>Никакой четности, только простое 
разбиение на полосы.</td></tr>
<tr><td><b>1</b></td><td>RAID уровня 1.</td><td>Зеркалирование. Информация о четности -
просто зеркало.</td></tr>
<tr><td><b>4</b></td><td>RAID уровня 4.</td><td>Разбиение на полосы по компонентам,
с сохранением информации о четности на последнем компоненте.</td></tr>
<tr><td><b>5</b></td><td>RAID уровня 5.</td><td>Разбиение на полосы по компонентам,
с распределением информации о четности по всем компонентам.</td></tr>
</tbody></table>

<p>Есть и другие допустимые значения, включая чередование четности (Even-Odd parity),
RAID уровня 5 с циклическим резервированием (rotated sparing), цепочной декластеризацией
(Chained declustering) и перемежающейся декластеризацией (Interleaved
declustering), но на момент написания этого руководства код для этих операций с
четностью еще не был протестирован в ОС FreeBSD.</p>

<p>Следующий обязательный раздел - раздел '<b>queue</b>'. Чаще всего его задают
так:</p>
<pre>   START queue
   fifo 100
</pre>
<p>где метод организации очереди задается как <b>fifo</b> (первым вошел, первым вышел),
а размер очереди для каждого компонента ограничивается 100 запросами. Можно указывать и
другие методы организации очереди, но их обсуждение выходит за рамки данного
документа.</p>

<p>Последний раздел, '<b>debug</b>', - не обязательный. Подробнее о нем см. в 
документации по <b>RAIDframe</b>, которая описана в разделе 
<a href="#history"><b>ИСТОРИЯ</b></a>.</p>

<p>Пример полного файла конфигурации см. в разделе 
<a href="#examples">"<b>ПРИМЕРЫ</b>"</a>.</p>

<h2><a name="examples">ПРИМЕРЫ</a></h2>

<p>Системным администраторам настоятельно рекомендуется перед использованием драйвера
RAID для реальных производственных систем хорошо ознакомиться с возможностями
утилиты <b>raidctl</b>, а также понять, как работает процесс восстановления
компонентов. Примеры в этом разделе будут посвящены конфигурированию нескольких
различных RAID-наборов с разной степенью избыточности. Проработав эти примеры,
администраторы смогут хорошо прочувствовать, как конфигурировать RAID-наборы и как
инициировать пересоздание вышедших из строя компонентов.</p>

<p>В следующих примерах '<b>raid0</b>' будет использоваться для обозначения
RAID-устройства. В зависимости от архитектуры, реально надо будет использовать
'<b>/dev/rraid0c</b>' или '<b>/dev/rraid0d</b>' вместо '<b>raid0</b>'.</p>

<h3>Инициализация и конфигурирование</h3>

<p>Начальный шаг в конфигурировании RAID-набора&nbsp;- идентифицировать компоненты,
которые будут использоваться в RAID-наборе. Все компоненты должны быть одного размера.
Каждый компонент должен в <b>disklabel</b> иметь тип <b>FS_RAID</b>, а типичная
запись <b>disklabel</b> для компонента <b>RAID</b> может иметь вид:</p>
<pre>   f:  1800000200495   RAID      # (Cyl.  405*- 4041*)
</pre>
<p>Хотя <b>FS_BSDFFS</b> тоже подходит в качестве типа компонента, тип <b>FS_RAID</b>
предпочтительнее использовать для механизма RAIDframe, и он является обязательным для
поддержки некоторых возможностей вроде автоматического конфигурирования.
В процессе начального конфигурирования каждого RAID-набора, каждому компоненту будет
задана "метка компонента". "Метка компонента" содержит важную информацию о компоненте,
включая заданный пользователем серийный номер, строку и столбец этого компонента в 
RAID-наборе, уровень избыточности RAID-набора, счетчик изменений ('modification 
counter') и признак известной корректности информации о четности (если она есть) для
компонента. Метки компонентов являются составной частью RAID-набора, поскольку
они используются для проверки того, что компоненты сконфигурированы в правильном порядке,
а также для хранения другой жизненно важной информации о RAID-наборе. 
Метки компонентов также необходимы для автоматического выявления и конфигурирования
RAID-наборов в ходе загрузки. Чтобы метка компонента считалась допустимой, она
должна быть согласована с метками других компонентов в наборе. Например, должны быть
согласованы серийный номер, счетчик изменений, количество строк и столбцов. Если
любой из этих параметров отличается, то компонент не считается частью набора.
Подробнее о метках компонентов см. на странице справочного руководства 
<a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>.</p>

<p>Как только компоненты идентфицированы и диски имеют соответствующие метки,
молжно использовать утилиту <b>raidctl</b> для конфигурирования устройства
<a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>. Чтобы сконфигурировать устройство,
необходимо создать файл конфигурации вида:</p>
<pre>   START array
   # numRow numCol numSpare
   1 3 1

   START disks
   /dev/da1s1e
   /dev/da2s1e
   /dev/da3s1e

   START spare
   /dev/da4s1e

   START layout
   # sectPerSU SUsPerParityUnit SUsPerReconUnit RAID_level_5
   32 1 1 5

   START queue
   fifo 100
</pre>
<p>Представленный выше файл конфигурации задает набор RAID 5, состоящий из
компонентов <b>/dev/da1s1e</b>, <b>/dev/da2s1e</b> и <b>/dev/da3s1e</b>, и
использующий <b>/dev/da4s1e</b> в качестве устройства "горячего резерва"
на случай сбоя одного из трех основных дисков. Набор RAID 0 можно задать
аналогично:</p>
<pre>   START array
   # numRow numCol numSpare
   1 4 0

   START disks
   /dev/da1s10e
   /dev/da1s11e
   /dev/da1s12e
   /dev/da1s13e

   START layout
   # sectPerSU SUsPerParityUnit SUsPerReconUnit RAID_level_0
   64 1 1 0

   START queue
   fifo 100
</pre>
<p>В этом случае, устройства <b>/dev/da1s10e</b>, <b>/dev/da1s11e</b>, 
<b>/dev/da1s12e</b> и <b>/dev/da1s13e</b> являются компонентами, образующими
этот RAID-набор. Обратите внимание, что устройств горяего резерва в наборе
RAID 0 нет, поскольку нет способа восстановить данные при сбое любого из компонентов.</p>

<p>Для набора RAID 1 (зеркалирования) можно использовать следующую конфигурацию:</p>
<pre>   START array
   # numRow numCol numSpare
   1 2 0

   START disks
   /dev/da2s10e
   /dev/da2s11e

   START layout
   # sectPerSU SUsPerParityUnit SUsPerReconUnit RAID_level_1
   128 1 1 1

   START queue
   fifo 100
</pre>
<p>В этом случае, <b>/dev/da2s10e</b> и <b>/dev/da2s11e</b> - два компонента 
зеркального нaбора. Хотя в этой конфигурации не заданы компоненты горячего 
резервирования, их легко можно добавить, так же, как и в рассмотренной выше
конфигурации RAID 5. Учтите также, что наборы RAID 1 в настоящее время
ограничены только двумя компонентами. Сейчас n-кратное зеркалирование 
невозможно.</p>

<p>При первом конфигурировании RAID-набора необходимо использовать опцию
<a href="#C"><b>-C</b></a>:</p>
<pre>   raidctl -C raid0.conf
</pre>
<p>где '<b>raid0.conf</b>' - имя файла конфигурации RAID. Опция <b>-C</b>
обеспечивает успешное конфигурирование, даже если какие-то метки компонентов
некорректны. Опцию <b>-C</b> не стоит использовать "походя" в ситуациях, не
связанных с первоначальным конфигурированием, поскольку если система отказывается
конфигурировать RAID-набор, вероятно, тому есть веские приичны. После выполнения
первоначального конфигурирования (и добавления соответствующих меток компонентов с 
помощью опции <a href="#I"><b>-I</b></a>) обычно устройство <b>raid0</b> можно сконфигурировать с помощью команды:</p>
<pre>   raidctl -c raid0.conf
</pre>
<p>Когда RAID-набор конфигурируется впервые, необходимо проинициализировать
метки компонентов, а также проинициализировать информацию о четности для RAID-набора.
Инициализация меток компонентов выполняется командой:</p>
<pre>   raidctl -I 112341 raid0
</pre>
<p>где '<b>112341</b>' - заданный пользователем серийный номер для RAID-набора. Эта
инициализация требуется для всех RAID-наборов. Кроме того, настоятельно рекомендуется
использование различных серийных номеров для разных RAID-наборов, поскольку
использование одного серийного номера для всех RAID-наборов просто уменьшает полезность
процедуры проверки меток компонентов.</p>

<p>Инициализация RAID-набора выполняется с помощью опции <a href="#i"><b>-i</b></a>.
Эта инициализация <b>должна</b> быть выполнена для всех RAID-наборов, поскольку,
среди прочего, при этом проверяется корректность информации о чтености (если она
поддерживается) для RAID-набора. Поскольку эта инициализация может требовать достаточно
много времени, можно использовать опцию <a href="#v"><b>-v</b></a> вместе с <b>-i</b>:</p>
<pre>   raidctl -iv raid0
</pre>
<p>Это даст более подробное отображение состояния процесса инициализации:</p>
<pre>   Initiating re-write of parity
   Parity Re-write status:
    10% |****                                         | ETA:  06:03 /
</pre>
<p>В результате выдается 'Процент выполнения' в числовом и графическом виде,
а также оценочное время до завершения процесса.</p>

<p>Поскольку именно информация о четности обеспечивает "избыточность" в RAID, 
принципиально важно максимально обепечить ее корректность. Если информация
о четности некорректна, нет гарантии, что данные не будут потеряны при сбое
компонента.</p>

<p>Как только известно, что информация о четности корректна, можно безопасно
выполнять команды <a href="/man.shtml?topic=bsdlabel&amp;category=8"><b>disklabel(8)</b></a>, 
<a href="/man.shtml?topic=newfs&amp;category=8"><b>newfs(8)</b></a> или <a href="/man.shtml?topic=fsck&amp;category=8"><b>fsck(8)</b></a> 
для устройства или его файловых систем, а затем&nbsp;- монтировать файловые системы
для использования.</p>

<p>При определенных обстоятельствах (например, дополнительный компонент еще не
доставлен или данные надо перенести с диска, который затем станет компонентом массива)
было бы желательно сконфигурировать набор RAID 1 с единственным компонентом. Этого
можно добиться, конфигурируя набор с физически существующим компонентом (в
качестве первого или второго) и "поддельным" компонентом. В следующей конфигурации:</p>
<pre>   START array
   # numRow numCol numSpare
   1 2 0

   START disks
   /dev/da6s1e
   /dev/da0s1e

   START layout
   # sectPerSU SUsPerParityUnit SUsPerReconUnit RAID_level_1
   128 1 1 1

   START queue
   fifo 100
</pre>
<p><b>/dev/da0s1e</b> - реальный компонент, и будет использоваться как второй диск
в наборе RAID 1. Компонент <b>/dev/da6s1e</b>, который должен существовать, но не
обязательно быть связан с физическим устройством, используется просто в качестве
"заместителя". Конфигурирование (с помощью опций <a href="#C"><b>-C</b></a> и
<a href="#I"><b>-I 12345</b></a>, как было показано выше) проходит нормально, 
но процессу инициализации RAID-набора придется ждать, пока все физические компоненты не
будут доступны. После конфигурирования этот набор можно использовать как обычно,
но работать он будет в деградированном режиме. Как только будет получен второй
физичесий компонент, его можно будет добавить на ходу, зеркалировать
существующие данные и возобновить нормальную работу.</p>

<h3>Сопровождение RAID-набора</h3>
<p>После первоначальной инициализации информации о четности, команда:</p>
<pre>   raidctl -p raid0
</pre>
<p>может использоваться для проверки текущего состояния информации о четности.
Для проверки информации о четности и ее пересоздания при необходимости (например,
после нештатной остановки) используется команда:</p>
<pre>   raidctl -P raid0
</pre>
<p>Учтите, что перезапись четности может выполняться одновременно с другими
действиями с RAID-массивом (например, пока для файловой системы на RAID-наборе
выполняется команда <a href="/man.shtml?topic=fsck&amp;category=8"><b>fsck(8)</b></a>). Однако: для максимальной
эффективности RAID-набора надо удостовериться в корректности информации о четности
до изменения любых данных в наборе.</p>

<p>Чтобы узнать состояние RAID-набора, можно использовать следующую команду:</p>
<pre>   raidctl -s raid0
</pre>
<p>Результат ее выполнения будет иметь вид:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: optimal
              /dev/da3s1e: optimal
   Spares:
              /dev/da4s1e: spare
   Component label for /dev/da1s1e:
      Row: 0 Column: 0 Num Rows: 1 Num Columns: 3
      Version: 2 Serial Number: 13432 Mod Counter: 65
      Clean: No Status: 0
      sectPerSU: 32 SUsPerPU: 1 SUsPerRU: 1
      RAID Level: 5  blocksize: 512 numBlocks: 1799936
      Autoconfig: No
      Last configured as: raid0
   Component label for /dev/da2s1e:
      Row: 0 Column: 1 Num Rows: 1 Num Columns: 3
      Version: 2 Serial Number: 13432 Mod Counter: 65
      Clean: No Status: 0
      sectPerSU: 32 SUsPerPU: 1 SUsPerRU: 1
      RAID Level: 5  blocksize: 512 numBlocks: 1799936
      Autoconfig: No
      Last configured as: raid0
   Component label for /dev/da3s1e:
      Row: 0 Column: 2 Num Rows: 1 Num Columns: 3
      Version: 2 Serial Number: 13432 Mod Counter: 65
      Clean: No Status: 0
      sectPerSU: 32 SUsPerPU: 1 SUsPerRU: 1
      RAID Level: 5  blocksize: 512 numBlocks: 1799936
      Autoconfig: No
      Last configured as: raid0
   Parity status: clean
   Reconstruction is 100% complete.
   Parity Re-write is 100% complete.
   Copyback is 100% complete.
</pre>
<p>Это показывает, что с RAID-набором все в порядке. Важны здесь строки комопнентов
со значениями '<b>optimal</b>', а также строка '<b>Parity status</b>', свидетельствующая
о том, что информация о четности актуальна. Учтите, что если на RAID-наборе
есть открытые файловые системы, отдельные компоненты не будут "чистыми" ('<b>clean</b>'),
но весь набор в целом все равно может быть в состоянии <b>clean</b>.</p>

<p>Для проверки метки компонента <b>/dev/da1s1e</b> используется следующая команда:</p>
<pre>   raidctl -g /dev/da1s1e raid0
</pre>
<p>Результат выполнения этой команды будет иметь вид:</p>
<pre>   Component label for /dev/da1s1e:
      Row: 0 Column: 0 Num Rows: 1 Num Columns: 3
      Version: 2 Serial Number: 13432 Mod Counter: 65
      Clean: No Status: 0
      sectPerSU: 32 SUsPerPU: 1 SUsPerRU: 1
      RAID Level: 5  blocksize: 512 numBlocks: 1799936
      Autoconfig: No
      Last configured as: raid0
</pre>

<h3>Реакция на сбои компонентов</h3>

<p>Если по любой причине (например, для тестирования воссоздания) необходимо 
сымитировать сбой диска, это можно сделать с помощью команды:</p>
<pre>   raidctl -f /dev/da2s1e raid0
</pre>
<p>После этого система будет выполнять все операции в деградированном режиме,
с воссозданием недостающих данных на основе существующих и информации о четности.
В данном случае, при запросе состояния <b>raid0</b> получим (в частности):</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: failed
              /dev/da3s1e: optimal
   Spares:
              /dev/da4s1e: spare
</pre>
<p>Учтите, что указание опции <a href="#f"><b>-f</b></a> не начинает пересоздание.
Чтобы пометить диск как сбойный и начать его пересоздание, необходимо
указать опцию <a href="#F"><b>-F</b></a>:</p>
<pre>   raidctl -F /dev/da2s1e raid0
</pre>
<p>Можно сначала применить опцию <b>-f</b>, а потом, позже, опцию <b>-F</b>, при
желании, для того же диска. Сразу после начала пересоздания при запросе состояния набора
будет получено:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: reconstructing
              /dev/da3s1e: optimal
   Spares:
              /dev/da4s1e: used_spare
   [...]
   Parity status: clean
   Reconstruction is 10% complete.
   Parity Re-write is 100% complete.
   Copyback is 100% complete.
</pre>
<p>Это показывает, что пересоздание идет. Чтобы следить за ходом процесса пересоздания
можно использовать опцию <a href="#S"><b>-S</b></a>. Она будет отображать ход
процесса как процент выполненного пересоздания. Когда пересоздание будет закончено,
опция <b>-s</b> выдаст:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: spared
              /dev/da3s1e: optimal
   Spares:
              /dev/da4s1e: used_spare
   [...]
   Parity status: clean
   Reconstruction is 100% complete.
   Parity Re-write is 100% complete.
   Copyback is 100% complete.
</pre>
<p>В этот момент, есть, по крайней мере, две возможности. Во-первых, если известно,
что устройство <b>/dev/da2s1e</b> работает нормально (т.е. сбой был вызван применением
опции <b>-f</b> или <b>-F</b>, или сбойный диск заменен), можно инициировать
обратное копирование данных с помощью опции <a href="#B"><b>-B</b></a>. В нашем
примере это приведет к копированию всего содержимого <b>/dev/da4s1e</b> на
<b>/dev/da2s1e</b>. Когда процедура обратного копирования будет закончена,
состояние устройства будет отображаться как (в частности):</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: optimal
              /dev/da3s1e: optimal
   Spares:
              /dev/da4s1e: spare
</pre>
<p>и система снова работает нормально.</p>

<p>Вторая возможность после пересоздания - просто использовать <b>/dev/da4s1e</b>
вместо <b>/dev/da2s1e</b> в файле конфигурации. Например, часть файла конфигурации
может иметь вид:</p>
<pre>   START array
   1 3 0

   START drives
   /dev/da1s1e
   /dev/da4s1e
   /dev/da3s1e
</pre>
<p>Это можно сделать, поскольку в этот момент устройство <b>/dev/da4s1e</b> полностью
взаимозаменяемо с <b>/dev/da2s1e</b>. Учтите, что при изменении порядка устройств в
наборе надо быть особенно осторожным. Это&nbsp;- один из немногих случаев,
когда устройства и/или их порядок можно поменять без потери данных! В общем случае,
порядок указания компонентов в файле конфигурации не должен меняться.</p>

<p>Если происходит сбой компонента и нет подключенных устройств горячего резерва,
состояние RAID-набора может быть (в частности) таким:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: failed
              /dev/da3s1e: optimal
   No spares.
</pre>
<p>В этом случае возможны несколько вариантов. Во-первых, можно добавить устройство
для горячего резервирования с помощью команды:</p>
<pre>   raidctl -a /dev/da4s1e raid0
</pre>
<p>После такого добавления состояние набора будет таким:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: failed
              /dev/da3s1e: optimal
   Spares:
              /dev/da4s1e: spare
</pre>
<p>После этого можно выполнить пересоздание с помощью опции <a href="#F"><b>-F</b></a>,
как было описано выше.</p>

<p>Во-вторых, можно восстановить компонент непосредственно на <b>/dev/da2s1e</b>. 
После замены диска, содержащего компонент <b>/dev/da2s1e</b>, можно просто
использовать команду:</p>
<pre>   raidctl -R /dev/da2s1e raid0
</pre>
<p>для восстановления компонента <b>/dev/da2s1e</b>. По ходу восстановления состояние
будет таким:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: reconstructing
              /dev/da3s1e: optimal
   No spares.
</pre>
<p>а после его завершения:</p>
<pre>   Components:
              /dev/da1s1e: optimal
              /dev/da2s1e: optimal
              /dev/da3s1e: optimal
   No spares.
</pre>
<p>В случаях, когда определенный компонент полностью недоступен после перезагрузки, 
для обозначения недостающего компонента может использоваться специальное имя.
Например:</p>
<pre>   Components:
              /dev/da2s1e: optimal
             component1: failed
   No spares.
</pre>
<p>показывает, что второй компонент этого RAID-набора не был выявлен вообще процедурой
автоматического конфигурирования. Имя '<b>component1</b>' может использоваться
там же, где и имя обычного компонента. Например, чтобы добавить устройство горячего
резервирования у указанному выше набору и восстановить данные на это устройство
можно сделать следующее:</p>
<pre>   raidctl -a /dev/da3s1e raid0
   raidctl -F component1 raid0
</pre>
<p>после чего данные недостающего '<b>component1</b>' будут пересозданы на
<b>/dev/da3s1e</b>.</p>

<h3>RAID на базе RAID</h3>
<p>RAID-наборы можно использовать на нескольких уровнях, чтобы создавать более сложные
и объемные RAID-наборы. Набор RAID 0, например, может быть создан из четырех наборов
RAID 5. Следующий файл конфигурации иллюстрирует такой вариант:</p>
<pre>   START array
   # numRow numCol numSpare
   1 4 0

   START disks
   /dev/raid1e
   /dev/raid2e
   /dev/raid3e
   /dev/raid4e

   START layout
   # sectPerSU SUsPerParityUnit SUsPerReconUnit RAID_level_0
   128 1 1 0

   START queue
   fifo 100
</pre>
<p>Аналогичный файл конфигурации может использоваться для создания набора RAID 0
из компонентов в виде наборов RAID 1. В такой конфигурации зеркалирование обеспечивает
высокую степень избыточности, в разбиение на полосы дает ускорение работы.</p>

<h3>Автоматическое конфигурирование и размещение корневой файловой системы на RAID</h3>
<p>RAID-наборы могут также втоматически конфигурироваться при загрузке. Чтобы сделать
набор автоматически конфигурируемым, просто подготовьте RAID-набор, как было описано 
выше, а затем выполните команду:</p>
<pre>   raidctl -A yes raid0
</pre>
<p>для включения автоматического конфигурирования этого набора. Для отключения
автоматического конфигурирования используется команда:</p>
<pre>   raidctl -A no raid0
</pre>
<p>Автоматически конфигурируемые RAID-наборы будут конфигурироваться перед
монтированием корневой файловой системы. Эти RAID-наборы, таким образом,
доступны для использования в качестве корневой или любой другой файловой системы.
Основное преимущество использования автоматического конфигурирования состоит в том,
что компоненты RAID становятся менее зависимыми от дисков, на которых они
находятся. Например, могут меняться идентификаторы SCSI (SCSI ID's), но
автоматически конфигурируемые наборы всегда будут сконфигурированными корректно,
даже если идентфикаторы SCSI у компонентов поменялись.</p>

<p>Размещение корневой файловой системы (<b>/</b>) на RAID-наборе также допускается,
и при этом на таком RAID-наборе для <b>/</b> используется раздел '<b>a</b>'. Чтобы
использовать устройство <b>raid0a</b> в качестве корневой файловой системы, просто
выполните:</p>
<pre>   raidctl -A root raid0
</pre>
<p>Чтобы сделать устройство <b>raid0a</b> только автоматически конфигурируемым, просто
используйте параметры <a href="#A_yes"><b>-A yes</b></a>.</p>

<p>Учтите, что ядра могут непосредственно читаться только с компонентов RAID 1
на архитектурах <b>alpha</b> и <b>pmax</b>. На этих архитектурах файловая
система <b>FS_RAID</b> распознается блоками загрузки, которые могут правильно
загружать ядро непосредственно с компонента набора RAID 1. Для других архитектур
или для поддержки корневой файловой системы на других RAID-наборах, необходимо
использовать какой-то другой механизм для обеспечения загрузки ядра. Например,
можно использовать небольшой раздел, содержащий только блоки вторичного загрузчика и
альтернативное ядро (или пару ядер). Как только ядро загрузится, однако, оно находит
автоматически конфигурируемый RAID-набор, пригодный для использования в качестве 
корневого, а затем этот набор автоматически конфигурируется и используется как
корневое устройство. Если в качестве корневых себя заявляет два или более RAID-набора,
пользователю предложат выбрать корневое устройство. В настоящее время в качестве
корневого устройства можно использовать наборы RAID 0, 1, 4 и 5.</p><p>

</p><p>Типичная структура RAID 1 с корнем на RAID может быть такой:</p>
<ol>
<li><b>wd0a</b> - небольшой раздел, содержащий полную, загружаемую, простейшую
установку ОС (<i>В оригинале - NetBSD, из которой, собственно, RAIDframe в ОС FreeBSD
и попал. Ну, не успели руководство поменять. Прим. переводчика.</i>).</li>
<li><b>wd1a</b> - также содержит полную, загружаемую, простейшую
установку ОС.</li>
<li><b>wd0e</b> и <b>wd1e</b> - набор RAID 1, <b>raid0</b>, используемый для
корневой файловой системы.</li>
<li><b>wd0f</b> и <b>wd1f</b> - набор RAID 1, <b>raid1</b>, который будет использоваться
только для области подкачки.</li>
<li><b>wd0g</b> и <b>wd1g</b> - набор RAID 1, <b>raid2</b>, используется для <b>/usr</b>,
<b>/home</b> или, при необходимости, для других данных.</li>
<li><b>wd0h</b> и <b>wd0h</b> - набор RAID 1, <b>raid3</b>, если необходим.</li>
</ol>
<p>RAID-наборы <b>raid0</b>, <b>raid1</b> и <b>raid2</b> все помечены как автоматически
конфигурируемые. <b>raid0</b> помечен как используемый для корневой файловой системы.
При установке новых ядер, ядро копируется не только в <b>/</b>, но также и на устройства
<b>wd0a</b> и <b>wd1a</b>. Ядро на устройстве <b>wd0a</b> необходимо, поскольку
именно с него и загружается система. Ядро на устройстве <b>wd1a</b> также необходимо,
поскольку именно оно и будет использоваться при сбое <b>wd0</b>. Важно иметь
дополнительные копии ядра, на случай сбоя одного из дисков.</p><p>

</p><p>Не обязательно размещать корневую файловую систему на том же диске, что и ядро.
Например, получение ядра с устройства <b>wd0a</b>, и использование <b>da0s1e</b> и 
<b>da1s1e</b> для <b>raid0</b> и корневой файловой системы,&nbsp;- вполне нормально.
Принципиально важно, однако, иметь несколько ядер, на случай сбоя носителя.</p>

<p>Многоуровневые RAID-устройства (такие как набор RAID 0, составленный из наборов
RAID 1) не поддерживаются пока в качестве корневых или автоматически конфигурируемых.
(Многоуровневые RAID-устройства, в общем случае, однако, поддерживаются, как было
сказано ранее.) Учтите, что для включения автоматического конфигурирования
RAID-устройств в файле конфигурации ядра должна быть строка:</p>
<pre>   options    RAID_AUTOCONFIG
</pre>
<p>Подробнее об этом см. на странице <a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>.</p>

<h3>Деконфигурирование</h3>

<p>Последняя операция, выполняемая с помощью <b>raidctl</b>,&nbsp;- это
деконфигурирование устройства <a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>. Это делается
с помощью простой команды:</p>
<pre>   raidctl -u raid0
</pre>
<p>после чего устройство готово для переконфигурирования.</p>

<h3>Настройка производительности</h3>

<p>Подбор значений различных параметров для максимальной производительности может быть
делом весьма сложным, и часто требует использования метода проб и ошибок для подбора
наиболее подходящих для конкретной системы параметров. В игру вступает целый ряд
факторов:</p>
<ol>
<li>Типы компонентов (SCSI или IDE) и их пропускная способность</li>
<li>Типы контроллеров и их пропускная способность</li>
<li>Распределение компонентов по контроллерам</li>
<li>Пропускная способность ввода-вывода</li>
<li>Особенности доступа к файловой системе</li>
<li>Скорость процессора</li>
</ol>
<p>Как и при любой настройке производительности, оценка производительности при 
реальных нагрузках может оказаться единственным способом оценки предполагаемой
производительности. Понимание хотя бы части базовых технологий тоже не повредит
при настройке. Цель этого раздела&nbsp;- указать те параметры, которые могут
существенно влиять на производительность.</p>

<p>Для набора RAID 1, значение <b>SectPerSU</b>, равное 64 или 128, обычно подойдет.
Поскольку данные в наборе RAID 1 организованы в каждом компоненте линейно,
выбор подходящего размера полосы менеее критичен, чем для набора RAID 5. Однако 
слишком маленький размер полосы будет приводить к разбиению большого запроса
ввода-вывода на несколько маленьких, что отрицательно скажется на производительности.
В то же время, большой размер полосы может вызвать проблемы с одновременным
доступом к полосам, что тоже можеть снизить производительность.
Поэтому значения в диапазоне от 32 до 128 обычно наиболее эффективны.</p>

<p>Настройка наборов RAID 5 сложнее. В самом лучшем случае, запросы ввода-вывода
будут поступать на RAID-набор по одной полосе за раз. Поскольку в начале
ввода-вывода доступна вся полоса, четность для нее можно вычислить до записи,
а затем данные и информацию о четности можно записывать параллельно. 
Когда размер записываемых данных меньше, чем размер полосы, возникает проблема
'меленькой записи'. Поскольку 'маленькая запись' означает, что меняться будет только
часть полосы на компонентах, данные (и информация о четности) на компонентах
должны меняться несколько иначе. Во-первых, 'старую четность' и 'старые данные'
надо прочитать с компонентов. Затем строится новая информация о четности, используя
новые данные, которые надо записать, старые данные и прежнюю информацию о четности.
Наконец, новые данные и новая информация о четности записываются. Все эти
дополнительные манипуляции с данными приводят к серьезному снижению производительности,
и такая запись обычно выполняется в 2-4 раза медленнее, чем запись (или чтение) 
полной полосы. Чтобы справиться с этой проблемой в реальной ситуации, может
пригодиться задание достаточно маленьких полос, чтобы "большой запрос 
ввода-вывода" от системы использовал ровно одну большую записб полосы. Как оказалось в
дальнейшем, определенную роль тут могут сыграть также особенности файловой системы.</p>

<p>Поскольку размер "большого запроса ввода-вывода" часто (в настоящее время) составляет
32 или 64 Кбайта, на пятидисковом наборе RAID 5 желательными для параметра
<b>SectPerSU</b> могут оказаться значения 16 блоков (8 Кбайт) или 32 блока 
(16 Кбайт). Поскольку имеется 4 сектора данных на полосу, максимальный объем
данных в полосе будет 64 блока (32 Кбайта) или 128 блоков (64 Кбайта). И в этом
случае только экспериментальные оценки позволят выяснить, какие значения дают
лучшую производительность.</p>

<p>Параметры, используемые при создании файловой системы, также принципиально
влияют на производительность. Для <a href="/man.shtml?topic=newfs&amp;category=8"><b>newfs(8)</b></a>,
например, увеличения размера блока до 32 Кбайт или 64 Кбайт может существенно
повысить производительность. Кроме того, изменение параметра, задающего
количество цилиндров в группе, с 16 на 32 или более часто не только необходио
для поддержки больших файловых систем, но и может положительно повлиять на 
производительность.</p>

<h3>Резюме</h3>

<p>Несмотря на размер этой страницы справочного руководства, конфигурирование
RAID-набора&nbsp;- процесс относительно простой. Необходимо выполнить следующие 
шаги:</p>
<ol>
<li>С помощью <a href="/man.shtml?topic=bsdlabel&amp;category=8"><b>disklabel(8)</b></a> создать
компоненты (типа <b>RAID</b>).</li>
<li>Создать файл конфигурации RAID, например, '<b>raid0.conf</b>'</li>
<li>Сконфигурировать RAID-набор:
<pre>raidctl -C raid0.conf
</pre></li>
<li>Проинициализировать метки компонентов:
<pre>raidctl -I 123456 raid0
</pre></li>
<li>Проинициализировать другие важные части набора:
<pre>raidctl -i raid0
</pre></li>
<li>Получить стандартную метку для RAID-набора:
<pre>disklabel raid0 &gt; /tmp/label
</pre></li>
<li>Отредактировать метку:
<pre>vi /tmp/label
</pre></li>
<li>Записать новую метку на RAID-набор:
<pre>disklabel -R -r raid0 /tmp/label
</pre></li>
<li>Создать файловую систему:
<pre>newfs /dev/rraid0e
</pre></li>
<li>Смонтировать файловую систему:
<pre>mount /dev/raid0e /mnt
</pre></li>
<li>Используйте команду:
<pre>raidctl -c raid0.conf
</pre>
<p>для переконфигурирования RAID-набора в следующий раз, когда он понадобится, или
поместите файл <b>raid0.conf</b> в каталог <b>/etc</b>, и тогда массив будет 
автоматически запускаться сценариями <b>/etc/rc</b>.</p>
</li>
</ol>

<h2><a name="warnings">ПРЕДУПРЕЖДЕНИЯ</a></h2>

<p>Некоторые уровни RAID (1, 4, 5, 6 и другие) могут защитить от потери данных
при сбое одного компонента. Однако потеря двух компонентов системы RAID 4 или 5, 
либо потеря одного компонента системы RAID 0 приводит к потере всей файловой
системе на этом RAID-устройстве. RAID&nbsp;- <b>не замена</b> продуманной стратегии
резервного копирования.</p>

<p>Перевычисление четности <b>должно</b> выполняться в любой ситуации, когда есть
шанс, что эти данные могут быть повреждены. К этим ситуациям относятся сбои системы
или добавление ранее не использовавшегося RAID-устройства. Некорректная информация
о четности приведет к катастрофе в случае любого сбоя компонента&nbsp;- лучше использовать
RAID 0, и получить дополнительное место и выигрыш в скорости, чем хранить информацию о
четности, но не обеспечивать ее корректность. Использование RAID 0 хотя бы не
создает видимость повышенной защиты данных.</p>

<h2><a name="files">ФАЙЛЫ</a></h2>
<dl>
<dt><b>/dev/{,r}raid*</b></dt>
<dd>специальные файлы устройств <b>raid</b>.</dd>
</dl>

<h2><a name="see_also">ССЫЛКИ</a></h2>
<dl>
<dt></dt><dd>
<a href="/man.shtml?topic=ccd&amp;category=4"><b>ccd(4)</b></a>, 
<a href="/man.shtml?topic=raid&amp;category=4"><b>raid(4)</b></a>,
<a href="/man.shtml?topic=rc&amp;category=8"><b>rc(8)</b></a>
</dd></dl>

<h2><a name="bugs">ОШИБКИ</a></h2>
<p>Удаление диска горячей замены пока невозможно.</p>

<h2><a name="history">ИСТОРИЯ</a></h2>

<p>RAIDframe - это механизм для быстрого прототипирования RAID-структур, разработанный
сотрудниками Parallel Data Laboratory университета Карнеги-Мэллона (Carnegie Mellon
University&nbsp;- CMU). Более полное описание внутреннего устройства и возможностей
RAIDframe можно найти в статье "<b>RAIDframe: A Rapid Prototyping Tool for RAID
Systems</b>", by William V. Courtright II, Garth Gibson, Mark Holland, LeAnn
Neal Reilly, and Jim Zelenka, опубликованной Parallel Data Laboratory университета
Карнеги-Мэллона.</p> 

<p>Команда <b>raidctl</b> впервые появилась как отдельная программа в дистрибутиве
RAIDframe v1.1 CMU. Данная версия <b>raidctl</b> полностью переписана и впервые
появилась в ОС FreeBSD 4.4.</p>

<h2><a name="copyright">АВТОРСКИЕ ПРАВА</a></h2>

<p>Авторские права на RAIDframe (RAIDframe Copyright) следующие:</p>
<pre>Copyright (c) 1994-1996 Carnegie-Mellon University.
All rights reserved.

Permission to use, copy, modify and distribute this software and
its documentation is hereby granted, provided that both the copyright
notice and this permission notice appear in all copies of the
software, derivative works or modified versions, and any portions
thereof, and that both notices appear in supporting documentation.

CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND
FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.

Университет Carnegie Mellon требует от пользователей этого ПО пересылать
по адресу:

 Software Distribution Coordinator  или  Software.Distribution@CS.CMU.EDU
 School of Computer Science
 Carnegie Mellon University
 Pittsburgh PA 15213-3890

любые улучшения или расширения, которые они сделали, и предоставлять 
университету права на дальнейшее распространение этих изменений.
</pre>

<p align="center">FreeBSD 4.9,  6 ноября 1998 года</p>

<p align="center"><font size="-2">Copyleft (no c) - Fuck copyright! 2004 <a href="mailto:valera@openxs.kiev.ua">В. Кравчук</a>,
<a href="http://ln.com.ua/~openxs">OpenXS Initiative</a>, перевод на русский язык
</font></p>

<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="raidctl" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
