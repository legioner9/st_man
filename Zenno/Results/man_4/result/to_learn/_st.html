
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN st (4) Специальные файлы /dev/* (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, st"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="st" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">st (4)</font><hr><li>&gt;&gt; <a href="/man.shtml?topic=st&amp;category=4&amp;russian=0"><u>st</u></a> (4) <font color="#555555"> ( Русские man: Специальные файлы /dev/* )</font></li><li> <a href="/man.shtml?topic=st&amp;category=4&amp;russian=2"><u>st</u></a> (4) <font color="#555555"> ( Linux man: Специальные файлы /dev/* )</font></li><li> <a href="/man.shtml?topic=st&amp;category=7&amp;russian=4"><u>st</u></a> (7) <font color="#555555"> ( Solaris man: Макропакеты и соглашения )</font></li>
<a name="lbAB">&nbsp;</a>
<h2>НАЗВАНИЕ</h2>

st - ленточный накопитель SCSI 
<a name="lbAC">&nbsp;</a>
<h2>СИНТАКСИС</h2>

<pre><b>#include &lt;<a href="file:/usr/include/sys/mtio.h">sys/mtio.h</a>&gt;</b>

<b>int ioctl(int </b><i>fd</i><b>, int </b><i>request</i><b> [, (void *)</b><i>arg3</i><b>]);</b>
<b>int ioctl(int </b><i>fd</i><b>, </b><font size="-1"><b>MTIOCTOP</b></font><b>, (struct mtop *)</b><i>mt_cmd</i><b>);</b>
<b>int ioctl(int </b><i>fd</i><b>, </b><font size="-1"><b>MTIOCGET</b></font><b>, (struct mtget *)</b><i>mt_status</i><b>);</b>
<b>int ioctl(int </b><i>fd</i><b>, </b><font size="-1"><b>MTIOCPOS</b></font><b>, (struct mtpos *)</b><i>mt_pos</i><b>);</b>
</pre>

<a name="lbAD">&nbsp;</a>
<h2>ОПИСАНИЕ</h2>

Драйвер
<b>st</b>

участвует в установке связи с различными ленточными накопителями SCSI.
В настоящее время драйвер позволяет управлять любыми устройствами
lqпоследовательного доступаrq.
В драйвере
<b>st</b>

цифра 9 используется как основное число устройства.
<p>

Каждое устройство использует восемь второстепенных номеров устройства.
Первые пять битов во второстепенных номерах определяют последовательность обнаружения.
Второстепенные номера могут быть сгруппированы в два набора из четырех чисел: 
главные (автоперемотка) младшие числа устройства
<i>n</i>,

и числа устройства lqнеперемоткиrq,
<i></i>(<i>n</i>+ 128).

Открытые устройства используют главный номер устройства, посылая
команду <font size="-1">REWIND</font>, когда закрываются.
(Заметьте, что использование устройства автоперемотки для установки ленты
в определенное положение, для примера, mt, не даст желаемого результата:
лента перемотается после команды mt, и следующая команда будет
выполняться с начала ленты).
</p><p>

В каждой группе четыре второстепенных номера доступны для определения
устройств с особыми характеристиками (такими, как: длина блока, сжатие, плотность 
и другое). Когда система запускается, только первое устройство доступно.
Другие три приводятся в действие, когда определены некоторые их характеристики
(смотрите ниже). Путем изменения константы при компиляции возможно
изменение баланса между максимальным числом ленточних накопителей и
числом из второстепенных номеров каждого накопителя. Начальное размещение
позволяет контролировать 32 ленточных устройства. Для примера, возможно
контролировать до 64-х ленточных устройств с двумя второстепенными номерами.
</p><p>

Устройства обычно создаются так:
</p><dl compact=""><dt></dt><dd>
<pre>mknod -m 666 /dev/st0 c 9 0
mknod -m 666 /dev/st0l c 9 32
mknod -m 666 /dev/st0m c 9 64
mknod -m 666 /dev/st0a c 9 96
mknod -m 666 /dev/nst0 c 9 128
mknod -m 666 /dev/nst0l c 9 160
mknod -m 666 /dev/nst0m c 9 192
mknod -m 666 /dev/nst0a c 9 224
</pre>

</dd></dl>

<p>

Нет соответствующего блочного устройства.
</p><p>

Драйвер использует внутренний буфер, что достаточно для сохранения в нем 
одного блока ленты. В ядре до появления версии 2.1.121 буфер был размещен как один
прилегающий блок. Ограничение размера блока обеспечивается распределителем
памяти ядра может. Ограничение в настоящее время состовляет: 128 kB для 32-битной
и 256 kB для 64-битной архитектуры. В новейших ядрах накопитель
располагает буфер в нескольких частях, если это необходимо. По умолчанию
максимальное число частей - 16. Это способ сделать максимальный размер
блока очень большим (2MB, если выделяется 16 блоков по 128 kB).
</p><p>

Размер внутреннего буфера драйвера определяется константой при
сборке; эта константа может быть изменена при загрузке ядра. Вдобавок к
этому, драйвер пытается разместить больший временный буфер во время
запуска, если это необходимо. Тем не менее, размещение во время запуска
больших блоков памяти можеть быть неудачным, и целесообразно не слишком
полагаться на размещение активного буфера в ядре версии 2.1.121 и более ранних
(это применяется также при загрузке драйвера по требованию kerneld или kmod).
</p><p>

После старта системы параметры ленточного устройства определены
программно-аппаратными средствами накопителя. Для примера, если
производитель выбирает фиксированный блочный режим, то ленточное
устройство использует этот режим. Параметры могуть быть изменены 
вызовом функции 
<b>ioctl() </b>

и действовать, когда устройство было закрыто и
потом открыто вновь. Установка параметров влияет на оба устройства
(автоперемотки и неперемотки).
</p><p>

Особые праметры могут быть определены для остальных устройств. Параметры
начинают работать, когда устройство открыто. Для примера, системный
администратор может определить одно устройство, которое записывает данные 
в режиме фиксированных блоков (с определенным размером блока), и другое, которое
записывает данные в режиме переменных блоков (если накопитель поддерживает оба
режима).
</p><p>

Драйвер поддерживает
<b>ленточные</b>разделы<b>,</b>

но только если их поддерживает сам накопитель (заметьте, что ленточные
разделы не влияют на разделы диска. Разделенная лента может быть отображена
как несколько логических лент). С ioctl возможна поддержка разделов.
Местоположение ленты зафиксировано внутри каждого раздела.
Раздел используется для запуска последующих ленточных операций, выбранных 
с помощью ioctl. Максимальное число разделов на ленте определяется
константой при компиляции (изначально оно равно четырем). Драйвер ограничивает ioctl,
что позволяет форматировать ленту с одним или двумя разделами.
</p><p>

Устройство
<b>/dev/tape</b>

обычно создает по умолчанию как "жесткую", так и символьную ссылку ленточного
устройства в системе.
<a name="lbAE">&nbsp;</a>
</p><h2>ПЕРЕДАЧА ДАННЫХ</h2>

Драйвер поддерживает операции в обоих режимах: фиксированных и переменных
блоков (только если оба режима поддерживает сам накопитель). В режиме
фиксированных блоков накопитель записывает блоки определенного размера, 
и размер блока не зависит от количества требуемых байтов, которые
вызываются для записи системой. В режиме переменных блоков один блок
ленты записывается при каждом вызове записи и требует определения
размера соответствующего блока ленты. 
<p>

В режиме переменных блоков при чтении требуемых байтов размер блока ленты
точно не подбирается. Если требуемых байтов больше, чем в следующем блоке ленты, 
драйвер возвращает данные, а функция возвращает текущий размер блока.
Если размер блока больше, чем количество требуемых байтов, читается только количество
данных с начала блока, а остаток блока отбрасывается.
</p><p>

В режиме фиксированных блоков чтение количества байтов может быть
произвольным, если буферизация дает такую возможность, или
пропорциональным размеру блока ленты, если  такой возможности нет. Ядро 
версий, появившихся до 2.1.121, позволяет записывать блок с произвольным 
количеством байтов.
Во всех других случаях количество байтов должно быть
пропорциональным размеру блока ленты.
</p><p>

Метка файла автоматически записывается на ленту, если последней операцией 
до закрытия была запись.
</p><p>

Если данные остаются в буфере, то метка файла будет найдена и буферизация данных 
продолжится. Следующее чтение вернет ноль байтов, затем вернет данные из следующего
файла. В конце записи данные сообщат о возвращении нуля байтов для второго 
упорядоченного вызова записи. И, наконец, третье чтение вернет ошибку.
<a name="lbAF">&nbsp;</a>
</p><h2>СИСТЕМНЫЕ ВЫЗОВЫ</h2>

Драйвер поддерживает три запроса ioctl.
Запросы, не опознанные драйвером 
<b>st</b>,

пропускаются в драйвер SCSI.
См.
<b>/usr/include/linux/mtio.h</b>:

<a name="lbAG">&nbsp;</a>
<h3><font size="-1">MTIOCTOP</font> - выполнение ленточных операций</h3>

<p>

Это требует использования типа аргумента
<b>(struct mtop *)</b>.

Не любой накопитель поддерживает все операции.
Драйвер возвращает ошибку EIO, если накопитель не выполнил операцию.
</p><p>

</p><pre>
</pre>

<p>

Операции с магнитной лентой для нормального использования:

</p><dl compact="">
<dt>MTBSF</dt><dd>
Перемотка ленты на
<b>mt_count</b>

файловых маркеров назад.
</dd><dt>MTBSFM</dt><dd>
Перемотка ленты на
<b>mt_count</b>

файловых маркеров назад. Перемотка ленты на сторону EOT последней метки файла.
</dd><dt>MTBSR</dt><dd>
Перемотка ленты на
<b>mt_count</b>

записей (блоков ленты) назад.
</dd><dt>MTBSS</dt><dd>
Перемотка ленты на
<b>mt_count</b>

установленных маркеров назад.
</dd><dt>MTCOMPRESSION</dt><dd>
Включение режима сжатия данных на ленте накопителя, если
<b>mt_count</b>

не нулевое, и отключение компрессии, если
<b>mt_count</b>

равно нулю. 
Эта команда использует страницу 15 МODE, поддерживаемую многими устройствами DAT.
</dd><dt>MTEOM</dt><dd>
Перемотка ленты к концу данных (для добавляемых файлов).
</dd><dt>MTERASE</dt><dd>
Стирает информацию с ленты в кассете.
</dd><dt>MTFSF</dt><dd>
Перемотка ленты на
<b>mt_count</b>

файловых маркеров вперед.
</dd><dt>MTFSFM</dt><dd>
Перемотка ленты на
<b>mt_count</b>

файловых маркеров вперед. Перемотка ленты на сторону BOT последней метки файла.
</dd><dt>MTFSR</dt><dd>
Перемотка ленты на
<b>mt_count</b>

записей (блоков).
</dd><dt>MTFSS</dt><dd>
Перемотка ленты на
<b>mt_count</b>

установленных маркеров вперед.
</dd><dt>MTLOAD</dt><dd>
Осуществляет загрузку команд SCSI. Специальные возможности доступны некоторым
автозагрузчикам HP. Если
<b>mt_count</b>

- константа, то MT_ST_HPLOADER_OFFSET прибавит к ней число, которое передается накопителю
для управления автозагрузчиком.
</dd><dt>MTLOCK</dt><dd>
Блокирует дверцу ленточного накопителя.
</dd><dt>MTMKPART</dt><dd>
Форматирует ленту на один или два раздела. Если
<b>mt_count</b>

- не нулевое, этот параметр выдает размер первого раздела, а второй раздел 
содержит остаток ленты. Если
<b>mt_count</b>

является нулевым, лента форматируется на один раздел.
Эта команда запрещена для накопителя, исключая тот случай, когда накопитель
поддерживает создание разделов (см. ниже MT_ST_CAN_PARTITIONS).
</dd><dt>MTNOP</dt><dd>
Сброс буфера накопителя.
Операция должна выполняться до чтения статуса с <font size="-1">MTIOCGET</font>.
</dd><dt>MTOFFL</dt><dd>
Перематывает ленту и отключает устройство.
</dd><dt>MTRESET</dt><dd>
Возвращает устройству исходное состояние.
</dd><dt>MTRETEN</dt><dd>
Подтягивает ленту в касете.
</dd><dt>MTREW</dt><dd>
Перематывает ленту назад.
</dd><dt>MTSEEK</dt><dd>
Переход к блоку ленты с номером
<b>mt_count</b>.

Эта операция требует одного из двух накопителей: SCSI-2, поддерживающего команду <font size="-1">LOCATE</font>
(адрес определенного устройства), или
Tandberg - совместимого накопителя SCSI-1 (Tandberg, Archive
Viper, Wangtek, ... ).
Номер блока должен быть равен единице, что заранее возвращает <font size="-1">MTIOCPOS</font>, если
используется адрес определенного устройства.
</dd><dt>MTSETBLK</dt><dd>
Присваивает длине блока накопителя значение
<b>mt_count</b>.

Нулевое значение устанавливает режим переменных блоков накопителя.
</dd><dt>MTSETDENSITY</dt><dd>
Устанавливает плотность данных на ленте в значение
<b>mt_count</b>.

Плотность данных, поддерживаемая накопителем, может быть найдена
в документации самого устройства.
</dd><dt>MTSETPART</dt><dd>
Изменение значения активного раздела на значение
<b>mt_count .</b>

Разделы нумеруются, начиная с нуля. Эта команда только для накопителей, 
которые имеют поддержку разделов (см. ниже MT_ST_CAN_PARTITIONS).
</dd><dt>MTUNLOAD</dt><dd>
Осуществляет выгрузку команд SCSI (но не выталкивает кассету).
</dd><dt>MTUNLOCK</dt><dd>
Разблокирует дверцу ленточного накопителя.
</dd><dt>MTWEOF</dt><dd>
Устанавливает
<b>mt_count</b>

маркера файла в текущую позицию на ленте.
</dd><dt>MTWSM</dt><dd>
Записывает
<b>mt_count</b>

установленных меток.

</dd></dl>
<p>

Операции с магнитной лентой для установки параметров устройства (для суперпользователя):

</p><dl compact="">
<dt>MTSETDRVBUFFER</dt><dd>
Установка значения 
<b>mt_count</b>

различных накопителей и параметров драйвера соответственно количеству битов.
Это: режим буферизации накопителя (13 битовых параметров драйвера),
буфер записи по умолчанию для размера блока, плотность и время ожидания 
(только для ядра версии 2.1 или более поздних).
Одна операция может присваивать устройству значение только одного пункта из списка выше 
(13 битовых параметров считаются одним пунктом).

</dd><dt></dt><dd>
Нулевое значение старших 4-х битов будет использовано для установки
режима буферизации накопителя.
Режимы буферизации:
<dl compact=""><dt></dt><dd>
<dl compact="">
<dt>0</dt><dd>
Накопитель не сообщит, что запись прошла успешно до тех пор, пока блоки данных фактически
не записаны на носитель.

</dd><dt>1</dt><dd>
Накопитель может сообщить, что запись прошла успешно после того, как
все данные будут перемещены во внутренний буфер накопителя.
</dd><dt>2</dt><dd>
Накопитель может сообщить о том, что запись прошла успешно после того, как:
(а) все данные будут перемещены во внутренний буфер накопителя и (б) все буферизированные 
данные будут успешно записаны на носитель.

</dd></dl>
</dd></dl>

</dd><dt></dt><dd>
Для контроля записи пороговое значение
<b>mt_count</b>

должно включать в себя константу
<font size="-1">MT_ST_WRITE_THRESHOLD</font> с количеством блоков в первых
28-и битах. Она содержит количество блоков по 1024 байта (это не физические блоки
на диске). Пороговое значение не может превышать размер внутреннего буфера накопителя.
(см. выше
<b></b><font size="-1"><b>DESCRIPTION</b></font><b>)</b>

</dd><dt></dt><dd>
Для установки и "очистки" битовых параметров 
<b>mt_count</b>

должна включать в себя одну из констант:
<font size="-1">MT_ST_BOOLEANS</font>,
<font size="-1">MT_ST_SETBOOLEANS</font>, <font size="-1">MT_ST_CLEARBOOLEANS</font>,
<font size="-1">MT_ST_DEFBOOLEANS</font> или любую их комбинацию.
Использование опций <font size="-1">MT_ST_BOOLEANS</font> может быть определено в 
соответствующих битах. В работе с опциями <font size="-1">MT_ST_SETBOOLEANS</font> могуть применяться
выборочные установки, а с опциями <font size="-1">MT_ST_DEFBOOLEANS</font> - выборочная очистка.
</dd><dt></dt><dd>
Изначально параметры для для ленточного устройства установлены равными <font size="-1">MT_ST_DEFBOOLEANS</font>.
Неактивное ленточное устройство (например, устройство со второстепенными номерами 64 или 160)
активируется, когда изначальные параметры для него определены в первый раз.
Активированное устройство получает при загрузке параметры, не установленные явно.
</dd><dt></dt><dd>
Битовые параметры:
</dd><dt></dt><dd>

<dl compact=""><dt></dt><dd>
<dl compact="">
<dt><font size="-1">MT_ST_BUFFER_WRITES</font>  (по умолчанию true)</dt><dd>
Резервирует все операции записи в режиме фиксированных блоков.
Если установленное значение этой опции равно false и накопитель использует режим 
фиксированных блоков, то все операции записи должны выполняться для различных размеров блока.
Установленное значение этого параметра должно быть равным false для записи надежных 
многотомных архивов.
</dd><dt><font size="-1">MT_ST_ASYNC_WRITES</font>  (по умолчанию true)</dt><dd>
Когда значение true этого параметра установлено, операции записи возвращают данные
перемещения на накопитель, если данные заполнили буфер драйвера.
Начальная запись определяет, как должен быть заполнен буфер до новых
SCSI-команд записи.
Любые ошибки, возвращенные накопителем, хранятся до следующей операции.
Установленное значение данного параметра должно быть false; это дает возможность 
записывать многотомные архивы.
</dd><dt><font size="-1">MT_ST_READ_AHEAD</font>  (По умолчанию: true)</dt><dd>
Этот параметр приказывает драйверу использовать операцию чтения в режиме фиксированных блоков.
Если установленное значение этого параметра равно false и накопитель использует 
режим фиксированных блоков,
то все операции чтения используются для блоков переменной длины.
</dd><dt><font size="-1">MT_ST_TWO_FM</font>  (По умолчанию: false)</dt><dd>
Этот параметр изменяет поведение драйвера после закрытия файла.
По умолчанию драйвер записывает один маркер файла.
Если установленное значение параметра равно true, то драйвер запишет два маркера файла.

</dd><dt></dt><dd>
Замечание:
этому параметру не может быть присвоено значение true для ленточных накопителей QIC.
Многие современные накопители также находят конец записанных данных,
и использование двух меток файла обычно необходимо только при замене ленты
в некоторых других системах.
</dd></dl>
<p>


</p><dl compact="">
<dt><font size="-1">MT_ST_DEBUGGING</font>  (По умолчанию: false)</dt><dd>
Этот параметр включает в себя возможность вывода сообщений драйвера при отладке,
она эффективна только в том случае, если драйвер был собран с ненулевым 
значением <font size="-1">DEBUG</font>.  
</dd><dt><font size="-1">MT_ST_FAST_EOM</font>  (По умолчанию: false)</dt><dd>
Этот параметр позволяет посылать операцию <font size="-1">MTEOM</font> накопителю непосредственно, 
потенциально увеличивая скорость операций; но возникает опасность потерять 
"дорожку" текущего файла.
Если установленное значение параметра <font size="-1">MT_ST_FAST_EOM</font> равно false, то
драйвер отвечает на запрос <font size="-1">MTEOM</font>, перематывая ленту к концу записанных файлов.
</dd><dt><font size="-1">MT_ST_AUTO_LOCK</font> (по умолчанию false)</dt><dd>
Когда этому параметру присвоено значение true и устройство открыто, дверца накопителя заблокирована,
когда устройство закрыто, дверца разблокирована. 
</dd><dt><font size="-1">MT_ST_DEF_WRITES</font> (По умолчанию: false)</dt><dd>
Параметры чтения и записи на ленту (размер блока, режим, компрессия и т.д.) могут 
изменяться в случае с различными устройствами, связанными с накопителем, в зависимости от того,
как настроено устройство.
Этот параметр определяет, будет ли использоваться драйвер при помощи команд
SCSI, или накопитель сам автоматически будет выполнять операции, используя свои возможности.
Если установленное значение этой опции равно false, то драйвер будет посылать команды 
непосредственно устройству. Если установленное значение опции равно true, команды SCSI 
не отправляются до запроса записи. В этом случае программно-аппаратные средства накопителя
позволяют выполнять обнаружение структуры ленты во время чтения, а команды SCSI 
используются только для проверки правильности записи на ленту в соответствии со 
спецификацией.
</dd><dt><font size="-1">MT_ST_CAN_BSR</font> (по умолчанию false)</dt><dd>
Если используется упреждающее чтение, лента должна быть иногда перемотана назад
для правильного ее размещения при закрытом устройстве. Для этих целей используется
команда SCSI, которая выполняет перемотку ленты назад на одну запись.
Некоторые старые накопители не могут правильно обрабатывать эту команду,
и этот параметр может использоваться для того, чтобы драйвер данную команду
не применял. В конечном итоге, с упреждающим чтением и в режиме фиксированных блоков
файл может неверно быть записан на ленту при закрытом устройстве.
</dd><dt><font size="-1">MT_ST_NO_BLKLIMS</font> (по умолчанию false)</dt><dd>
Некоторые накопители не принимают SCSI-команду READ BLOCK LIMITS 
(ограничения чтения блока).
Если она используется, то драйвер не исполняет команду.
Недостатком этого является невозможность проверки драйвером до отправки команд, 
поддерживается ли выбранный размер блока накопителем.
</dd><dt><font size="-1">MT_ST_CAN_PARTITIONS</font> (по умолчанию false)</dt><dd>
Этот параметр дает возможность поддерживать несколько разделов на ленте.
Он применяется ко всем устройствам, связанным с накопителем.
</dd><dt><font size="-1">MT_ST_SCSI2LOGICAL</font> (по умолчанию false)</dt><dd>
Этот параметр заставляет драйвер использовать адрес логического блока,
определенного в стандарте SCSI-2 при выполнении операций поиска и пересчета
(с обеими командами MTSEEK и MTIOCPOS и в том случае, когда изменяются разделы ленты).
Желательно установить этот параметр, если накопитель поддерживает логические адреса,
потому что они рассчитывают также и метки файла.
</dd><dt><font size="-1">MT_ST_SYSV</font> (по умолчанию false)</dt><dd>
Когда этот параметр установлен, ленточные устройтва используют семантику SystemV.
В других случаях используется семантика BSD.
Основная разница между этими семантиками (когда устройство,
окрытое для чтения, закрыто) состоит в следующем: по семантике SYSV лента 
перематывается вперед за следующий маркер файла, если этого не произошло 
во время использования устройства.
В семантике BSD местоположение ленты не меняется.
</dd><dt><font size="-1">ПРИМЕР</font></dt><dd>
<pre>
<b>struct mtop </b><i>mt_cmd</i><b>;</b>
<i>mt_cmd.mt_op</i><b> = </b><font size="-1"><b>MTSETDRVBUFFER</b></font><b>;</b>
<i>mt_cmd.mt_count</i><b> = </b><font size="-1"><b>MT_ST_BOOLEANS</b></font><b> |</b>
<b>          </b><font size="-1"><b>MT_ST_BUFFER_WRITES</b></font><b> |</b>
<b>          </b><font size="-1"><b>MT_ST_ASYNC_WRITES</b></font><b>;</b>
<b>ioctl(</b><i>fd</i><b>, </b><font size="-1"><b>MTIOCTOP</b></font><b>, &amp;</b><i>mt_cmd</i><b>);</b>
</pre>

</dd></dl>
</dd></dl>


</dd><dt></dt><dd>
Размер блока для устройства может быть установлен<br>
с помощью <font size="-1">MT_ST_DEF_BLKSIZE</font>, а плотность данных может быть установлена 
с помощью <font size="-1">MT_ST_DEFDENSITY</font>. Значения параметров ORed -
с помощью кода операции.
</dd><dt></dt><dd>
В ядре версии 2.1.x и более поздних время ожидания может быть установлено
подкомандой <font size="-1">MT_ST_SET_TIMEOUT</font> с секундным значением.
Долгое время ожидания (используется для перемотки и выполнения других команд,
занимающего длительное время) может быть установлено равным <font size="-1">MT_ST_SET_LONG_TIMEOUT</font>.
Значения, используемые в ядре по умолчанию, слишком велики, поэтому нельзя быть уверенным в том,
время ожидания не истечет. Действие драйвера в этом случае может быть приостановлено.
Эти команды могут быть использованы для установки оптимальных
значений различных накопителей. Установка времени ожидания для одного устройства
применяется для всех устройств, связанных с этим накопителями.
</dd></dl>
<a name="lbAH">&nbsp;</a>
<h3><font size="-1">MTIOCGET</font> - получение статуса</h3>

<p>

Этот запрос использует аргумент типа
<b>(struct mtget *)</b>.

</p><p>

</p><pre>/* структура для <font size="-1">MTIOCGET</font> */
struct mtget {
    long   mt_type;
    long   mt_resid;
    /* следующие регистры являются устройствозависимыим */
    long   mt_dsreg;
    long   mt_gstat;
    long   mt_erreg;
    /* следующие два поля используются не всегда */
    daddr_t          mt_fileno;
    daddr_t          mt_blkno;
};
</pre>

<dl compact="">
<dt><b>mt_type</b></dt><dd>
Заголовок файла определяет множество значений 
<b>mt_type</b>,

но текущий драйвер сообщает только об общих типах
<font size="-1">MT_ISSCSI1</font> (SCSI-1) и <font size="-1">MT_ISSCSI2</font> (SCSI-2).

</dd><dt><b>mt_resid</b></dt><dd>
включает в себя номер текущего раздела диска.
</dd><dt><b>mt_dsreg</b></dt><dd>
сообщает о текущих настройках размера блока драйвера (в младших 24-х битах)  
и плотности (в старших 8-х битах).
Эти поля определены в: 
<font size="-1">MT_ST_BLKSIZE_SHIFT</font>, <font size="-1">MT_ST_BLKSIZE_MASK</font>,
<font size="-1">MT_ST_DENSITY_SHIFT</font> и <font size="-1">MT_ST_DENSITY_MASK</font>.
</dd><dt><b>mt_gstat</b></dt><dd>
сообщает об общем (устройствонезависимом) статусе.
Заголовок файла определяет макрос для тестирования:
<dl compact=""><dt></dt><dd>
<dl compact="">
<dt>
<font size="-1">GMT_EOF(</font><i>x</i><font size="-1">)</font>:
текущая позиция сразу после маркера файла
(значение всегда становится ложным после выполнения операции <font size="-1">MTSEEK</font>)
</dt><dt>
<font size="-1">GMT_BOT(</font><i>x</i><font size="-1">)</font>:
текущая позиция в начале первого файла
(всегда ложно после операции <font size="-1">MTSEEK</font>)
</dt><dt>
<font size="-1">GMT_EOT(</font><i>x</i><font size="-1">)</font>:
текущая позиция в конце ленты.
</dt><dt>
<font size="-1">GMT_SM(</font><i>x</i><font size="-1">)</font>:
</dt><dt>
<font size="-1">GMT_EOD(</font><i>x</i><font size="-1">)</font>:
текущая позиция в конце записанных данных.
</dt><dt>
<font size="-1">GMT_WR_PROT(</font><i>x</i><font size="-1">)</font>:
накопитель зашищен от записи.
Для некоторых накопителей это может означать, что накопитель не поддерживает 
запись на носитель этого типа.
</dt><dt>
<font size="-1">GMT_ONLINE(</font><i>x</i><font size="-1">)</font>:
</dt><dt>
<font size="-1">GMT_D_6250(</font><i>x</i><font size="-1">)</font>, <font size="-1">GMT_D_1600(</font><i>x</i><font size="-1">)</font>, <font size="-1">GMT_D_800(</font><i>x</i><font size="-1">)</font>:
Сообщает о настройках текущей плотности для 9-и дорожек.
</dt><dt>
<font size="-1">GMT_DR_OPEN(</font><i>x</i><font size="-1">)</font>:
нет ленты в накопителе.
</dt><dt>
<font size="-1">GMT_IM_REP_EN(</font><i>x</i><font size="-1">)</font>:
сообщает о режиме. Этот бит устанавливается, если нет гарантии, что данные были 
правильно записаны на ленту. Этот бит приобретает нулевое значение,
когда драйвер не записывает данные в буфер и накопитель не настроен на
буферизацию данных.
</dt></dl>
</dd></dl>

</dd><dt><b>mt_erreg</b></dt><dd>
Поле, определенное в
<b>mt_erreg</b>,

возвращает номер ошибки в младших 16-и битах 
(ошибка определена в <font size="-1">MT_ST_SOFTERR_SHIFT</font> и <font size="-1">MT_ST_SOFTERR_MASK</font>).
</dd><dt><b>mt_fileno</b></dt><dd>
сообщает текущий номер файла.
Значение установлено равным -1, когда номер файла неизвестен (например, после
<font size="-1">MTBSS</font> или <font size="-1">MTSEEK</font>).
</dd><dt><b>mt_blkno</b></dt><dd>
сообщает о номере блока в пределах текущего файла.
Значение установлено равным -1, когда номер блока неизвестен
(например, после <font size="-1">MTBSF</font>, <font size="-1">MTBSS</font> или <font size="-1">MTSEEK</font>).

</dd></dl>
<a name="lbAI">&nbsp;</a>
<h3><font size="-1">MTIOCPOS</font> - получить текущую позицию</h3>

<p>

Этот запрос использует аргумент типа
<b>(struct mtpos *)</b>

и сообщает текущий номер блока ленты, который необязательно будет
равен значению
<b>mt_blkno</b>,

возвращаемому <font size="-1">MTIOCGET</font>.
Накопитель должен быть накопителем SCSI-2, чтобы поддерживать
команды <font size="-1">READ POSITION</font>, или Tandberg-совместимым
накопителем SCSI-1 (Tandberg, Archive Viper, Wangtek, ... ).
</p><p>

</p><pre>/* структура для <font size="-1">MTIOCPOS</font> */
<dd>struct     mtpos {
    long   mt_blkno; /* текущий номер блока */
};
</dd></pre>

<a name="lbAJ">&nbsp;</a>
<h2>ВОЗВРАЩАЕМЫЕ ЗНАЧЕНИЯ</h2>

<dl compact="">
<dt>EIO</dt><dd>
Запрошеные операции могут быть завершены.
</dd><dt>ENOSPC</dt><dd>
Операции записи не могут завершиться, потому что лента закончилась.
</dd><dt>EACCES</dt><dd>
Попытка записать данные на ленту или "очистить" ленту, защищенную от записи.
Эта ошибка не появляется во время использования функции
<b>open()</b>.

</dd><dt>EFAULT</dt><dd>
Параметры команды указывают на память, не принадлежащую вызывающему процессу.
</dd><dt>ENXIO</dt><dd>
Во время открытия ленточного устройства обнаруживается, что его не существует.
</dd><dt>EBUSY</dt><dd>
Устройство уже используется, или драйвер не способен выделить буфер.
</dd><dt>EOVERFLOW</dt><dd>
Попытка чтения или записи блоков переменной длины, больших, чем
внутренний буфер драйвера.
</dd><dt>EINVAL</dt><dd>
<b>ioctl()</b>

был передан неверный аргумент или запрошен неправильный размер блока.
</dd><dt>ENOSYS</dt><dd>
Неизвестный
<b>ioctl()</b>.

</dd><dt>EROFS</dt><dd>
Попытка открыть накопитель с помощью O_WRONLY или O_RDWR, если лента в нем
защищена от записи.
</dd></dl>
<a name="lbAK">&nbsp;</a>
<h2>ФАЙЛЫ</h2>

/dev/st*  : ленточные устройства SCSI с автоперемоткой
<br>

/dev/nst* : ленточные устройства SCSI без автоперемотки
<a name="lbAL">&nbsp;</a>
<h2>АВТОРЫ</h2>

Драйвер был создан Kai M:akisara (<a href="mailto:Kai.Makisara@metla.fi">Kai.Makisara@metla.fi</a>) 
на основе драйвера, описанного Dwayne Forsyth. 
В этой работе принимали участие и другие авторы.
<a name="lbAM">&nbsp;</a>
<h2>СМ. ТАКЖЕ</h2>

<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=mt&amp;category=1">mt</a></b>(1)

<p>

Файл README.st в исходных текстах ядра содержит самую свежую информацию
о драйвере и его возможных конфигурациях.
<a name="lbAN">&nbsp;</a>
</p><h2>ЗАМЕЧАНИЯ</h2>

1. При обмене данными между системами обе системы согласовывают
физический размер блока ленты. Параметры накопителя после загрузки
часто не являются теми, которые использует большинство операционных систем,
работающих с этими устройствами. Большинство систем используют накопители в режиме
переменных блоков, если этот режим поддерживается накопителем.
Это применимо к большинству современных накопителей, включающих в себя
DAT, DLT и т.д. Возможно, целесообразно использовать эти накопители в
режиме переменных блоков также и в Linux (т.е., используйте MTSETBLK
или MTSETDEFBLK при запуске системы для установки необходимого режима);
<p>

2. Многие программы (например, tar) позволяют пользователю 
определить блокировку в командной строке. Заметьте, что это 
помогает определить размер физического блока на ленте, но только 
в режиме переменных блоков;
</p><p>

3. Для использования ленточных накопителей SCSI и базового драйвера SCSI
в ядре созданы (или загружены в него как модули): один из драйверов SCSI-адаптера 
и драйвер ленты SCSI.
Если драйвера SCSI-ленты не существует, накопитель становится привилегированным, но 
поддержка ленты, описанная здесь, вряд ли будет Вами применяться;
</p><p>

4. Драйвер записывает сообщения об ошибках на консоль/ в журнал. 
<a name="lbAO">&nbsp;</a>
</p><h2>АВТОРСКИЕ ПРАВА</h2>

Copyright © 1995 Robert K. Nichols.
<br>

Copyright © 1999 Kai M:akisara.
<p>

Разрешается делать и распространять точные копии этого документа, при условии 
наличия этой заметки об авторсикх правах и правилах распространения на каждой
копии документа.
Дополнительные условия содержатся в шапке файла.
<br>&nbsp;
</p><p>
</p><p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">НАЗВАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAC">СИНТАКСИС</a></dt><dd>
</dd><dt><a href="#lbAD">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAE">ПЕРЕДАЧА ДАННЫХ</a></dt><dd>
</dd><dt><a href="#lbAF">СИСТЕМНЫЕ ВЫЗОВЫ</a></dt><dd>
<dl>
<dt><a href="#lbAG"><font size="-1">MTIOCTOP</font> - выполнение ленточных операций</a></dt><dd>
</dd><dt><a href="#lbAH"><font size="-1">MTIOCGET</font> - получение статуса</a></dt><dd>
</dd><dt><a href="#lbAI"><font size="-1">MTIOCPOS</font> - получить текущую позицию</a></dt><dd>
</dd></dl>
</dd><dt><a href="#lbAJ">ВОЗВРАЩАЕМЫЕ ЗНАЧЕНИЯ</a></dt><dd>
</dd><dt><a href="#lbAK">ФАЙЛЫ</a></dt><dd>
</dd><dt><a href="#lbAL">АВТОРЫ</a></dt><dd>
</dd><dt><a href="#lbAM">СМ. ТАКЖЕ</a></dt><dd>
</dd><dt><a href="#lbAN">ЗАМЕЧАНИЯ</a></dt><dd>
</dd><dt><a href="#lbAO">АВТОРСКИЕ ПРАВА</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="st" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
