
<!--+++++++++++++++++++++++++++++++++++++++++++  0  +++++++++++++++++++++++++++++++++++++++++++--->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Проект OpenNet: MAN audit2allow (1) Команды и прикладные программы пользовательского уровня (FreeBSD и Linux)</title><meta name="KeyWords" content="man, manual, MAN, системное руководство, linux, FreeBSD, OpenBSD, Solaris, ядро, программы, системный вызов, audit2allow"><meta name="viewport" content="width=device-width, initial-scale=1"></head>


<body link="#0000FF" vlink="#000080" text="#000000" bgcolor="#E3E4D0" alink="#FF00FF">
<link rel="stylesheet" href="/opennet4.css" type="text/css">
<!--htdig_noindex-->
<form method="get" action="https://www.opennet.ru/search.shtml">
<aside>
<div style="width: 100%; text-align: right; font-size: 70%; background: #E9EAD6; margin-bottom:-10px;">
Профиль: <b><a href="/~" rel="nofollow" title="/~ - сводная страница участника"><u>Аноним</u></a></b> (<a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=login">вход</a> | <a href="https://www.opennet.ru/cgi-bin/openforum/vsluhboard.cgi?az=user_register">регистрация</a>)</div>

<table cellspacing="0" cellpadding="0" width="100%" border="0">
<tbody><tr>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" valign="BOTTOM" bgcolor="#E9EAD6" width="300">
<a href="https://www.opennet.ru/"><img src="/opennet2.gif" alt="The OpenNET Project" height="60" width="249" border="0"></a><br>
</td>
<td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left" bgcolor="#E9EAD6" align="CENTER" width="100">

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:10px;" bgcolor="#E9EAD6" align="CENTER" width="50%">
<table width="100%" border="0">
<tbody><tr>
<td width="22%">
 <a href="https://www.opennet.ru/opennews/" class="h"><b>НОВОСТИ</b></a> (<a href="https://www.opennet.ru/news/opennet.shtml" class="h">+</a>)
</td><td width="18%%">
  <a href="https://www.opennet.ru/mp/" class="h"><b>КОНТЕНТ</b></a>
</td><td width="14%">
  <a href="http://wiki.opennet.ru" class="h"><b>WIKI</b></a>
</td><td width="14%">
   <a href="https://www.opennet.ru/man.shtml" class="h"><b>MAN'ы</b></a>
</td><td width="16%">
   <a href="https://www.opennet.ru/forum/" class="h"><b>ФОРУМ</b></a>
</td><td width="16%">
<a href="https://www.opennet.ru/search.shtml" class="h" onmouseover="document.getElementById('form12').style.display='block';">Поиск</a>&nbsp;(<a href="https://www.opennet.ru/keywords/" class="h">теги</a>)
<input id="form12" style="display: none;" size="10" name="words" value="" title="для поиска в google наберите &quot;g фраза&quot;" type="text">
</td></tr>
</tbody></table>

</td><td style="background: #E9EAD6 url('/back.gif') repeat-x bottom left;padding-bottom:5px;" bgcolor="#E9EAD6" align="right" width="20%">

<a href="https://www.opennet.ru/opennews/opennews_all_utf.rss"><img src="/img/rss.png" alt="RSS" title="RSS" height="16" width="16" border="0"></a>&nbsp;<a href="https://twitter.com/opennetru"><img src="/twitter.png" alt="twitter" title="Twitter" height="16" width="16" border="0"></a>&nbsp;<a href="https://vk.com/opennet"><img src="/img/vkontakte.gif" title="ВКонтакте" height="16" width="16" border="0"></a>&nbsp;<a href="https://zen.yandex.ru/opennet"><img src="/img/zen.gif" title="Yandex Zen" height="16" width="16" border="0"></a>&nbsp;<a href="https://www.facebook.com/OpenNet.News/"><img src="/img/facebook.gif" title="Facebook" height="16" width="16" border="0"></a>&nbsp;<a href="https://telegram.space/opennet_ru"><img src="/img/telegram2.png" title="Telegram" height="16" width="16" border="0"></a>
</td></tr></tbody></table>
</aside>

<style>
    .hdr_mobile {
	text-align: center; 
	display: none;
	margin: 0px;
	padding: 0px;
    }
</style>
<div class="hdr_mobile">
<div style="margin-left: auto; margin-right: auto; width: 100%; height: 70px; border:1px solid #b0b190; min-width: 360px; max-width: 600px; background: #E9EAD6 url('/back.gif') repeat-x bottom left;">
<div style="float:left; width: 249px; height: 60px; margin-top: 10px;">
<a href="https://www.opennet.ru"><img src="/opennet2_lite.gif" style="height: 60px; width: 249px; border: 1px;" alt="The OpenNET Project / Index page"></a>
</div>
<div style="float: left; text-align: center; height: 70px; width: 331px; padding: 5px; margin-left: 10px;">
<br><small>[ <a href="/opennews/">новости</a>&nbsp;/<a href="/opennews/?full_lines=15&amp;lines=15&amp;mid_lines=00">+++</a> | <a href="/forum/">форум</a> | <a href="http://wiki.opennet.ru">wiki</a> | <a href="/keywords/">теги</a>
| <a href="tg://resolve?domain=opennet_ru"><img src="/img/telegram2.png" title="Telegram" style="margin-bottom: -4px;" height="16" width="16" border="0"></a>
]</small>
</div>
</div>
</div>
<div style="clear: both;"></div>


<div style="float: left; width: 279; text-align: left;padding-right: 60px;" id="adv">
</div>
<div style="padding-top: 0px;position:absolute;left:50%;margin-left:-235px;width:470px;" id="adv2">
</div>
<div style="width: 279;float: right;" id="adv3">
</div>
<div style="clear: both;"></div>
<br>
</form>
<!--/htdig_noindex-->

<center><h3><font color="#000088">Интерактивная система просмотра системных руководств (man-ов)</font></h3></center>
<form method="GET" action="/man.shtml"> 
<table cellspacing="0" cellpadding="1" bgcolor="#B0B190" align="center" width="600" border="0">
<tbody><tr>
<td valign="TOP">

<table cellspacing="0" cellpadding="0" bgcolor="#E9EAD6" align="center" width="100%" border="0">
<tbody><tr><td>&nbsp;<font color="#555555">Тема</font></td><td><font color="#555555">Набор</font></td><td><font color="#555555">Категория</font></td><td>&nbsp;</td></tr>
<tr><td>

&nbsp;<input size="20" name="topic" value="audit2allow" type="text"></td><td><select name="russian">
<option value="4">Solaris man
</option><option value="1">FreeBSD man
</option><option value="3">Разные man
</option><option value="0" selected="">Русские man
</option><option value="2">Linux man
</option><option value="5">POSIX man
</option></select></td>
<td><select size="1" name="category">
	  <option value="" selected="">All
	  </option><option value="1">1
	  </option><option value="2">2
	  </option><option value="3">3
	  </option><option value="4">4
	  </option><option value="5">5
	  </option><option value="6">6
	  </option><option value="7">7
	  </option><option value="8">8
	  </option><option value="9">9
</option></select></td>

<td><input name="submit" value="Показать man" type="submit"></td></tr>
<script async="" src="https://www.google-analytics.com/analytics.js"></script><script language="JavaScript" src="/print.js"></script>
<tr><td colspan="4" align="left">&nbsp;[<a href="/man.shtml">Cписок руководств</a> | <a href="#" onclick="pr('none');">Печать</a>]</td></tr>
</tbody></table>
</td></tr></tbody></table>
</form>
<h3></h3><font size="+2">audit2allow (1)</font><hr><li>&gt;&gt; <a href="/man.shtml?topic=audit2allow&amp;category=1&amp;russian=0"><u>audit2allow</u></a> (1) <font color="#555555"> ( Русские man: Команды и прикладные программы пользовательского уровня )</font></li><li> <a href="/man.shtml?topic=audit2allow&amp;category=1&amp;russian=2"><u>audit2allow</u></a> (1) <font color="#555555"> ( Linux man: Команды и прикладные программы пользовательского уровня )</font></li>
<a name="lbAB">&nbsp;</a>
<h2>НАЗВАНИЕ</h2>

audit2allow - создает разрешающие правила политики SELinux из файлов журналов, содержащих сообщения о запрете операций
<a name="lbAC">&nbsp;</a>
<h2>СИНТАКСИС</h2>

<b>audit2allow</b>

[<i>options</i>] 

<a name="lbAD">&nbsp;</a>
<h2>ОПЦИИ</h2>

<dl compact="">
<dt><b>-a | --all</b>

</dt><dd>
Прочесть входную информацию из журналов message и audit. Не используется вместе с опцией -i
</dd><dt><b>-d | --dmesg</b>

</dt><dd>
Прочесть входную информацию из вывода команды
<i>/bin/dmesg.</i>

Обратите внимание, что когда работает auditd, не все сообщения аудита доступны через dmesg.
Вместо этого используйте "ausearch -m avc | audit2allow"  или "-a".
</dd><dt><b>-f | --fcfile &lt;File Context File&gt;</b>

</dt><dd>
Добавить Файл Контекстов в генерируемый пакет модуля. Требует опцию -M.
</dd><dt><b>-h | --help</b>

</dt><dd>
Вывести краткую справку по использованию
</dd><dt><b>-i  &lt;inputfile&gt; | --input &lt;inputfile&gt;</b>

</dt><dd>
прочесть входную информацию из 
<i>&lt;inputfile&gt;</i>

</dd><dt><b>-l | --lastreload</b>

</dt><dd>
прочесть только часть входной информации, начиная с момента последней перезагрузки политики
</dd><dt><b>-m &lt;modulename&gt; | --module &lt;modulename&gt;</b>

</dt><dd>
Генерировать модуль. Требуется вывод &lt;modulename&gt;
</dd><dt><b>-M &lt;modulename&gt; </b>

</dt><dd>
Генерировать загружаемый пакет модуля. Опция конфликтует с -o
</dd><dt><b>-o &lt;outputfile&gt;  | --output &lt;outputfile&gt;</b>

</dt><dd>
дописать вывод в 
<i>&lt;outputfile&gt;</i>

</dd><dt><b>-r | --requires</b>

</dt><dd>
Генерировать вывод в синтаксисе загружаемого модуля. 
</dd><dt><b>-R | --reference</b>

</dt><dd>
Генерировать эталонную политику (reference policy), используя установленные макросы.  Требуется пакет selinux-policy-devel.
</dd><dt><b>-t   | --tefile</b>

</dt><dd>
Указывает, что выходной файл является te-файлом (type enforcement).  Может использоваться для конвертации старого формата политик в новый формат.
</dd><dt><b>-v | --verbose</b>

</dt><dd>
Включить подробный вывод
<p>
</p></dd></dl>
<a name="lbAE">&nbsp;</a>
<h2>ОПИСАНИЕ</h2>

<p>

Эта утилита сканирует журналы в поиске сообщений, появляющихся когда система не дает
разрешения на операцию. Далее утилита генерирует ряд правил, которые,
будучи загруженными в политику, могли бы разрешить эти операции.
Однако, данная утилита генерирует только разрешающие правила Type Enforcement (TE).
Некоторые отказы в использовании разрешений могут потребовать других изменений политики.
Например, добавление атрибута в определение типа, для разрешения существующего
ограничения (constraint), добавления разрешающего правила для роли или модификации ограничения (constraint).
В случае сомнений для диагностики  можно попробовать использовать утилиту
<b><a href="https://www.opennet.ru/cgi-bin/opennet/man.cgi?topic=audit2why&amp;category=8">audit2why</a></b>(8).

</p><p>

Следует с осторожностью работать с выводом данной утилиты, убедившись, что
разрешаемые операции не представляют угрозы безопасности. Обычно бывает лучше
определить новый домен и/или тип или произвести другие структурные изменения.
Лучше избирательно разрешить оптимальный набор операций вместо того, чтобы вслепую
применить иногда слишком широкие разрешения, рекомендованные этой утилитой.
Некоторые запреты на использование разрешений бывают не принципиальны для приложения.
В таких случаях вместо использования разрешительного правила ('allow' rule) лучше просто подавить журналирование этих запретов при помощи правила 'dontaudit'.
</p><p>

<a name="lbAF">&nbsp;</a>
</p><h2>ПРИМЕР</h2>

<pre><b>ЗАМЕЧАНИЕ: Этот пример подходит для системы, использующей пакет audit.</b>
<b>Если вы не используете пакет audit,  сообщения AVC будут появляться </b>
<b>в /var/log/messages. В этом случае замените /var/log/audit/audit.log,</b>
<b>используемый в примере, на /var/log/messages.</b>

<b>Использование audit2allow для генерации монолитной (не модульной) политики</b>
$ cd /etc/selinux/$SELINUXTYPE/src/policy
$ cat /var/log/audit/audit.log | audit2allow &gt;&gt; domains/misc/local.te
$ cat domains/misc/local.te
allow cupsd_config_t unconfined_t:fifo_file { getattr ioctl };
&lt;просмотрите domains/misc/local.te и при желании измените&gt;
$ make load

<b>Использование audit2allow для генерации модульной политики</b>

$ cat /var/log/audit/audit.log | audit2allow -m local &gt; local.te
$ cat local.te
module local 1.0;

require {
        role system_r;


        class fifo_file {  getattr ioctl };


        type cupsd_config_t;
        type unconfined_t;
 };


allow cupsd_config_t unconfined_t:fifo_file { getattr ioctl };
&lt;просмотрите local.te и при желании измените&gt;

<b>Создание модуля политики вручную</b>

# Скомпилируйте модуль
$ checkmodule -M -m -o local.mod local.te
# Создайте пакет
$ semodule_package -o local.pp -m local.mod
# Загрузите модуль в ядро
$ semodule -i local.pp

<b>Использование audit2allow для генерации и создания модуля политики</b>
$ cat /var/log/audit/audit.log | audit2allow -M local
Создается новый type enforcment файл: local.te
Компиляция политики: checkmodule -M -m -o local.mod local.te
Создание пакета: semodule_package -o local.pp -m local.mod

******************** В А Ж Н О ***********************

Для того, чтобы загрузить только что созданный пакет политики в ядро,
вам необходимо выполнить команду

semodule -i local.pp

</pre>

<p>

<a name="lbAG">&nbsp;</a>
</p><h2>АВТОРЫ</h2>

Эта страница руководства написана
<i>Manoj Srivastava &lt;<a href="mailto:srivasta@debian.org">srivasta@debian.org</a>&gt;</i>

для системы Debian GNU/Linux. Обновлена 
<i>Dan Walsh &lt;<a href="mailto:dwalsh@redhat.com">dwalsh@redhat.com</a>&gt;</i>

<p>

Перевод руководства - 
<i>Andrey Markelov &lt;<a href="mailto:andrey@markelov.net">andrey@markelov.net</a>&gt;, 2007г.</i>

</p><p>

Разработчиками утилиты 
<b>audit2allow</b>

являются несколько человек, включая 
<i>Justin R. Smith </i>

, 
<i>Yuichi Nakamura</i>

и 
<i>Dan Walsh</i>

</p><p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">НАЗВАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAC">СИНТАКСИС</a></dt><dd>
</dd><dt><a href="#lbAD">ОПЦИИ</a></dt><dd>
</dd><dt><a href="#lbAE">ОПИСАНИЕ</a></dt><dd>
</dd><dt><a href="#lbAF">ПРИМЕР</a></dt><dd>
</dd><dt><a href="#lbAG">АВТОРЫ</a></dt><dd>
</dd></dl>
<hr>
<br>
<form method="get" action="/search.shtml">
<font size="-1">
<font color="#555555">Поиск по тексту MAN-ов:&nbsp;</font><input size="30" name="words" value="audit2allow" type="text">
<input name="restrict" value="/man" type="hidden">
<input value="Найти" type="submit">
</font>
<input name="method" value="and" type="hidden">
<input name="format" value="builtin-long" type="hidden">
<input name="sort" value="score" type="hidden">
</form>
<br>
<!--htdig_noindex-->
<noindex>
<br>


</noindex>
<!--/htdig_noindex-->


<!-- footer -->
<!--htdig_noindex-->
<br><br>
<div style="background-color: #E9EAD6; width:100%; height: 61px;">
<div style="margin-right: 20px; float:left; line-height: 61px; vertical-align: middle; margin-left: 10px; font-size: 120%;">
Спонсоры:
</div>
<div style="float:left; height: 60px;  line-height: 60px; margin-left: 20px;">
<a style="align: middle;" target="_blank" href="https://inferno.name/"><img src="/img/inferno2.png" alt="Inferno Solutions" height="57" width="200"></a>
</div>
<div style="float:right; height: 60px;  line-height: 60px;  margin-left: 15px;">
<a style="align: middle;" target="_blank" href="http://hoster.ru/?utm_source=site&amp;utm_medium=banner&amp;utm_campaign=opennet"><img src="/img/dh143x60t.png" alt="Hosting by Hoster.ru" height="60" width="143"></a>
</div>
<div style="float:right;  height: 60px;  line-height: 60px; vertical-align: middle;font-size: 120%;">
Хостинг:
</div>

</div>

<div style="clear: both;"></div>


<br>
<table class="ttxt" style="border-top: 3px solid #C9CaB6;">
<tbody><tr><td width="35%">
<a href="/cgi-bin/opennet/bookmark.cgi">Закладки на сайте</a><br>
<a href="/cgi-bin/opennet/bookmark.cgi?submit=add" target="blank_">Проследить за страницей</a>
</td>
<td align="RIGHT" width="65%">
Created&nbsp;1996-2021&nbsp;by <b><a href="/contact.shtml" title="email maxim.chirkov@gmail.com">Maxim&nbsp;Chirkov</a></b><br>
<a href="https://www.opennet.ru/add.shtml">Добавить</a>, <a href="https://www.opennet.ru/donate.shtml" style="color: #C00000;">Поддержать</a>, <a href="https://www.opennet.ru/banners2.shtml">Вебмастеру</a>
</td>
</tr>
</tbody></table>
<br><br>


<!--/htdig_noindex-->
<!-- end of footer -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-123449-1', 'auto');
    ga('send', 'pageview');
</script>




</body>
<!---------------------------------------------  0  ---------------------------------------------->
